# 前端项目Docker部署说明

## 部署架构

本方案为两个前端项目提供了完整的Docker化部署方案：

1. **mall-admin-web** - 管理后台前端 (Vue 2 + Webpack)
2. **beilv-agent-web** - 用户端前端 (React + Vite)

## 文件结构

```
mall/
├── mall-admin-web/
│   ├── Dockerfile
│   ├── nginx.conf
│   └── ... (源代码)
├── beilv-agent-web/
│   ├── Dockerfile
│   ├── nginx.conf
│   └── ... (源代码)
└── mall/document/docker/
    └── docker-compose-frontend.yml
```

## 端口分配

- **mall-admin-web**: 18091 (管理后台前端)
- **beilv-agent-web**: 18092 (用户端前端)
- **后端服务**:
  - mall-admin: 18080
  - mall-portal: 18085

## 部署步骤

### 1. 构建Docker镜像

```bash
# 构建管理后台前端镜像
cd /mnt/d/software/beilv-agent/mall/mall-admin-web
docker build -t crpi-4z4v1n5g8hbg9g3x.cn-hangzhou.personal.cr.aliyuncs.com/beilv-agent/mall-admin-web:latest .

# 构建用户端前端镜像
cd /mnt/d/software/beilv-agent/mall/beilv-agent-web
docker build -t crpi-4z4v1n5g8hbg9g3x.cn-hangzhou.personal.cr.aliyuncs.com/beilv-agent/beilv-agent-web:latest .
```

### 2. 推送镜像到仓库

```bash
# 推送管理后台前端镜像
docker push crpi-4z4v1n5g8hbg9g3x.cn-hangzhou.personal.cr.aliyuncs.com/beilv-agent/mall-admin-web:latest

# 推送用户端前端镜像
docker push crpi-4z4v1n5g8hbg9g3x.cn-hangzhou.personal.cr.aliyuncs.com/beilv-agent/beilv-agent-web:latest
```

### 3. 创建必要的目录

```bash
# 创建日志目录
mkdir -p /root/install/mall/frontend/mall-admin-web/logs
mkdir -p /root/install/mall/frontend/beilv-agent-web/logs
```

### 4. 启动前端服务

```bash
# 进入docker配置目录
cd /mnt/d/software/beilv-agent/mall/mall/document/docker

# 启动所有服务（按顺序）
docker-compose -f docker-compose-env.yml up -d  # 启动环境服务
docker-compose -f docker-compose-app.yml up -d  # 启动后端服务
docker-compose -f docker-compose-frontend.yml up -d  # 启动前端服务
```

## 服务依赖关系

```
前端服务 → 后端服务 → 环境服务
├── mall-admin-web → mall-admin → mysql, redis, minio
└── beilv-agent-web → mall-portal → mysql, redis, mongo, rabbitmq, minio
```

## 访问地址

- **管理后台**: http://localhost:18091
- **用户端**: http://localhost:18092
- **管理后台API**: http://localhost:18080
- **用户端API**: http://localhost:18085

## 配置说明

### Nginx配置特点

1. **静态资源优化**: 启用gzip压缩，设置缓存策略
2. **API代理**: 自动代理/api请求到对应后端服务
3. **SPA支持**: 配置前端路由支持
4. **日志记录**: 统一日志输出到挂载目录

### Docker配置特点

1. **多阶段构建**: 优化镜像大小
2. **时区同步**: 统一使用Asia/Shanghai时区
3. **外部链接**: 通过external_links连接后端服务
4. **数据持久化**: 日志文件挂载到宿主机

## 常用命令

```bash
# 查看服务状态
docker-compose -f docker-compose-frontend.yml ps

# 查看日志
docker-compose -f docker-compose-frontend.yml logs -f mall-admin-web
docker-compose -f docker-compose-frontend.yml logs -f beilv-agent-web

# 重启服务
docker-compose -f docker-compose-frontend.yml restart

# 停止服务
docker-compose -f docker-compose-frontend.yml down

# 更新服务
docker-compose -f docker-compose-frontend.yml pull
docker-compose -f docker-compose-frontend.yml up -d
```

## 注意事项

1. 确保后端服务已正常启动再启动前端服务
2. 首次部署需要创建日志目录
3. 镜像更新后需要重新构建和推送
4. 网络配置需要与现有后端服务保持一致
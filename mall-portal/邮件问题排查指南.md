# 🔧 邮件认证失败问题排查指南

## 🚨 问题描述
邮件发送失败，错误信息：`535 Error: authentication failed`

## 📋 当前配置
- **发件邮箱**: vcode@xrateverse.com
- **SMTP服务器**: smtp.exmail.qq.com (腾讯企业邮箱)
- **端口**: 465
- **协议**: smtps
- **密码**: NNyqSi67bLuGLzpv

## 🔍 问题原因分析

### 1. 密码/授权码问题
- 授权码可能已过期
- 密码可能不正确
- 需要使用专用密码而不是登录密码

### 2. 账户状态问题
- 邮箱账户可能被暂停
- SMTP服务可能被禁用
- 企业邮箱管理员可能更改了设置

### 3. 网络/防火墙问题
- 465端口可能被阻断
- 企业网络防火墙限制

## 🛠️ 解决方案

### 方案1：更换为网易163邮箱（简单测试）
```bash
# 设置环境变量
export MAIL_HOST=smtp.163.com
export MAIL_PORT=25
export MAIL_USERNAME=your-email@163.com
export MAIL_PASSWORD=your-163-auth-code
export MAIL_PROTOCOL=smtp
export MAIL_SSL_ENABLE=false
export MAIL_STARTTLS_ENABLE=false
```

### 方案2：更换为QQ邮箱
```bash
# 设置环境变量
export MAIL_HOST=smtp.qq.com
export MAIL_PORT=587
export MAIL_USERNAME=your-qq@qq.com
export MAIL_PASSWORD=your-qq-auth-code
export MAIL_PROTOCOL=smtp
export MAIL_SSL_ENABLE=false
export MAIL_STARTTLS_ENABLE=true
export MAIL_STARTTLS_REQUIRED=true
```

### 方案3：检查腾讯企业邮箱设置
1. 登录腾讯企业邮箱管理后台
2. 检查SMTP服务是否启用
3. 重新生成授权码
4. 确认账户状态正常

### 方案4：启用详细日志调试
```bash
# 启用邮件调试模式
export MAIL_DEBUG=true
```

## 🧪 测试步骤

### 1. 快速测试其他邮件服务商
```bash
curl -X POST http://localhost:8085/api/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","codeType":2}'
```

### 2. 使用telnet测试SMTP连接
```bash
telnet smtp.exmail.qq.com 465
```

### 3. 检查防火墙和网络
```bash
nmap -p 465 smtp.exmail.qq.com
```

## 📝 推荐操作顺序

1. **立即解决** - 更换为网易163邮箱测试
2. **调试模式** - 启用详细日志
3. **检查账户** - 验证腾讯企业邮箱状态
4. **网络诊断** - 检查端口和连接

## 🎯 建议
建议先使用网易163邮箱进行测试，因为它配置最简单，成功率最高。一旦确认邮件发送功能正常，再回头解决腾讯企业邮箱的认证问题。
# 邮件服务商配置指南

## 🎯 功能特性

✅ **支持所有主流邮件服务商**
- 腾讯企业邮箱、QQ邮箱、Gmail、Outlook
- 网易163/126邮箱、新浪邮箱、搜狐邮箱
- 阿里云邮件推送服务

✅ **自动适配配置**
- 智能SSL/TLS检测
- 端口自动适配（25/587/465/994）
- 协议自动选择（smtp/smtps）

✅ **高级特性**
- 重试机制（3次指数退避）
- 连接池优化
- 超时控制
- 调试模式

## 📧 快速配置

### 方法1：使用环境变量（推荐）

创建 `.env` 文件或设置系统环境变量：

#### 腾讯企业邮箱（当前默认）
```bash
MAIL_HOST=smtp.exmail.qq.com
MAIL_PORT=465
MAIL_USERNAME=vcode@xrateverse.com
MAIL_PASSWORD=NNyqSi67bLuGLzpv
MAIL_FROM_ADDRESS=vcode@xrateverse.com
MAIL_FROM_NAME=BEILV AI
MAIL_PROTOCOL=smtps
MAIL_SSL_ENABLE=true
MAIL_STARTTLS_ENABLE=false
```

#### QQ邮箱
```bash
MAIL_HOST=smtp.qq.com
MAIL_PORT=587
MAIL_USERNAME=你的QQ号@qq.com
MAIL_PASSWORD=你的QQ邮箱授权码
MAIL_FROM_ADDRESS=你的QQ号@qq.com
MAIL_FROM_NAME=BEILV AI
MAIL_PROTOCOL=smtp
MAIL_SSL_ENABLE=false
MAIL_STARTTLS_ENABLE=true
MAIL_STARTTLS_REQUIRED=true
```

#### 网易163邮箱
```bash
MAIL_HOST=smtp.163.com
MAIL_PORT=25
MAIL_USERNAME=你的邮箱@163.com
MAIL_PASSWORD=你的163授权码
MAIL_FROM_ADDRESS=你的邮箱@163.com
MAIL_FROM_NAME=BEILV AI
MAIL_PROTOCOL=smtp
MAIL_SSL_ENABLE=false
MAIL_STARTTLS_ENABLE=false
```

#### Gmail
```bash
MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=你的邮箱@gmail.com
MAIL_PASSWORD=应用专用密码
MAIL_FROM_ADDRESS=你的邮箱@gmail.com
MAIL_FROM_NAME=BEILV AI
MAIL_PROTOCOL=smtp
MAIL_SSL_ENABLE=false
MAIL_STARTTLS_ENABLE=true
MAIL_STARTTLS_REQUIRED=true
```

#### Outlook/Hotmail
```bash
MAIL_HOST=smtp-mail.outlook.com
MAIL_PORT=587
MAIL_USERNAME=你的邮箱@outlook.com
MAIL_PASSWORD=你的密码
MAIL_FROM_ADDRESS=你的邮箱@outlook.com
MAIL_FROM_NAME=BEILV AI
MAIL_PROTOCOL=smtp
MAIL_SSL_ENABLE=false
MAIL_STARTTLS_ENABLE=true
MAIL_STARTTLS_REQUIRED=true
```

### 方法2：直接修改application.yml

如果不使用环境变量，可以直接修改 `application.yml` 中的默认值：

```yaml
spring:
  mail:
    host: smtp.163.com  # 修改为你的SMTP服务器
    port: 25           # 修改为对应端口
    username: your@163.com  # 修改为你的邮箱
    password: your-password # 修改为你的密码
```

## 🔑 授权码获取指南

### QQ邮箱授权码
1. 登录 https://mail.qq.com
2. 设置 → 账户 → POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务
3. 开启"IMAP/SMTP服务"
4. 点击"生成授权码"，验证手机号
5. 获得16位授权码

### 163邮箱授权码
1. 登录 https://mail.163.com
2. 设置 → POP3/SMTP/IMAP
3. 开启"SMTP服务"
4. 获取客户端授权密码

### Gmail应用专用密码
1. 开启两步验证
2. Google账户设置 → 安全性 → 应用专用密码
3. 生成邮件应用专用密码

## 🧪 测试配置

### 1. 调试模式
启用调试模式查看详细日志：
```bash
MAIL_DEBUG=true
```

### 2. 测试邮件发送
```bash
curl -X POST http://localhost:8085/api/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","codeType":2}'
```

### 3. 查看日志
观察控制台输出：
- ✅ 成功：`邮件发送成功`
- ❌ 失败：`邮件发送失败` + 详细错误信息
- 🔄 重试：`等待XXXms后重试`

## 🚨 常见问题

### 问题1：认证失败 (535 Authentication Failed)
**原因**：用户名或密码错误
**解决**：
- 确认使用授权码而非登录密码
- 检查用户名格式（通常是完整邮箱地址）

### 问题2：连接超时
**原因**：网络或端口问题
**解决**：
- 检查防火墙设置
- 尝试不同端口（25/587/465）
- 检查网络连接

### 问题3：SSL错误
**原因**：SSL/TLS配置不匹配
**解决**：
- 465端口通常需要SSL
- 587端口通常需要STARTTLS
- 25端口通常不需要加密

### 问题4：发送成功但收不到邮件
**原因**：可能被垃圾邮件过滤
**解决**：
- 检查垃圾邮件箱
- 使用真实域名邮箱
- 配置SPF/DKIM记录

## ⚙️ 高级配置

### 连接池优化
```bash
MAIL_TIMEOUT_SECONDS=30        # 连接超时
MAIL_RETRY_COUNT=3            # 重试次数
MAIL_ASYNC_ENABLED=false      # 异步发送
```

### 发送频率控制
```yaml
verification-code:
  send-interval-seconds: 60    # 发送间隔
  max-send-per-day: 10        # 日发送限制
```

## 📊 邮件服务商对比

| 服务商 | 稳定性 | 配置难度 | 发送速度 | 推荐指数 |
|--------|--------|----------|----------|----------|
| 腾讯企业邮箱 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| QQ邮箱 | ⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 网易163 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| Gmail | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| Outlook | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |

## 🎉 部署建议

1. **开发环境**：使用网易163邮箱（配置简单）
2. **测试环境**：使用QQ邮箱（功能丰富）
3. **生产环境**：使用腾讯企业邮箱（稳定可靠）

---

配置完成后重启服务即可生效！🚀
# PC端前台系统整体开发计划

## 项目概述

基于现有mall电商系统，开发一个PC端网页化的前台系统，替代原有的uni-app移动端应用。系统将采用React + TypeScript + Vite技术栈，提供AI创意设计平台功能，包含积分系统、套餐管理、多语言支持等核心功能。

## 技术架构

### 前端技术栈
- **框架**: React 18 + TypeScript
- **构建工具**: Vite
- **状态管理**: Redux Toolkit + RTK Query
- **路由管理**: React Router v6
- **UI组件库**: Ant Design / Material-UI
- **HTTP客户端**: Axios
- **国际化**: react-i18next
- **样式解决方案**: Tailwind CSS / Styled Components

### 后端技术栈 (基于现有mall-portal)
- **框架**: Spring Boot 3.2.2
- **数据库**: MySQL 5.7
- **缓存**: Redis
- **搜索引擎**: Elasticsearch
- **消息队列**: RabbitMQ
- **文件存储**: MinIO / 阿里云OSS
- **支付**: 支付宝SDK

## 开发阶段规划

### 第一阶段: 基础架构搭建 (预计2周)
**目标**: 搭建项目基础架构和开发环境

**前端任务**:
- [x] 初始化Vite + React + TypeScript项目
- [x] 配置代码规范(ESLint, Prettier)
- [x] 搭建路由系统
- [x] 配置全局状态管理
- [x] 封装HTTP请求库
- [x] 搭建多语言国际化框架
- [x] 实现响应式布局基础
- [x] 配置开发和生产环境

**后端任务**:
- [x] 扩展mall-portal模块API
- [x] 分析现有mall系统表结构（积分、商品、订单）
- [x] 设计基于现有表的积分系统扩展方案
- [x] 设计AI任务管理数据表（任务状态、结果存储）
- [x] 设计作品展示和项目管理数据表
- [x] 设计套餐系统数据表
- [x] 完善用户认证接口
- [x] 实现邮件服务集成
- [x] 搭建文件上传和存储服务（支持multipart/form-data）

### 第二阶段: 用户认证系统 (预计1.5周)
**目标**: 实现完整的用户注册、登录系统

**功能清单**:
- [x] 邮箱验证码注册
- [x] 邮箱验证码登录
- [x] 微信扫码登录集成
- [x] 谷歌账号登录集成
- [x] JWT Token管理
- [x] 用户信息管理
- [x] 密码找回功能

### 第三阶段: 首页界面开发 (预计2周)
**目标**: 按照prototype.html设计实现首页功能

**功能清单**:
- [x] 复刻prototype.html页面设计
- [x] 实现文件上传功能（前端缩略图预览，与提示词一同提交）
- [x] 实现搜索功能（搜索历史AI生成作品和模板案例）
- [x] 实现案例展示(Gallery)（展示平台精选AI作品和用户公开作品）
- [x] 实现项目管理功能（用户个人AI作品管理）
- [x] 实现浮动搜索栏（作为AI任务入口）
- [x] 响应式设计适配

**对应后端接口需求**:
- **搜索功能接口**:
  - `GET /api/gallery/search` - 搜索AI作品和模板
  - `GET /api/projects/search` - 搜索用户个人项目
- **案例展示接口**:
  - `GET /api/gallery/featured` - 获取精选作品列表
  - `GET /api/gallery/public` - 获取公开作品列表  
  - `GET /api/gallery/categories` - 获取作品分类
- **项目管理接口**:
  - `GET /api/projects/list` - 获取用户项目列表
  - `POST /api/projects/create` - 创建新项目
  - `PUT /api/projects/{id}` - 更新项目信息
  - `DELETE /api/projects/{id}` - 删除项目
  - `POST /api/projects/{id}/share` - 分享项目到Gallery

**AI任务流程详细设计**:

**首页交互流程**:
- **文件预览**: 用户选择图片后立即显示缩略图预览，不直接上传
- **提示词输入**: 用户在搜索栏/输入框中输入AI任务提示词
- **任务入口**: 点击提交按钮跳转到AI任务执行页面，传递图片和提示词数据

**AI任务执行页面**:
- **任务创建**: 接收首页传递的图片和提示词，创建AI任务
- **积分扣费**: 根据任务类型消费相应积分（优先使用免费积分）
- **进度显示**: 实时显示AI任务执行状态和进度
- **结果展示**: 展示AI生成的结果，支持下载或进一步编辑
- **对话交互**: 支持用户与AI进行多轮对话，优化生成结果

**后端接口设计**:
- **任务提交接口**: 支持multipart/form-data格式，同时接收图片文件和文本数据
- **任务状态接口**: 提供实时任务进度查询
- **结果获取接口**: 返回AI生成的最终结果

### 第四阶段: 积分系统开发 (预计2周)
**目标**: 基于现有mall表结构实现用户积分管理和购买功能

**功能清单**:
- [x] 积分余额显示（双积分体系：免费积分+永久积分）
- [x] 积分使用记录（复用ums_integration_change_history）
- [x] 积分购买页面（使用现有pms_product表）
- [x] 积分商品管理（复用现有商品管理系统）
- [x] 积分消费逻辑（优先使用免费积分）
- [x] 每日积分重置（基于ums_member_rule_setting配置）
- [x] 积分变动通知

### 第五阶段: 套餐管理系统 (预计2周)
**目标**: 实现会员套餐功能

**功能清单**:
- [x] 套餐展示页面
- [x] 套餐升级功能
- [x] 会员权益管理
- [x] 套餐到期提醒
- [x] Usage Details页面
- [x] 套餐购买流程

### 第六阶段: 支付系统集成 (预计1.5周)
**目标**: 集成现有支付系统，支持积分和套餐购买

**功能清单**:
- [x] 支付宝支付集成
- [x] 订单管理系统
- [x] 支付成功回调
- [x] 购买后自动发货(积分/套餐)
- [x] 退款处理
- [x] 支付记录查询

### 第七阶段: 多语言与优化 (预计1.5周)
**目标**: 完善国际化支持和性能优化

**功能清单**:
- [x] 多语言切换功能
- [x] 语言包管理
- [x] 性能优化
- [x] 错误处理完善
- [x] 用户体验优化
- [x] 移动端适配

### 第八阶段: 测试与部署 (预计1周)
**目标**: 系统测试和生产环境部署

**功能清单**:
- [x] 单元测试编写
- [x] 集成测试
- [x] 用户验收测试
- [x] 性能测试
- [x] 生产环境部署
- [x] 监控系统搭建

## 数据库设计扩展

### 基于现有mall表结构的积分系统设计

#### 复用现有表结构
1. **ums_member.integration** - 用作永久积分余额
2. **ums_integration_change_history** - 用作积分变动记录
3. **pms_product** - 复用现有商品表，积分商品通过product_type=2标识
4. **ums_member_rule_setting** - 配置每日免费积分规则

#### 需要扩展的表字段
```sql
-- 扩展用户表，添加免费积分相关字段
ALTER TABLE ums_member ADD COLUMN free_daily_credits INT DEFAULT 200 COMMENT '每日免费积分';
ALTER TABLE ums_member ADD COLUMN used_today_free INT DEFAULT 0 COMMENT '今日已使用免费积分';
ALTER TABLE ums_member ADD COLUMN last_reset_date DATE COMMENT '最后重置日期';

-- 扩展积分变动记录表，添加积分类型和业务ID
ALTER TABLE ums_integration_change_history ADD COLUMN credit_type TINYINT DEFAULT 2 COMMENT '积分类型: 1-免费积分, 2-永久积分';
ALTER TABLE ums_integration_change_history ADD COLUMN business_id VARCHAR(64) COMMENT '业务ID(如AI任务ID)';

-- 扩展商品表，添加积分商品标识
ALTER TABLE pms_product ADD COLUMN product_type TINYINT DEFAULT 1 COMMENT '商品类型: 1-普通商品, 2-积分商品, 3-套餐商品';
ALTER TABLE pms_product ADD COLUMN credit_amount INT COMMENT '积分数量(积分商品时使用)';
```

#### 积分商品数据初始化
```sql
-- 初始化积分商品数据（使用现有pms_product表）
INSERT INTO pms_product (
    brand_id, product_category_id, name, sub_title, description, price, original_price, stock, unit, weight, sort, gift_growth, gift_point, use_point_limit, product_sn, keywords, publish_status, new_status, recommend_status, verify_status, sale, product_type, credit_amount
) VALUES 
(1, 1, '基础积分包', '1000积分', '适合轻度使用用户，包含1000积分', 9.90, 12.90, 999, '包', 0, 1, 0, 0, 0, 'CREDIT_BASIC_1000', '积分,充值,基础', 1, 1, 0, 1, 0, 2, 1000),
(1, 1, '标准积分包', '3000积分', '适合日常使用用户，包含3000积分', 26.90, 35.90, 999, '包', 0, 2, 0, 0, 0, 'CREDIT_STANDARD_3000', '积分,充值,标准', 1, 1, 1, 1, 0, 2, 3000),
(1, 1, '专业积分包', '6000积分', '适合专业设计师，包含6000积分', 49.90, 69.90, 999, '包', 0, 3, 0, 0, 0, 'CREDIT_PRO_6000', '积分,充值,专业', 1, 1, 1, 1, 0, 2, 6000),
(1, 1, '企业积分包', '15000积分', '适合团队协作，包含15000积分', 119.90, 169.90, 999, '包', 0, 4, 0, 0, 0, 'CREDIT_ENTERPRISE_15000', '积分,充值,企业', 1, 0, 1, 1, 0, 2, 15000),
(1, 1, '旗舰积分包', '30000积分', '无限创作可能，包含30000积分', 219.90, 329.90, 999, '包', 0, 5, 0, 0, 0, 'CREDIT_FLAGSHIP_30000', '积分,充值,旗舰', 1, 1, 1, 1, 0, 2, 30000);

-- 配置每日免费积分规则
UPDATE ums_member_rule_setting SET 
    continue_sign_day = 1,
    continue_sign_point = 200,
    type = 0 
WHERE id = 1;
```

#### 套餐表 (ums_subscription_plans)
```sql
CREATE TABLE ums_subscription_plans (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL COMMENT '套餐名称',
    price DECIMAL(10,2) NOT NULL COMMENT '价格',
    duration_days INT NOT NULL COMMENT '套餐时长(天)',
    features JSON COMMENT '套餐功能特性',
    credits_included INT DEFAULT 0 COMMENT '包含积分数',
    is_active TINYINT DEFAULT 1 COMMENT '是否启用',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 用户套餐订阅表 (ums_member_subscriptions)
```sql
CREATE TABLE ums_member_subscriptions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    member_id BIGINT NOT NULL COMMENT '会员ID',
    plan_id BIGINT NOT NULL COMMENT '套餐ID',
    start_date DATETIME NOT NULL COMMENT '开始时间',
    end_date DATETIME NOT NULL COMMENT '结束时间',
    status TINYINT DEFAULT 1 COMMENT '状态: 1-生效, 2-过期, 3-取消',
    order_id BIGINT COMMENT '购买订单ID',
    created_time DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## API接口设计

### 用户认证相关
- `POST /api/auth/register/email` - 邮箱注册
- `POST /api/auth/login/email` - 邮箱登录  
- `POST /api/auth/login/wechat` - 微信登录
- `POST /api/auth/login/google` - 谷歌登录
- `POST /api/auth/send-code` - 发送验证码
- `POST /api/auth/verify-code` - 验证码校验

### 积分系统相关
- `GET /api/credits/balance` - 获取积分余额（免费积分+永久积分）
- `GET /api/credits/history` - 积分变动记录（基于ums_integration_change_history）
- `GET /api/credits/products` - 积分商品列表（查询product_type=2的商品）
- `POST /api/credits/purchase` - 购买积分（复用现有订单系统）
- `POST /api/credits/consume` - 消费积分（AI任务扣费）

### 套餐系统相关
- `GET /api/plans/list` - 获取套餐列表
- `POST /api/plans/subscribe` - 购买套餐
- `GET /api/plans/current` - 当前套餐信息
- `GET /api/plans/usage` - 使用详情

### AI任务和内容管理相关
- `POST /api/ai/tasks/create` - 创建AI任务（接收图片+提示词）
- `GET /api/ai/tasks/{id}/status` - 查询任务执行状态
- `GET /api/ai/tasks/{id}/result` - 获取任务执行结果
- `POST /api/ai/tasks/{id}/chat` - AI任务对话交互

### 作品展示和搜索相关
- `GET /api/gallery/search` - 搜索AI作品和模板（支持关键词、分类筛选）
- `GET /api/gallery/featured` - 获取精选作品列表（首页展示）
- `GET /api/gallery/public` - 获取公开作品列表（分页）
- `GET /api/gallery/categories` - 获取作品分类列表
- `GET /api/gallery/{id}` - 获取作品详情

### 项目管理相关
- `GET /api/projects/search` - 搜索用户个人项目
- `GET /api/projects/list` - 获取用户项目列表（分页）
- `POST /api/projects/create` - 创建新项目
- `PUT /api/projects/{id}` - 更新项目信息
- `DELETE /api/projects/{id}` - 删除项目
- `POST /api/projects/{id}/share` - 分享项目到Gallery
- `GET /api/projects/{id}` - 获取项目详情

### 支付相关
- `POST /api/pay/create` - 创建支付订单
- `POST /api/pay/callback` - 支付回调
- `GET /api/orders/list` - 订单列表
- `GET /api/orders/detail/{id}` - 订单详情

## 部署方案

### 前端部署
- 使用Nginx作为Web服务器
- 启用Gzip压缩
- 配置缓存策略
- 实现CDN加速

### 后端部署
- 复用现有mall系统部署方案
- 扩展mall-portal模块
- 确保数据库兼容性
- 配置负载均衡

## 风险评估与对策

### 技术风险
1. **现有系统兼容性**: 需要确保新功能不影响现有mall系统
   - **对策**: 最大化复用现有表结构，只做必要的字段扩展

2. **数据一致性**: 积分系统复用现有表时的数据一致性问题
   - **对策**: 使用事务确保数据一致性，做好数据校验和备份

3. **性能问题**: 新增功能可能影响系统性能
   - **对策**: 为新增字段添加索引，实现缓存策略

4. **第三方服务依赖**: 微信、谷歌登录等第三方服务稳定性
   - **对策**: 实现降级方案，提供邮箱登录备选

### 业务风险
1. **用户体验**: 从移动端转换到PC端的用户适应性
   - **对策**: 保持核必功能不变，优化PC端交互

2. **积分业务理解**: 积分系统从商品兑换转变为AI内容生成计费
   - **对策**: 明确积分使用场景，做好用户教育和引导

3. **数据安全**: 积分和支付相关的安全问题
   - **对策**: 实现完善的权限控制和数据加密，防止积分滥用

## 成功指标

### 技术指标
- 页面加载速度 < 3秒
- 系统可用性 > 99.5%
- API响应时间 < 500ms
- 代码测试覆盖率 > 80%

### 业务指标
- 用户注册转化率 > 15%
- 积分购买转化率 > 10%
- 套餐升级率 > 5%
- 用户满意度 > 4.5/5

## 后续迭代计划

### V1.1版本 (3个月后)
- 增加更多第三方登录方式
- 实现用户推荐系统
- 添加社交分享功能
- 优化移动端体验

### V1.2版本 (6个月后)
- 实现AI功能集成
- 添加项目协作功能
- 实现高级会员功能
- 增加数据分析仪表盘

---

**总开发周期**: 约12周 (3个月)  
**团队配置建议**: 2-3名前端开发工程师 + 1-2名后端开发工程师 + 1名UI设计师  
**预估工作量**: 前端约400工时，后端约300工时
# AIè§†é¢‘ç”Ÿæˆå·¥ä½œæµç³»ç»Ÿè¯¦ç»†éœ€æ±‚

## é¡¹ç›®èƒŒæ™¯

åŸºäºç°æœ‰çš„mallç”µå•†ç³»ç»Ÿï¼Œå¼€å‘ä¸€ä¸ªAIè§†é¢‘ç”Ÿæˆå·¥ä½œæµç³»ç»Ÿï¼Œé€šè¿‡æ™ºèƒ½åˆ†æç”¨æˆ·æç¤ºè¯å’Œä¸Šä¼ çš„å›¾ç‰‡ï¼ŒåŠ¨æ€ç”Ÿæˆå®Œæ•´çš„è§†é¢‘åˆ¶ä½œå·¥ä½œæµï¼Œå¹¶è‡ªåŠ¨æ‰§è¡Œç”Ÿæˆæœ€ç»ˆçš„çŸ­è§†é¢‘å†…å®¹ã€‚

## é¡¹ç›®æ¶æ„

### ç°æœ‰é¡¹ç›®ç»“æ„
- **ç®¡ç†åç«¯å‰ç«¯é¡¹ç›®**ï¼š`/mnt/d/software/beilv-agent/mall/mall-admin-web`
- **ç®¡ç†åç«¯åç«¯é¡¹ç›®**ï¼š`/mnt/d/software/beilv-agent/mall/mall/mall-admin`
- **ç”¨æˆ·ç«¯å‰ç«¯é¡¹ç›®**ï¼š`/mnt/d/software/beilv-agent/mall/beilv-agent-web`
- **ç”¨æˆ·ç«¯åç«¯é¡¹ç›®**ï¼š`/mnt/d/software/beilv-agent/mall/mall/mall-portal`
- **æ™ºèƒ½ä½“Pythonåç«¯é¡¹ç›®**ï¼š`/mnt/d/software/beilv-agent/mall/beilv-agent` (æ–°å»ºFastAPIé¡¹ç›®)

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**ï¼šReact + TypeScript + Ant Design
- **Javaåç«¯**ï¼šSpring Boot + MyBatis + MySQL
- **Python AIæœåŠ¡**ï¼šFastAPI + LangChain + Celery
- **æ•°æ®åº“**ï¼šMySQL (å…±äº«)
- **æ–‡ä»¶å­˜å‚¨**ï¼šMinIO/é˜¿é‡Œäº‘OSS
- **å®æ—¶é€šä¿¡**ï¼šWebSocket

## æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### 1. AIå·¥å…·æ³¨å†Œç³»ç»Ÿ

Pythonåç«¯é€šè¿‡LangChainæ³¨å†Œæ”¯æŒçš„å·¥å…·ï¼Œæ¯ä¸ªå·¥å…·å‡½æ•°éƒ½éœ€è¦æœ‰å”¯ä¸€ä¸”å›ºå®šçš„UUIDï¼Œä¾¿äºæ•°æ®åº“è®°å½•åï¼Œåç«¯ç¨‹åºé€šè¿‡UUIDå®šä½å¯¹åº”çš„å‡½æ•°ã€‚

#### 1.1 å·¥å…·åˆ—è¡¨ (10ä¸ªAIå·¥å…·)
1. **æ–‡ç”Ÿå›¾** (ç¬¬ä¸‰æ–¹API) - UUID: `tool-text2img-001`
2. **å›¾ç”Ÿå›¾** (ç¬¬ä¸‰æ–¹API) - UUID: `tool-img2img-002`
3. **å›¾ç”Ÿè§†é¢‘** (ç¬¬ä¸‰æ–¹API) - UUID: `tool-img2video-003`
4. **æ–‡ç”Ÿè§†é¢‘** (ç¬¬ä¸‰æ–¹API) - UUID: `tool-text2video-004`
5. **èƒŒæ™¯éŸ³ä¹ç”Ÿæˆ** (ç¬¬ä¸‰æ–¹API) - UUID: `tool-music-gen-005`
6. **æ–‡æ¡ˆè½¬è¯­éŸ³** (ç¬¬ä¸‰æ–¹API) - UUID: `tool-text2speech-008`
7. **è¯­éŸ³ç”Ÿæˆå­—å¹•** (ç¬¬ä¸‰æ–¹API) - UUID: `tool-speech2sub-009`
8. **è§†é¢‘åˆå¹¶** (æœ¬åœ°æ¥å£) - UUID: `tool-video-merge-010`
9. **éŸ³è§†é¢‘åˆå¹¶** (æœ¬åœ°æ¥å£) - UUID: `tool-av-merge-011`
10. **å­—å¹•è§†é¢‘åˆå¹¶** (æœ¬åœ°æ¥å£) - UUID: `tool-sub-merge-012`

**è¯´æ˜**ï¼šå›¾ç‰‡ç†è§£ã€ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ã€ç”Ÿæˆè§†é¢‘æç¤ºè¯ã€å£æ’­æ–‡æ¡ˆç”ŸæˆåŠŸèƒ½å·²æ•´åˆåˆ°å·¥ä½œæµç”Ÿæˆé˜¶æ®µï¼Œç”±LLMåœ¨åˆ†æç”¨æˆ·è¾“å…¥æ—¶ä¸€æ¬¡æ€§å®Œæˆã€‚

#### 1.2 AIæ¨¡å‹é€‚é…å™¨æ¶æ„è®¾è®¡

ä¸ºäº†æ”¯æŒåç»­åˆ‡æ¢ä¸åŒçš„AIæ¨¡å‹æä¾›å•†ï¼ˆå¦‚è±†åŒ…ã€é€šä¹‰åƒé—®ã€æ–‡å¿ƒä¸€è¨€ç­‰ï¼‰ï¼Œé‡‡ç”¨é€‚é…å™¨æ¨¡å¼è®¾è®¡AIæ¨¡å‹æ¥å…¥å±‚ã€‚

##### 1.2.1 æ··åˆå¹³å°é€‚é…å™¨æ¶æ„
```text
AIå·¥å…·å±‚ (tool-text2img-001, tool-img2video-003...)
       â†“
æ™ºèƒ½é€‚é…å™¨é€‰æ‹©å™¨ (SmartAdapterSelector)
       â†“
AIæ¨¡å‹é€‚é…å™¨å±‚ (DouBao, TongYi, WenXin, OpenAI...)
       â†“
AIæ¨¡å‹æä¾›å•†å±‚ (å„å¹³å°APIè°ƒç”¨)
```

**æ ¸å¿ƒç†å¿µ**ï¼šå„å–æ‰€é•¿ï¼Œæ··åˆä½¿ç”¨ä¸åŒAIå¹³å°çš„ä¼˜åŠ¿èƒ½åŠ›
- ğŸ“¸ **å›¾åƒç”Ÿæˆ** - é€šä¹‰åƒé—® (å›¾ç‰‡è´¨é‡ä½³)
- ğŸ¬ **è§†é¢‘ç”Ÿæˆ** - è±†åŒ… (è§†é¢‘æ•ˆæœå¥½)
- ğŸµ **éŸ³é¢‘å¤„ç†** - æ–‡å¿ƒä¸€è¨€ (éŸ³é¢‘æŠ€æœ¯å¼º)
- ğŸ’° **æˆæœ¬æ§åˆ¶** - æ ¹æ®ä»·æ ¼é€‰æ‹©æœ€ä¼˜å¹³å°
- ğŸŒ **åœ°åŸŸé€‚é…** - ä¸åŒåœ°åŒºä½¿ç”¨ä¸åŒå¹³å°

##### 1.2.2 æŒ‰å·¥å…·åŠŸèƒ½çš„é€‚é…å™¨æ¥å£è®¾è®¡
```python
from abc import ABC, abstractmethod
from typing import Dict, Any, List, Optional
from dataclasses import dataclass

@dataclass
class AIModelResult:
    """AIæ¨¡å‹è°ƒç”¨ç»“æœ"""
    success: bool
    data: Optional[Dict[str, Any]] = None
    files: Optional[List[str]] = None  # ç”Ÿæˆçš„æ–‡ä»¶URLåˆ—è¡¨
    error_message: Optional[str] = None
    metadata: Optional[Dict[str, Any]] = None  # æ¨¡å‹è¿”å›çš„å…ƒæ•°æ®

# ===== æŒ‰å·¥å…·åŠŸèƒ½åˆ†åˆ«å®šä¹‰é€‚é…å™¨åŸºç±» =====

class BaseT2IAdapter(ABC):
    """æ–‡ç”Ÿå›¾é€‚é…å™¨åŸºç±»"""

    @abstractmethod
    def text_to_image(self, prompt: str, aspect_ratio: str, **kwargs) -> AIModelResult:
        """æ–‡ç”Ÿå›¾æ¥å£"""
        pass

class BaseI2IAdapter(ABC):
    """å›¾ç”Ÿå›¾é€‚é…å™¨åŸºç±»"""

    @abstractmethod
    def image_to_image(self, prompt: str, source_image: str, aspect_ratio: str, **kwargs) -> AIModelResult:
        """å›¾ç”Ÿå›¾æ¥å£"""
        pass

class BaseI2VAdapter(ABC):
    """å›¾ç”Ÿè§†é¢‘é€‚é…å™¨åŸºç±»"""

    @abstractmethod
    def image_to_video(self, prompt: str, source_image: str, aspect_ratio: str, **kwargs) -> AIModelResult:
        """å›¾ç”Ÿè§†é¢‘æ¥å£"""
        pass

class BaseT2VAdapter(ABC):
    """æ–‡ç”Ÿè§†é¢‘é€‚é…å™¨åŸºç±»"""

    @abstractmethod
    def text_to_video(self, prompt: str, aspect_ratio: str, **kwargs) -> AIModelResult:
        """æ–‡ç”Ÿè§†é¢‘æ¥å£"""
        pass

class BaseMusicGenAdapter(ABC):
    """éŸ³ä¹ç”Ÿæˆé€‚é…å™¨åŸºç±»"""

    @abstractmethod
    def generate_music(self, prompt: str, **kwargs) -> AIModelResult:
        """éŸ³ä¹ç”Ÿæˆæ¥å£"""
        pass

class BaseTTS_Adapter(ABC):
    """æ–‡æœ¬è½¬è¯­éŸ³é€‚é…å™¨åŸºç±»"""

    @abstractmethod
    def text_to_speech(self, text: str, voice_id: str, **kwargs) -> AIModelResult:
        """æ–‡æœ¬è½¬è¯­éŸ³æ¥å£"""
        pass

class BaseASR_Adapter(ABC):
    """è¯­éŸ³è½¬å­—å¹•é€‚é…å™¨åŸºç±»"""

    @abstractmethod
    def speech_to_subtitle(self, audio_url: str, language: str, **kwargs) -> AIModelResult:
        """è¯­éŸ³è½¬å­—å¹•æ¥å£"""
        pass

# ===== å·¥å…·é€‚é…å™¨å·¥å‚ç±» =====

class ToolAdapterFactory:
    """å·¥å…·é€‚é…å™¨å·¥å‚ç±»"""

    _adapters = {
        "text_to_image": {},      # å­˜å‚¨æ–‡ç”Ÿå›¾é€‚é…å™¨
        "image_to_image": {},     # å­˜å‚¨å›¾ç”Ÿå›¾é€‚é…å™¨
        "image_to_video": {},     # å­˜å‚¨å›¾ç”Ÿè§†é¢‘é€‚é…å™¨
        "text_to_video": {},      # å­˜å‚¨æ–‡ç”Ÿè§†é¢‘é€‚é…å™¨
        "generate_music": {},     # å­˜å‚¨éŸ³ä¹ç”Ÿæˆé€‚é…å™¨
        "text_to_speech": {},     # å­˜å‚¨è¯­éŸ³åˆæˆé€‚é…å™¨
        "speech_to_subtitle": {}  # å­˜å‚¨è¯­éŸ³è¯†åˆ«é€‚é…å™¨
    }

    @classmethod
    def register_adapter(cls, tool_type: str, platform: str, adapter_class):
        """æ³¨å†Œå·¥å…·é€‚é…å™¨"""
        if tool_type not in cls._adapters:
            raise ValueError(f"Unknown tool type: {tool_type}")
        cls._adapters[tool_type][platform] = adapter_class

    @classmethod
    def create_adapter(cls, tool_type: str, platform: str, config: Dict[str, Any]):
        """åˆ›å»ºå·¥å…·é€‚é…å™¨å®ä¾‹"""
        if tool_type not in cls._adapters:
            raise ValueError(f"Unknown tool type: {tool_type}")

        if platform not in cls._adapters[tool_type]:
            raise ValueError(f"Platform {platform} not available for {tool_type}")

        adapter_class = cls._adapters[tool_type][platform]
        return adapter_class(config)

    @classmethod
    def list_platforms(cls, tool_type: str) -> List[str]:
        """åˆ—å‡ºæŒ‡å®šå·¥å…·ç±»å‹çš„å¯ç”¨å¹³å°"""
        if tool_type not in cls._adapters:
            return []
        return list(cls._adapters[tool_type].keys())

    @classmethod
    def list_all_capabilities(cls) -> Dict[str, List[str]]:
        """åˆ—å‡ºæ‰€æœ‰å·¥å…·ç±»å‹åŠå…¶å¯ç”¨å¹³å°"""
        return {
            tool_type: list(platforms.keys())
            for tool_type, platforms in cls._adapters.items()
        }
```

##### 1.2.3 æŒ‰å·¥å…·åŠŸèƒ½çš„é€‚é…å™¨å®ç°ç¤ºä¾‹

```python
import requests
import time
from typing import Dict, Any, Optional

# ===== è±†åŒ…åŸºç¡€è¿æ¥ç±» =====
class DouBaoBase:
    """è±†åŒ…åŸºç¡€è¿æ¥ç±»"""

    def __init__(self, config: Dict[str, Any]):
        self.api_key = config.get("api_key")
        self.base_url = config.get("base_url", "https://ark.cn-beijing.volces.com")
        self.default_model = config.get("default_model", "doubao-seedance-1-0-pro-250528")
        self.timeout = config.get("timeout", 60)
        self.headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.api_key}"
        }

    def _make_request(self, endpoint: str, payload: Dict = None, method: str = "POST") -> Dict:
        """å‘èµ·HTTPè¯·æ±‚çš„é€šç”¨æ–¹æ³•"""
        url = f"{self.base_url}{endpoint}"

        try:
            if method == "POST":
                response = requests.post(url, json=payload, headers=self.headers, timeout=self.timeout)
            elif method == "GET":
                response = requests.get(url, headers=self.headers, timeout=self.timeout)
            else:
                raise ValueError(f"ä¸æ”¯æŒçš„HTTPæ–¹æ³•: {method}")

            response.raise_for_status()
            return response.json()

        except requests.exceptions.RequestException as e:
            return {"success": False, "message": str(e)}

    def _poll_task_status(self, task_id: str, max_attempts: int = 60, interval: int = 10) -> Dict[str, Any]:
        """è½®è¯¢ä»»åŠ¡çŠ¶æ€ç›´åˆ°å®Œæˆ"""
        for attempt in range(max_attempts):
            try:
                status_response = self._make_request(f"/api/v3/contents/generations/tasks/{task_id}", method="GET")

                if not status_response:
                    continue

                status = status_response.get("status")

                if status == "completed":
                    files = []
                    if "result" in status_response and "videos" in status_response["result"]:
                        files = [video["url"] for video in status_response["result"]["videos"]]
                    elif "result" in status_response and "images" in status_response["result"]:
                        files = [img["url"] for img in status_response["result"]["images"]]

                    return {"success": True, "files": files, "data": status_response}
                elif status == "failed":
                    error_msg = status_response.get("error", {}).get("message", "ä»»åŠ¡å¤±è´¥")
                    return {"success": False, "error_message": error_msg}
                elif status in ["pending", "processing"]:
                    time.sleep(interval)
                    continue
                else:
                    time.sleep(interval)
                    continue

            except Exception as e:
                if attempt == max_attempts - 1:
                    return {"success": False, "error_message": f"è½®è¯¢ä»»åŠ¡çŠ¶æ€å¤±è´¥: {str(e)}"}
                time.sleep(interval)

        return {"success": False, "error_message": f"ä»»åŠ¡è¶…æ—¶ï¼Œæœ€å¤§ç­‰å¾…æ—¶é—´: {max_attempts * interval}ç§’"}

# ===== è±†åŒ…å›¾ç”Ÿè§†é¢‘é€‚é…å™¨ï¼ˆä¸“ä¸šå®ç°ï¼‰=====
class DouBaoI2VAdapter(BaseI2VAdapter, DouBaoBase):
    """è±†åŒ…å›¾ç”Ÿè§†é¢‘é€‚é…å™¨ - ä¸“ä¸šå®ç°"""

    def image_to_video(self, prompt: str, source_image: str, aspect_ratio: str, **kwargs) -> AIModelResult:
        """è±†åŒ…å›¾ç”Ÿè§†é¢‘ä¸“ä¸šå®ç°"""
        try:
            content = [
                {
                    "type": "text",
                    "text": self._build_video_prompt(prompt, aspect_ratio, **kwargs)
                },
                {
                    "type": "image_url",
                    "image_url": {"url": source_image}
                }
            ]

            payload = {
                "model": kwargs.get("model", self.default_model),
                "content": content
            }

            task_response = self._make_request("/api/v3/contents/generations/tasks", payload, method="POST")

            if not task_response.get("success") or "id" not in task_response:
                return AIModelResult(
                    success=False,
                    error_message=task_response.get("message", "åˆ›å»ºä»»åŠ¡å¤±è´¥")
                )

            video_result = self._poll_task_status(task_response["id"])

            if video_result["success"]:
                return AIModelResult(
                    success=True,
                    files=video_result["files"],
                    data=video_result["data"],
                    metadata={
                        "platform": "doubao",
                        "tool_type": "image_to_video",
                        "model": self.default_model,
                        "task_id": task_response["id"]
                    }
                )
            else:
                return AIModelResult(success=False, error_message=video_result["error_message"])

        except Exception as e:
            return AIModelResult(success=False, error_message=str(e))

    def _build_video_prompt(self, prompt: str, aspect_ratio: str, **kwargs) -> str:
        """æ„å»ºè±†åŒ…è§†é¢‘ç”Ÿæˆæç¤ºè¯"""
        video_prompt = prompt

        resolution_map = {
            "16:9": "1080p", "9:16": "720p", "1:1": "720p", "4:3": "720p"
        }
        resolution = resolution_map.get(aspect_ratio, "1080p")
        video_prompt += f" --resolution {resolution}"

        duration = kwargs.get("duration", 5)
        video_prompt += f" --duration {duration}"

        camera_fixed = kwargs.get("camera_fixed", False)
        video_prompt += f" --camerafixed {str(camera_fixed).lower()}"

        watermark = kwargs.get("watermark", True)
        video_prompt += f" --watermark {str(watermark).lower()}"

        return video_prompt

# ===== è±†åŒ…æ–‡ç”Ÿè§†é¢‘é€‚é…å™¨ï¼ˆä¸“ä¸šå®ç°ï¼‰=====
class DouBaoT2VAdapter(BaseT2VAdapter, DouBaoBase):
    """è±†åŒ…æ–‡ç”Ÿè§†é¢‘é€‚é…å™¨ - ä¸“ä¸šå®ç°"""

    def text_to_video(self, prompt: str, aspect_ratio: str, **kwargs) -> AIModelResult:
        """è±†åŒ…æ–‡ç”Ÿè§†é¢‘ä¸“ä¸šå®ç°"""
        try:
            content = [{"type": "text", "text": self._build_video_prompt(prompt, aspect_ratio, **kwargs)}]
            payload = {"model": kwargs.get("model", self.default_model), "content": content}

            task_response = self._make_request("/api/v3/contents/generations/tasks", payload, method="POST")

            if not task_response.get("success") or "id" not in task_response:
                return AIModelResult(success=False, error_message=task_response.get("message", "åˆ›å»ºä»»åŠ¡å¤±è´¥"))

            video_result = self._poll_task_status(task_response["id"])

            if video_result["success"]:
                return AIModelResult(
                    success=True,
                    files=video_result["files"],
                    data=video_result["data"],
                    metadata={
                        "platform": "doubao",
                        "tool_type": "text_to_video",
                        "model": self.default_model,
                        "task_id": task_response["id"]
                    }
                )
            else:
                return AIModelResult(success=False, error_message=video_result["error_message"])

        except Exception as e:
            return AIModelResult(success=False, error_message=str(e))

    def _build_video_prompt(self, prompt: str, aspect_ratio: str, **kwargs) -> str:
        """æ„å»ºè§†é¢‘æç¤ºè¯ï¼ˆä¸I2Vå…±äº«é€»è¾‘ï¼‰"""
        return DouBaoI2VAdapter._build_video_prompt(self, prompt, aspect_ratio, **kwargs)

# ===== è±†åŒ…å…¶ä»–å·¥å…·é€‚é…å™¨ï¼ˆåŸºç¡€å®ç°ï¼Œä½œä¸ºå¤‡ç”¨ï¼‰=====
class DouBaoT2IAdapter(BaseT2IAdapter, DouBaoBase):
    """è±†åŒ…æ–‡ç”Ÿå›¾é€‚é…å™¨ - åŸºç¡€å®ç°ï¼ˆå¤‡ç”¨ï¼‰"""

    def text_to_image(self, prompt: str, aspect_ratio: str, **kwargs) -> AIModelResult:
        """è±†åŒ…æ–‡ç”Ÿå›¾åŸºç¡€å®ç°"""
        # TODO: å®ç°è±†åŒ…æ–‡ç”Ÿå›¾API
        return AIModelResult(success=False, error_message="è±†åŒ…æ–‡ç”Ÿå›¾æ¥å£å¾…å®ç°")

class DouBaoASRAdapter(BaseASR_Adapter, DouBaoBase):
    """è±†åŒ…è¯­éŸ³è¯†åˆ«é€‚é…å™¨ - ä¸“ä¸šå®ç°"""

    def speech_to_subtitle(self, audio_url: str, language: str, **kwargs) -> AIModelResult:
        """è±†åŒ…è¯­éŸ³è¯†åˆ«ä¸“ä¸šå®ç°"""
        # TODO: å®ç°è±†åŒ…ASR API
        return AIModelResult(success=False, error_message="è±†åŒ…ASRæ¥å£å¾…å®ç°")

# ===== é€‚é…å™¨æ³¨å†Œç¤ºä¾‹ =====
def register_doubao_adapters():
    """æ³¨å†Œè±†åŒ…çš„æ‰€æœ‰å·¥å…·é€‚é…å™¨"""
    # è±†åŒ…çš„å¼ºé¡¹ï¼šè§†é¢‘ç”Ÿæˆ
    ToolAdapterFactory.register_adapter("image_to_video", "doubao", DouBaoI2VAdapter)
    ToolAdapterFactory.register_adapter("text_to_video", "doubao", DouBaoT2VAdapter)
    ToolAdapterFactory.register_adapter("speech_to_subtitle", "doubao", DouBaoASRAdapter)

    # è±†åŒ…çš„å¤‡ç”¨åŠŸèƒ½
    ToolAdapterFactory.register_adapter("text_to_image", "doubao", DouBaoT2IAdapter)

# é€šä¹‰åƒé—®é€‚é…å™¨æ³¨å†Œç¤ºä¾‹ï¼ˆä¸“ç²¾å›¾åƒç”Ÿæˆï¼‰
def register_tongyi_adapters():
    """æ³¨å†Œé€šä¹‰åƒé—®çš„å·¥å…·é€‚é…å™¨"""
    # é€šä¹‰çš„å¼ºé¡¹ï¼šå›¾åƒç”Ÿæˆ
    ToolAdapterFactory.register_adapter("text_to_image", "tongyi", TongYiT2IAdapter)
    ToolAdapterFactory.register_adapter("image_to_image", "tongyi", TongYiI2IAdapter)

    # é€šä¹‰çš„å¤‡ç”¨åŠŸèƒ½
    ToolAdapterFactory.register_adapter("image_to_video", "tongyi", TongYiI2VAdapter)

# æ–‡å¿ƒä¸€è¨€é€‚é…å™¨æ³¨å†Œç¤ºä¾‹ï¼ˆä¸“ç²¾éŸ³é¢‘å¤„ç†ï¼‰
def register_wenxin_adapters():
    """æ³¨å†Œæ–‡å¿ƒä¸€è¨€çš„å·¥å…·é€‚é…å™¨"""
    # æ–‡å¿ƒçš„å¼ºé¡¹ï¼šéŸ³é¢‘å¤„ç†
    ToolAdapterFactory.register_adapter("generate_music", "wenxin", WenXinMusicAdapter)
    ToolAdapterFactory.register_adapter("text_to_speech", "wenxin", WenXinTTSAdapter)

    # æ–‡å¿ƒçš„å¤‡ç”¨åŠŸèƒ½
    ToolAdapterFactory.register_adapter("text_to_image", "wenxin", WenXinT2IAdapter)
```

##### 1.2.4 æŒ‰å·¥å…·åŠŸèƒ½çš„é…ç½®ç®¡ç†
```yaml
# config/tool_adapters.yaml
platforms:
  doubao:
    config:
      api_key: "${DOUBAO_API_KEY}"
      base_url: "https://ark.cn-beijing.volces.com"
      default_model: "doubao-seedance-1-0-pro-250528"
      timeout: 60
    capabilities:
      strong_tools: ["image_to_video", "text_to_video", "speech_to_subtitle"]
      backup_tools: ["text_to_image"]
      cost_level: "medium"
      quality_scores:
        image_to_video: 9.0
        text_to_video: 9.0
        speech_to_subtitle: 8.5
        text_to_image: 6.5

  tongyi:
    config:
      api_key: "${TONGYI_API_KEY}"
      base_url: "https://dashscope.aliyuncs.com"
      timeout: 30
    capabilities:
      strong_tools: ["text_to_image", "image_to_image"]
      backup_tools: ["image_to_video", "text_to_video"]
      cost_level: "low"
      quality_scores:
        text_to_image: 9.5
        image_to_image: 9.0
        image_to_video: 7.0

  wenxin:
    config:
      api_key: "${WENXIN_API_KEY}"
      base_url: "https://aip.baidubce.com"
      timeout: 45
    capabilities:
      strong_tools: ["generate_music", "text_to_speech"]
      backup_tools: ["text_to_image"]
      cost_level: "low"
      quality_scores:
        generate_music: 8.5
        text_to_speech: 8.8
        text_to_image: 6.0

# å·¥å…·é€‰æ‹©ç­–ç•¥
tool_strategy:
  primary_platforms:
    text_to_image: "tongyi"        # é€šä¹‰è´¨é‡æœ€å¥½
    image_to_image: "tongyi"       # é€šä¹‰ä¸“ä¸š
    image_to_video: "doubao"       # è±†åŒ…ä¸“ä¸š
    text_to_video: "doubao"        # è±†åŒ…ä¸“ä¸š
    generate_music: "wenxin"       # æ–‡å¿ƒä¸“ä¸š
    text_to_speech: "wenxin"       # æ–‡å¿ƒä¸“ä¸š
    speech_to_subtitle: "doubao"   # è±†åŒ…ä¸“ä¸š

  fallback_platforms:
    text_to_image: ["doubao", "wenxin"]
    image_to_image: ["doubao", "wenxin"]
    image_to_video: ["tongyi", "wenxin"]
    text_to_video: ["tongyi", "wenxin"]
    generate_music: ["doubao", "tongyi"]
    text_to_speech: ["doubao", "tongyi"]
    speech_to_subtitle: ["tongyi", "wenxin"]
```

##### 1.2.5 æŒ‰å·¥å…·åŠŸèƒ½çš„æ™ºèƒ½é€‰æ‹©å™¨
```python
class ToolAdapterSelector:
    """æŒ‰å·¥å…·åŠŸèƒ½çš„æ™ºèƒ½é€‚é…å™¨é€‰æ‹©å™¨"""

    def __init__(self, config):
        self.config = config
        self.strategy = config["tool_strategy"]
        self.factory = ToolAdapterFactory()
        self.performance_tracker = ToolPerformanceTracker()

    def get_best_adapter(self, tool_type: str, context: Dict = None):
        """ä¸ºç‰¹å®šå·¥å…·é€‰æ‹©æœ€ä½³é€‚é…å™¨"""
        # 1. è·å–é¦–é€‰å¹³å°
        primary_platform = self.strategy["primary_platforms"].get(tool_type)

        # 2. æ£€æŸ¥é¦–é€‰å¹³å°æ˜¯å¦å¯ç”¨
        if primary_platform and self._is_platform_available(tool_type, primary_platform):
            adapter = self.factory.create_adapter(tool_type, primary_platform,
                                                  self.config["platforms"][primary_platform]["config"])
            self._log_usage(tool_type, primary_platform, "primary")
            return adapter

        # 3. ä½¿ç”¨é™çº§ç­–ç•¥
        fallback_platforms = self.strategy["fallback_platforms"].get(tool_type, [])
        for platform in fallback_platforms:
            if self._is_platform_available(tool_type, platform):
                adapter = self.factory.create_adapter(tool_type, platform,
                                                      self.config["platforms"][platform]["config"])
                self._log_usage(tool_type, platform, "fallback")
                return adapter

        # 4. æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„å¹³å°
        available_platforms = self.factory.list_platforms(tool_type)
        raise Exception(f"å·¥å…· {tool_type} æ²¡æœ‰å¯ç”¨çš„å¹³å°ã€‚å¯ç”¨å¹³å°: {available_platforms}")

    def _is_platform_available(self, tool_type: str, platform: str) -> bool:
        """æ£€æŸ¥å¹³å°å¯¹æŒ‡å®šå·¥å…·æ˜¯å¦å¯ç”¨"""
        try:
            # æ£€æŸ¥å¹³å°æ˜¯å¦æ”¯æŒè¯¥å·¥å…·
            if platform not in self.factory.list_platforms(tool_type):
                return False

            # æ£€æŸ¥å¹³å°é…ç½®å’Œè´¨é‡è¦æ±‚
            platform_config = self.config["platforms"].get(platform, {})
            capabilities = platform_config.get("capabilities", {})

            # æ£€æŸ¥è´¨é‡åˆ†æ•°
            quality_scores = capabilities.get("quality_scores", {})
            tool_quality = quality_scores.get(tool_type, 0)

            # è´¨é‡å¤ªä½åˆ™ä¸ä½¿ç”¨
            if tool_quality < 6.0:
                return False

            return self._health_check(platform)

        except Exception:
            return False

    def _health_check(self, platform: str) -> bool:
        """å¹³å°å¥åº·æ£€æŸ¥"""
        # TODO: å®ç°å¹³å°è¿é€šæ€§æ£€æŸ¥
        return True

    def _log_usage(self, tool_type: str, platform: str, usage_type: str):
        """è®°å½•ä½¿ç”¨æƒ…å†µ"""
        self.performance_tracker.record_usage(tool_type, platform, usage_type)

class AIToolExecutor:
    """æŒ‰å·¥å…·åŠŸèƒ½çš„AIå·¥å…·æ‰§è¡Œå™¨"""

    def __init__(self):
        self.config = load_config("tool_adapters.yaml")
        self.selector = ToolAdapterSelector(self.config)

    def execute_text2img_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œæ–‡ç”Ÿå›¾å·¥å…· - è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¹³å°ï¼ˆé»˜è®¤é€šä¹‰åƒé—®ï¼‰"""
        adapter = self.selector.get_best_adapter("text_to_image")

        result = adapter.text_to_image(
            prompt=tool_request["input_data"]["prompt"],
            aspect_ratio=tool_request["input_data"]["aspect_ratio"]
        )

        return self._format_result(result, "text_to_image")

    def execute_img2video_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œå›¾ç”Ÿè§†é¢‘å·¥å…· - è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¹³å°ï¼ˆé»˜è®¤è±†åŒ…ï¼‰"""
        adapter = self.selector.get_best_adapter("image_to_video")

        result = adapter.image_to_video(
            prompt=tool_request["input_data"]["prompt"],
            source_image=tool_request["input_data"]["source_image_url"],
            aspect_ratio=tool_request["input_data"]["aspect_ratio"]
        )

        return self._format_result(result, "image_to_video")

    def execute_music_gen_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡ŒéŸ³ä¹ç”Ÿæˆå·¥å…· - è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¹³å°ï¼ˆé»˜è®¤æ–‡å¿ƒï¼‰"""
        adapter = self.selector.get_best_adapter("generate_music")

        result = adapter.generate_music(
            prompt=tool_request["input_data"]["prompt"]
        )

        return self._format_result(result, "generate_music")

    def execute_img2img_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œå›¾ç”Ÿå›¾å·¥å…· - è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¹³å°ï¼ˆé»˜è®¤é€šä¹‰åƒé—®ï¼‰"""
        adapter = self.selector.get_best_adapter("image_to_image")

        result = adapter.image_to_image(
            prompt=tool_request["input_data"]["prompt"],
            source_image=tool_request["input_data"]["source_image_url"],
            aspect_ratio=tool_request["input_data"]["aspect_ratio"]
        )

        return self._format_result(result, "image_to_image")

    def execute_text2video_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œæ–‡ç”Ÿè§†é¢‘å·¥å…· - è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¹³å°ï¼ˆé»˜è®¤è±†åŒ…ï¼‰"""
        adapter = self.selector.get_best_adapter("text_to_video")

        result = adapter.text_to_video(
            prompt=tool_request["input_data"]["prompt"],
            aspect_ratio=tool_request["input_data"]["aspect_ratio"]
        )

        return self._format_result(result, "text_to_video")

    def execute_text2speech_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œæ–‡æ¡ˆè½¬è¯­éŸ³å·¥å…· - è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¹³å°ï¼ˆé»˜è®¤æ–‡å¿ƒï¼‰"""
        adapter = self.selector.get_best_adapter("text_to_speech")

        result = adapter.text_to_speech(
            text=tool_request["input_data"]["text"],
            voice_id=tool_request["input_data"]["voice_id"],
            speed=tool_request["input_data"].get("speed", 1.0)
        )

        return self._format_result(result, "text_to_speech")

    def execute_speech2subtitle_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œè¯­éŸ³è½¬å­—å¹•å·¥å…· - è‡ªåŠ¨é€‰æ‹©æœ€ä½³å¹³å°ï¼ˆé»˜è®¤æ–‡å¿ƒï¼‰"""
        adapter = self.selector.get_best_adapter("speech_to_subtitle")

        result = adapter.speech_to_subtitle(
            audio_url=tool_request["input_data"]["audio_url"],
            language=tool_request["input_data"].get("language", "zh-CN")
        )

        return self._format_result(result, "speech_to_subtitle")

    def execute_video_merge_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œè§†é¢‘åˆå¹¶å·¥å…· - æœ¬åœ°å¤„ç†"""
        # è§†é¢‘åˆå¹¶ä½¿ç”¨æœ¬åœ°FFmpegå¤„ç†ï¼Œä¸éœ€è¦AIå¹³å°
        from .local_tools import VideoMerger

        merger = VideoMerger()
        result = merger.merge_videos(
            video_urls=tool_request["input_data"]["video_urls"],
            transition_type=tool_request["input_data"].get("transition_type", "fade")
        )

        return self._format_result_local(result, "video_merge")

    def execute_audio_video_merge_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡ŒéŸ³è§†é¢‘åˆå¹¶å·¥å…· - æœ¬åœ°å¤„ç†"""
        # éŸ³è§†é¢‘åˆå¹¶ä½¿ç”¨æœ¬åœ°FFmpegå¤„ç†
        from .local_tools import AudioVideoMerger

        merger = AudioVideoMerger()
        result = merger.merge_audio_video(
            video_url=tool_request["input_data"]["video_url"],
            audio_url=tool_request["input_data"]["audio_url"],
            audio_volume=tool_request["input_data"].get("audio_volume", 0.8)
        )

        return self._format_result_local(result, "audio_video_merge")

    def execute_subtitle_video_merge_tool(self, tool_request: Dict[str, Any]) -> Dict[str, Any]:
        """æ‰§è¡Œå­—å¹•è§†é¢‘åˆå¹¶å·¥å…· - æœ¬åœ°å¤„ç†"""
        # å­—å¹•åˆå¹¶ä½¿ç”¨æœ¬åœ°FFmpegå¤„ç†
        from .local_tools import SubtitleVideoMerger

        merger = SubtitleVideoMerger()
        result = merger.add_subtitle_to_video(
            video_url=tool_request["input_data"]["video_url"],
            subtitle_text=tool_request["input_data"]["subtitle_text"],
            font_size=tool_request["input_data"].get("font_size", 24)
        )

        return self._format_result_local(result, "subtitle_video_merge")

    def _format_result(self, result: AIModelResult, tool_type: str) -> Dict[str, Any]:
        """æ ¼å¼åŒ–ç»“æœ"""
        if result.success:
            return {
                "success": True,
                "output_data": result.data,
                "original_files": result.files,
                "metadata": {
                    **result.metadata,
                    "tool_type": tool_type,
                    "selected_platform": result.metadata.get("platform", "unknown")
                }
            }
        else:
            return {
                "success": False,
                "error_message": result.error_message
            }

    def _format_result_local(self, result: Dict[str, Any], tool_type: str) -> Dict[str, Any]:
        """æ ¼å¼åŒ–æœ¬åœ°å·¥å…·ç»“æœ"""
        if result.get("success", False):
            return {
                "success": True,
                "output_data": result.get("data", {}),
                "original_files": result.get("files", []),
                "metadata": {
                    "tool_type": tool_type,
                    "selected_platform": "local"
                }
            }
        else:
            return {
                "success": False,
                "error_message": result.get("error_message", "æœ¬åœ°å·¥å…·æ‰§è¡Œå¤±è´¥")
            }
```

##### 1.2.6 æ¨¡å‹åˆ‡æ¢ç­–ç•¥

**åŠ¨æ€æ¨¡å‹åˆ‡æ¢**ï¼š
```python
class AdapterSwitchStrategy:
    """é€‚é…å™¨åˆ‡æ¢ç­–ç•¥"""

    def __init__(self):
        self.performance_metrics = {}  # æ€§èƒ½æŒ‡æ ‡è®°å½•
        self.cost_metrics = {}         # æˆæœ¬æŒ‡æ ‡è®°å½•
        self.failure_counts = {}       # å¤±è´¥è®¡æ•°

    def should_switch_adapter(self, current_adapter: str, tool_type: str) -> Optional[str]:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥åˆ‡æ¢é€‚é…å™¨"""
        # åŸºäºå¤±è´¥ç‡åˆ‡æ¢
        if self.failure_counts.get(current_adapter, 0) > 3:
            return self._get_backup_adapter(current_adapter, tool_type)

        # åŸºäºæ€§èƒ½åˆ‡æ¢
        if self._is_performance_degraded(current_adapter, tool_type):
            return self._get_better_performance_adapter(tool_type)

        return None

    def _get_backup_adapter(self, failed_adapter: str, tool_type: str) -> str:
        """è·å–å¤‡ç”¨é€‚é…å™¨"""
        backup_map = {
            "doubao": "tongyi",
            "tongyi": "wenxin",
            "wenxin": "doubao"
        }
        return backup_map.get(failed_adapter, "doubao")
```

**é…ç½®çƒ­æ›´æ–°**ï¼š
```python
class AdapterConfigManager:
    """é€‚é…å™¨é…ç½®ç®¡ç†å™¨"""

    def __init__(self):
        self.config_file = "tool_adapters.yaml"
        self.config_cache = {}
        self.last_modified = 0

    def get_current_config(self) -> Dict[str, Any]:
        """è·å–å½“å‰é…ç½®ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰"""
        current_modified = os.path.getmtime(self.config_file)
        if current_modified > self.last_modified:
            self.config_cache = self._load_config()
            self.last_modified = current_modified
        return self.config_cache

    def switch_default_adapter(self, tool_type: str, new_adapter: str):
        """åˆ‡æ¢é»˜è®¤é€‚é…å™¨"""
        config = self.get_current_config()
        config[f"default_{tool_type}_adapter"] = new_adapter
        self._save_config(config)
```

##### 1.2.7 å·¥å…·è§„èŒƒ
- æ¯ä¸ªå·¥å…·å¿…é¡»æœ‰æ ‡å‡†çš„è¾“å…¥è¾“å‡ºæ ¼å¼
- æ”¯æŒJSON Schemaå®šä¹‰å‚æ•°ç»“æ„
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€æŠ¥å‘Š
- æ–‡ä»¶è¾“å…¥è¾“å‡ºè‡ªåŠ¨ç®¡ç†
- æ”¯æŒå¤šAIæ¨¡å‹åˆ‡æ¢çš„é€‚é…å™¨æ¨¡å¼
- é…ç½®é©±åŠ¨çš„æ¨¡å‹é€‰æ‹©æœºåˆ¶
- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢å’Œæ•…éšœè½¬ç§»
- æ€§èƒ½ç›‘æ§å’Œæˆæœ¬æ§åˆ¶æœºåˆ¶


##### 1.2.4 è±†åŒ…APIæ¥å£æ‰©å±•è®¡åˆ’

åŸºäºå½“å‰çš„å›¾ç”Ÿè§†é¢‘æ¥å£å®ç°æ¨¡å¼ï¼Œå…¶ä»–è±†åŒ…APIæ¥å£éœ€è¦æŒ‰ç…§ç±»ä¼¼çš„å¼‚æ­¥ä»»åŠ¡æ¨¡å¼å®ç°ï¼š

**1. æ–‡ç”Ÿå›¾æ¥å£**
- é¢„è®¡ä½¿ç”¨ç›¸åŒçš„ä»»åŠ¡åˆ›å»ºå’Œè½®è¯¢æ¨¡å¼
- endpoint: `/api/v3/contents/generations/tasks`
- æ¨¡å‹å‚æ•°éœ€è¦è°ƒæ•´ä¸ºå›¾åƒç”Ÿæˆæ¨¡å‹

**2. å›¾ç”Ÿå›¾æ¥å£**
- ä¸å›¾ç”Ÿè§†é¢‘ç±»ä¼¼ï¼Œéœ€è¦åœ¨contentä¸­åŒ…å«source_image
- ä½¿ç”¨ç›¸åŒçš„ä»»åŠ¡ç®¡ç†API

**3. éŸ³ä¹ç”Ÿæˆæ¥å£**
- å¯èƒ½ä½¿ç”¨ç‹¬ç«‹çš„éŸ³é¢‘ç”ŸæˆAPIç«¯ç‚¹
- éœ€è¦æ”¯æŒéŸ³ä¹é£æ ¼ã€æ—¶é•¿ç­‰å‚æ•°

**4. æ–‡æœ¬è½¬è¯­éŸ³æ¥å£**
- å¯èƒ½æ”¯æŒå®æ—¶æˆ–è¿‘å®æ—¶è½¬æ¢
- éœ€è¦æ”¯æŒä¸åŒçš„å£°éŸ³IDé€‰æ‹©

**5. è¯­éŸ³è½¬å­—å¹•æ¥å£**
- éœ€è¦ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
- æ”¯æŒå¤šè¯­è¨€è¯†åˆ«

##### 1.2.4 æ··åˆå¹³å°é…ç½®ç®¡ç†
```yaml
# config/ai_adapters.yaml
adapters:
  doubao:
    class: "adapters.doubao.DouBaoAdapter"
    config:
      api_key: "${DOUBAO_API_KEY}"
      base_url: "https://ark.cn-beijing.volces.com"
      default_model: "doubao-seedance-1-0-pro-250528"
      timeout: 60
    capabilities:
      strengths: ["image_to_video", "text_to_video", "speech_to_subtitle"]
      cost_level: "medium"
      quality_score: 8.5

  tongyi:
    class: "adapters.tongyi.TongYiAdapter"
    config:
      api_key: "${TONGYI_API_KEY}"
      base_url: "https://dashscope.aliyuncs.com"
      default_model: "wanx-v1"
      timeout: 30
    capabilities:
      strengths: ["text_to_image", "image_to_image"]
      cost_level: "low"
      quality_score: 9.0

  wenxin:
    class: "adapters.wenxin.WenXinAdapter"
    config:
      api_key: "${WENXIN_API_KEY}"
      base_url: "https://aip.baidubce.com"
      timeout: 45
    capabilities:
      strengths: ["generate_music", "text_to_speech"]
      cost_level: "low"
      quality_score: 8.0

# æŒ‰åŠŸèƒ½åˆ†é…æœ€ä½³å¹³å°ç­–ç•¥
platform_strategy:
  default_adapters:
    text_to_image: "tongyi"        # æ–‡ç”Ÿå›¾ç”¨é€šä¹‰ï¼ˆè´¨é‡å¥½ï¼‰
    image_to_image: "tongyi"       # å›¾ç”Ÿå›¾ç”¨é€šä¹‰
    image_to_video: "doubao"       # å›¾ç”Ÿè§†é¢‘ç”¨è±†åŒ…ï¼ˆæ•ˆæœä½³ï¼‰
    text_to_video: "doubao"        # æ–‡ç”Ÿè§†é¢‘ç”¨è±†åŒ…
    generate_music: "wenxin"       # éŸ³ä¹ç”Ÿæˆç”¨æ–‡å¿ƒï¼ˆæˆæœ¬ä½ï¼‰
    text_to_speech: "wenxin"       # è¯­éŸ³åˆæˆç”¨æ–‡å¿ƒ
    speech_to_subtitle: "doubao"   # è¯­éŸ³è¯†åˆ«ç”¨è±†åŒ…

  # é™çº§ç­–ç•¥ï¼šä¸»å¹³å°ä¸å¯ç”¨æ—¶çš„å¤‡é€‰
  fallback_adapters:
    text_to_image: ["doubao", "wenxin"]
    image_to_image: ["doubao", "wenxin"]
    image_to_video: ["tongyi", "wenxin"]
    text_to_video: ["tongyi", "wenxin"]
    generate_music: ["doubao", "tongyi"]
    text_to_speech: ["doubao", "tongyi"]
    speech_to_subtitle: ["tongyi", "wenxin"]

  # æˆæœ¬ä¼˜åŒ–ç­–ç•¥
  cost_optimization:
    enabled: true
    prefer_low_cost: true          # ä¼˜å…ˆä½¿ç”¨ä½æˆæœ¬å¹³å°
    quality_threshold: 7.0         # è´¨é‡é˜ˆå€¼ï¼Œä½äºæ­¤åˆ†æ•°ä¸ä½¿ç”¨

  # åœ°åŸŸç­–ç•¥
  region_strategy:
    china:
      preferred: ["tongyi", "wenxin", "doubao"]
    international:
      preferred: ["openai", "claude"]
```

##### 1.2.5 æŒ‰å·¥å…·åŠŸèƒ½çš„æ™ºèƒ½é€‰æ‹©å™¨
```python
class ToolAdapterSelector:
    """æŒ‰å·¥å…·åŠŸèƒ½çš„æ™ºèƒ½é€‚é…å™¨é€‰æ‹©å™¨"""

    def __init__(self, config):
        self.config = config
        self.strategy = config["tool_strategy"]
        self.factory = ToolAdapterFactory()
        self.performance_tracker = ToolPerformanceTracker()

    def get_best_adapter(self, tool_type: str, context: Dict = None):
        """ä¸ºç‰¹å®šå·¥å…·é€‰æ‹©æœ€ä½³é€‚é…å™¨"""
        # 1. è·å–é¦–é€‰å¹³å°
        primary_platform = self.strategy["primary_platforms"].get(tool_type)

        # 2. æ£€æŸ¥é¦–é€‰å¹³å°æ˜¯å¦å¯ç”¨
        if primary_platform and self._is_platform_available(tool_type, primary_platform):
            adapter = self.factory.create_adapter(tool_type, primary_platform,
                                                  self.config["platforms"][primary_platform]["config"])
            self._log_usage(tool_type, primary_platform, "primary")
            return adapter

        # 3. ä½¿ç”¨é™çº§ç­–ç•¥
        fallback_platforms = self.strategy["fallback_platforms"].get(tool_type, [])
        for platform in fallback_platforms:
            if self._is_platform_available(tool_type, platform):
                adapter = self.factory.create_adapter(tool_type, platform,
                                                      self.config["platforms"][platform]["config"])
                self._log_usage(tool_type, platform, "fallback")
                return adapter

        # 4. æ²¡æœ‰æ‰¾åˆ°å¯ç”¨çš„å¹³å°
        available_platforms = self.factory.list_platforms(tool_type)
        raise Exception(f"å·¥å…· {tool_type} æ²¡æœ‰å¯ç”¨çš„å¹³å°ã€‚å¯ç”¨å¹³å°: {available_platforms}")

    def _is_platform_available(self, tool_type: str, platform: str) -> bool:
        """æ£€æŸ¥å¹³å°å¯¹æŒ‡å®šå·¥å…·æ˜¯å¦å¯ç”¨"""
        try:
            # æ£€æŸ¥å¹³å°æ˜¯å¦æ”¯æŒè¯¥å·¥å…·
            if platform not in self.factory.list_platforms(tool_type):
                return False

            # æ£€æŸ¥å¹³å°é…ç½®å’Œè´¨é‡è¦æ±‚
            platform_config = self.config["platforms"].get(platform, {})
            capabilities = platform_config.get("capabilities", {})

            # æ£€æŸ¥è´¨é‡åˆ†æ•°
            quality_scores = capabilities.get("quality_scores", {})
            tool_quality = quality_scores.get(tool_type, 0)

            # è´¨é‡å¤ªä½åˆ™ä¸ä½¿ç”¨
            if tool_quality < 6.0:
                return False

            return self._health_check(platform)

        except Exception:
            return False

    def _health_check(self, platform: str) -> bool:
        """å¹³å°å¥åº·æ£€æŸ¥"""
        # TODO: å®ç°å¹³å°è¿é€šæ€§æ£€æŸ¥
        return True

    def _log_usage(self, tool_type: str, platform: str, usage_type: str):
        """è®°å½•ä½¿ç”¨æƒ…å†µ"""
        self.performance_tracker.record_usage(tool_type, platform, usage_type)
```



##### 1.2.6 æ¨¡å‹åˆ‡æ¢ç­–ç•¥

**åŠ¨æ€æ¨¡å‹åˆ‡æ¢**ï¼š
```python
class AdapterSwitchStrategy:
    """é€‚é…å™¨åˆ‡æ¢ç­–ç•¥"""

    def __init__(self):
        self.performance_metrics = {}  # æ€§èƒ½æŒ‡æ ‡è®°å½•
        self.cost_metrics = {}         # æˆæœ¬æŒ‡æ ‡è®°å½•
        self.failure_counts = {}       # å¤±è´¥è®¡æ•°

    def should_switch_adapter(self, current_adapter: str, tool_type: str) -> Optional[str]:
        """åˆ¤æ–­æ˜¯å¦åº”è¯¥åˆ‡æ¢é€‚é…å™¨"""
        # åŸºäºå¤±è´¥ç‡åˆ‡æ¢
        if self.failure_counts.get(current_adapter, 0) > 3:
            return self._get_backup_adapter(current_adapter, tool_type)

        # åŸºäºæ€§èƒ½åˆ‡æ¢
        if self._is_performance_degraded(current_adapter, tool_type):
            return self._get_better_performance_adapter(tool_type)

        return None

    def _get_backup_adapter(self, failed_adapter: str, tool_type: str) -> str:
        """è·å–å¤‡ç”¨é€‚é…å™¨"""
        backup_map = {
            "doubao": "tongyi",
            "tongyi": "wenxin",
            "wenxin": "doubao"
        }
        return backup_map.get(failed_adapter, "doubao")
```

**é…ç½®çƒ­æ›´æ–°**ï¼š
```python
class AdapterConfigManager:
    """é€‚é…å™¨é…ç½®ç®¡ç†å™¨"""

    def __init__(self):
        self.config_file = "ai_adapters.yaml"
        self.config_cache = {}
        self.last_modified = 0

    def get_current_config(self) -> Dict[str, Any]:
        """è·å–å½“å‰é…ç½®ï¼ˆæ”¯æŒçƒ­æ›´æ–°ï¼‰"""
        current_modified = os.path.getmtime(self.config_file)
        if current_modified > self.last_modified:
            self.config_cache = self._load_config()
            self.last_modified = current_modified
        return self.config_cache

    def switch_default_adapter(self, tool_type: str, new_adapter: str):
        """åˆ‡æ¢é»˜è®¤é€‚é…å™¨"""
        config = self.get_current_config()
        config[f"default_{tool_type}_adapter"] = new_adapter
        self._save_config(config)
```

##### 1.2.7 å·¥å…·è§„èŒƒ
- æ¯ä¸ªå·¥å…·å¿…é¡»æœ‰æ ‡å‡†çš„è¾“å…¥è¾“å‡ºæ ¼å¼
- æ”¯æŒJSON Schemaå®šä¹‰å‚æ•°ç»“æ„
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€æŠ¥å‘Š
- æ–‡ä»¶è¾“å…¥è¾“å‡ºè‡ªåŠ¨ç®¡ç†
- æ”¯æŒå¤šAIæ¨¡å‹åˆ‡æ¢çš„é€‚é…å™¨æ¨¡å¼
- é…ç½®é©±åŠ¨çš„æ¨¡å‹é€‰æ‹©æœºåˆ¶
- æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢å’Œæ•…éšœè½¬ç§»
- æ€§èƒ½ç›‘æ§å’Œæˆæœ¬æ§åˆ¶æœºåˆ¶

#### 1.2 å·¥å…·èŠ‚ç‚¹ï¼ˆç»“æ„ï¼‰

æ¯ä¸ªå·¥å…·èŠ‚ç‚¹çš„é€šç”¨ç»“æ„åŒ…å«ä»¥ä¸‹ä¸€çº§å­—æ®µï¼š

```json
{
  "id": "number",                   // æ•°æ®åº“ä¸»é”®ID
  "node_id": "string",              // èŠ‚ç‚¹å”¯ä¸€IDï¼Œæ ¼å¼ï¼šnode_{uuid}
  "tool_uuid": "string",            // å·¥å…·UUIDï¼Œå›ºå®šå€¼å¦‚tool-img-understand-001
  "tool_name": "string",            // å·¥å…·åç§°ï¼Œå¦‚"å›¾ç‰‡ç†è§£"
  "step_index": "number",           // æ‰§è¡Œæ­¥éª¤ç´¢å¼•ï¼Œä»0å¼€å§‹é€’å¢
  "status": "number",               // èŠ‚ç‚¹çŠ¶æ€ï¼š0-å¾…æ‰§è¡Œï¼Œ1-æ‰§è¡Œä¸­ï¼Œ2-å·²å®Œæˆï¼Œ3-å¤±è´¥
  "input_data": "object",           // è¾“å…¥æ•°æ®å¯¹è±¡ï¼ˆç»“æ„æ ¹æ®å·¥å…·ç±»å‹è€Œå®šï¼‰
  "output_data": "object",          // è¾“å‡ºæ•°æ®å¯¹è±¡ï¼ˆç»“æ„æ ¹æ®å·¥å…·ç±»å‹è€Œå®šï¼‰
  "output_files": "array",          // è¾“å‡ºæ–‡ä»¶åˆ—è¡¨ï¼ˆé¡¹ç›®å­˜å‚¨objectNameï¼‰
  "original_files": "array",        // åŸå§‹æ–‡ä»¶åˆ—è¡¨ï¼ˆç¬¬ä¸‰æ–¹APIè¿”å›é“¾æ¥ï¼‰
  "preview_required": "boolean",    // æ˜¯å¦éœ€è¦å‰ç«¯é¢„è§ˆ
  "error_message": "string",        // é”™è¯¯ä¿¡æ¯è¯¦æƒ…
  "create_time": "string",          // èŠ‚ç‚¹åˆ›å»ºæ—¶é—´
  "update_time": "string",          // èŠ‚ç‚¹æ›´æ–°æ—¶é—´
  "start_time": "string",           // å¼€å§‹æ‰§è¡Œæ—¶é—´
  "end_time": "string",             // æ‰§è¡Œå®Œæˆæ—¶é—´
  "duration_ms": "number",          // æ‰§è¡Œè€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
  "creator_id": "number",           // åˆ›å»ºè€…ç”¨æˆ·ID
  "workflow_id": "string",          // æ‰€å±å·¥ä½œæµID
  "parent_node_id": "string",       // çˆ¶èŠ‚ç‚¹IDï¼ˆç”¨äºæ„å»ºæ‰§è¡Œé“¾ï¼‰
  "child_node_ids": "array",        // å­èŠ‚ç‚¹IDåˆ—è¡¨
  "sort_order": "number",           // åœ¨å·¥ä½œæµä¸­çš„æ’åºé¡ºåº
  "retry_count": "number",          // é‡è¯•æ¬¡æ•°
  "max_retry": "number",            // æœ€å¤§é‡è¯•æ¬¡æ•°
  "execution_context": "object"     // æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆåŒ…å«é¡¹ç›®IDã€ä»»åŠ¡IDç­‰ï¼‰
}
```

#### å­—æ®µè¯¦ç»†è¯´æ˜

##### åŸºç¡€ä¿¡æ¯å­—æ®µ
- **id**: æ•°æ®åº“è‡ªå¢ä¸»é”®ï¼Œç”¨äºå…³è”æŸ¥è¯¢
- **node_id**: èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œåœ¨å·¥ä½œæµä¸­å”¯ä¸€ï¼Œæ ¼å¼é€šå¸¸ä¸º `node_{timestamp}_{random}`
- **tool_uuid**: å·¥å…·çš„å›ºå®šUUIDæ ‡è¯†ï¼Œå¯¹åº”å…·ä½“çš„AIå·¥å…·åŠŸèƒ½
- **tool_name**: å·¥å…·çš„å¯è¯»åç§°ï¼Œç”¨äºå‰ç«¯æ˜¾ç¤º
- **step_index**: åœ¨å·¥ä½œæµä¸­çš„æ‰§è¡Œé¡ºåºï¼Œä»0å¼€å§‹

##### çŠ¶æ€ç®¡ç†å­—æ®µ
- **status**: èŠ‚ç‚¹æ‰§è¡ŒçŠ¶æ€ï¼Œç”¨äºè·Ÿè¸ªæ‰§è¡Œè¿›åº¦å’Œé”™è¯¯å¤„ç†
- **retry_count/max_retry**: é‡è¯•æœºåˆ¶ç›¸å…³ï¼Œæ”¯æŒå¤±è´¥é‡è¯•
- **start_time/end_time/duration_ms**: æ‰§è¡Œæ—¶é—´è·Ÿè¸ªï¼Œç”¨äºæ€§èƒ½ç›‘æ§

##### æ•°æ®å­—æ®µ
- **input_data**: èŠ‚ç‚¹è¾“å…¥å‚æ•°ï¼Œç»“æ„æ ¹æ®å·¥å…·ç±»å‹åŠ¨æ€å˜åŒ–
- **output_data**: èŠ‚ç‚¹è¾“å‡ºç»“æœï¼ŒåŒ…å«ä¸»è¦ç»“æœå’Œå…ƒæ•°æ®ä¿¡æ¯
- **execution_context**: æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ŒåŒ…å«é¡¹ç›®ã€ä»»åŠ¡ç­‰å…³è”ä¿¡æ¯

##### æ–‡ä»¶ç®¡ç†å­—æ®µ
- **original_files**: ç¬¬ä¸‰æ–¹APIè¿”å›çš„åŸå§‹æ–‡ä»¶é“¾æ¥ï¼Œå¯èƒ½æ˜¯ä¸´æ—¶çš„
- **output_files**: è½¬æ¢åå­˜å‚¨åœ¨é¡¹ç›®æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ä¿¡æ¯
- æ¯ä¸ªæ–‡ä»¶å¯¹è±¡åŒ…å«å®Œæ•´çš„å…ƒæ•°æ®ï¼Œä¾¿äºæ–‡ä»¶ç®¡ç†å’Œè®¿é—®æ§åˆ¶

##### å·¥ä½œæµå…³ç³»å­—æ®µ
- **workflow_id**: æ ‡è¯†èŠ‚ç‚¹æ‰€å±çš„å·¥ä½œæµ
- **parent_node_id/child_node_ids**: æ„å»ºèŠ‚ç‚¹é—´çš„ä¾èµ–å…³ç³»
- **sort_order**: ç¡®ä¿èŠ‚ç‚¹æŒ‰æ­£ç¡®é¡ºåºæ‰§è¡Œ

##### ç”¨æˆ·å…³è”å­—æ®µ
- **creator_id**: æ ‡è¯†åˆ›å»ºè¯¥èŠ‚ç‚¹çš„ç”¨æˆ·
- **preview_required**: æ§åˆ¶æ˜¯å¦éœ€è¦å‘å‰ç«¯æ¨é€é¢„è§ˆç»“æœ

#### æ–‡ä»¶å¤„ç†æœºåˆ¶è¯´æ˜

**original_files å­—æ®µ**ï¼š
- å­˜å‚¨ç¬¬ä¸‰æ–¹APIæˆ–æœ¬åœ°APIè¿”å›çš„åŸå§‹æ–‡ä»¶é“¾æ¥
- æ ¼å¼ï¼š`["https://api.example.com/files/abc123.jpg", "https://local.api/temp/video456.mp4"]`
- è¿™äº›æ–‡ä»¶å¯èƒ½æ˜¯ä¸´æ—¶é“¾æ¥ï¼Œéœ€è¦åŠæ—¶ä¸‹è½½å’Œè½¬å­˜

**output_files å­—æ®µ**ï¼š
- å­˜å‚¨é¡¹ç›®æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿä¸­çš„objectName
- æ ¼å¼ï¼š`["image/2024/12/abc123_processed.jpg", "video/2024/12/video456_final.mp4"]`
- è¿™äº›æ˜¯æŒä¹…åŒ–å­˜å‚¨çš„æ–‡ä»¶æ ‡è¯†ï¼Œå¯é•¿æœŸè®¿é—®

**æ–‡ä»¶è½¬æ¢æµç¨‹**ï¼š
1. å·¥å…·æ‰§è¡Œå®Œæˆåï¼Œä»`original_files`ä¸­è·å–åŸå§‹æ–‡ä»¶é“¾æ¥
2. ç³»ç»Ÿè‡ªåŠ¨ä¸‹è½½è¿™äº›æ–‡ä»¶åˆ°æœ¬åœ°ä¸´æ—¶ç›®å½•
3. å°†æ–‡ä»¶ä¸Šä¼ åˆ°é¡¹ç›®é…ç½®çš„æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼ˆMinIO/OSSç­‰ï¼‰
4. è·å¾—objectNameåå­˜å‚¨åˆ°`output_files`å­—æ®µ
5. æ¸…ç†æœ¬åœ°ä¸´æ—¶æ–‡ä»¶
6. è¿”å›å¤„ç†åçš„èŠ‚ç‚¹æ•°æ®ç»™å‰ç«¯

##### 1. æ–‡ç”Ÿå›¾èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-text2img-001",
  "tool_name": "æ–‡ç”Ÿå›¾",
  "input_data": {
    "prompt": "string",             // å›¾ç‰‡æç¤ºè¯
    "aspect_ratio": "string"         // å›¾ç‰‡æ¯”ä¾‹ï¼š"1:1", "16:9", "9:16", "4:3"
  },
  "output_data": {
    "image_info": "object"          // å›¾ç‰‡ä¿¡æ¯
  },
  "output_files": ["image_url"],
  "original_files": ["image_url"],
  "preview_required": true
}
```

##### 2. å›¾ç”Ÿå›¾èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-img2img-002",
  "tool_name": "å›¾ç”Ÿå›¾",
  "input_data": {
    "prompt": "string",             // å›¾ç‰‡æç¤ºè¯
    "source_image_url": "string",   // æºå›¾ç‰‡URL
    "aspect_ratio": "string"         // å›¾ç‰‡æ¯”ä¾‹ï¼š"1:1", "16:9", "9:16", "4:3"
  },
  "output_data": {
    "image_info": "object"          // å›¾ç‰‡ä¿¡æ¯
  },
  "output_files": ["image_url"],
  "original_files": ["image_url"],
  "preview_required": true
}
```

##### 3. å›¾ç”Ÿè§†é¢‘èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-img2video-003",
  "tool_name": "å›¾ç”Ÿè§†é¢‘",
  "input_data": {
    "prompt": "string",             // è§†é¢‘æç¤ºè¯
    "source_image_url": "string",   // æºå›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰
    "aspect_ratio": "string"         // è§†é¢‘æ¯”ä¾‹ï¼š"16:9", "9:16", "1:1"
  },
  "output_data": {
    "video_info": "object"          // è§†é¢‘ä¿¡æ¯
  },
  "output_files": ["video_url"],
  "original_files": ["video_url"],
  "preview_required": true
}
```

##### 4. æ–‡ç”Ÿè§†é¢‘èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-text2video-004",
  "tool_name": "æ–‡ç”Ÿè§†é¢‘",
  "input_data": {
    "prompt": "string",             // è§†é¢‘æç¤ºè¯
    "aspect_ratio": "string"         // è§†é¢‘æ¯”ä¾‹ï¼š"16:9", "9:16", "1:1"
  },
  "output_data": {
    "video_info": "object"          // è§†é¢‘ä¿¡æ¯
  },
  "output_files": ["video_url"],
  "original_files": ["video_url"],
  "preview_required": true
}
```


##### 5. èƒŒæ™¯éŸ³ä¹ç”ŸæˆèŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-music-gen-005",
  "tool_name": "èƒŒæ™¯éŸ³ä¹ç”Ÿæˆ",
  "input_data": {
    "prompt": "string"              // éŸ³ä¹æè¿°
  },
  "output_data": {
    "music_info": "object"          // éŸ³ä¹ä¿¡æ¯
  },
  "output_files": ["audio_url"],
  "original_files": ["audio_url"],
  "preview_required": true
}
```


##### 6. æ–‡æ¡ˆè½¬è¯­éŸ³èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-text2speech-008",
  "tool_name": "æ–‡æ¡ˆè½¬è¯­éŸ³",
  "input_data": {
    "text": "string",               // å¾…è½¬æ¢æ–‡æœ¬
    "voice_id": "string",          // å£°éŸ³ID
    "speed": "number",             // è¯­é€Ÿ (0.5-2.0)
    "pitch": "number",             // éŸ³è°ƒ (0.5-2.0)
    "volume": "number"             // éŸ³é‡ (0.0-1.0)
  },
  "output_data": {
    "audio_info": "object"         // éŸ³é¢‘ä¿¡æ¯
  },
  "output_files": ["audio_url"],
  "original_files": ["audio_url"],
  "preview_required": true
}
```

##### 7. è¯­éŸ³ç”Ÿæˆå­—å¹•èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-speech2sub-009",
  "tool_name": "è¯­éŸ³ç”Ÿæˆå­—å¹•",
  "input_data": {
    "audio_url": "string",         // éŸ³é¢‘æ–‡ä»¶URL
    "language": "string",          // è¯­è¨€ä»£ç  (zh-CN, en-USç­‰)
    "format": "string"             // å­—å¹•æ ¼å¼ (srt, vtt, ass)
  },
  "output_data": {
    "subtitle_info": "object",     // å­—å¹•ä¿¡æ¯
    "word_count": "number",        // è¯æ•°
    "segments": "array"            // å­—å¹•ç‰‡æ®µ
  },
  "output_files": ["subtitle_url"],
  "original_files": ["subtitle_url"],
  "preview_required": false
}
```

##### 8. è§†é¢‘åˆå¹¶èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-video-merge-010",
  "tool_name": "è§†é¢‘åˆå¹¶",
  "input_data": {
    "video_urls": "array"         // è§†é¢‘æ–‡ä»¶URLåˆ—è¡¨
  },
  "output_data": {
    "merged_video_info": "object" // åˆå¹¶åè§†é¢‘ä¿¡æ¯
  },
  "output_files": ["video_url"],
  "original_files": ["video_url"],
  "preview_required": true
}
```

##### 9. éŸ³è§†é¢‘åˆå¹¶èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-av-merge-011",
  "tool_name": "éŸ³è§†é¢‘åˆå¹¶",
  "input_data": {
    "video_url": "string",         // è§†é¢‘æ–‡ä»¶URL
    "audio_url": "string"         // éŸ³é¢‘æ–‡ä»¶URL
  },
  "output_data": {
    "merged_video_info": "object" // åˆå¹¶åè§†é¢‘ä¿¡æ¯
  },
  "output_files": ["video_url"],
  "original_files": ["video_url"],
  "preview_required": true
}
```

##### 10. å­—å¹•è§†é¢‘åˆå¹¶èŠ‚ç‚¹
```json
{
  "tool_uuid": "tool-sub-merge-012",
  "tool_name": "å­—å¹•è§†é¢‘åˆå¹¶",
  "input_data": {
    "video_url": "string",         // è§†é¢‘æ–‡ä»¶URL
    "subtitle_url": "string"      // å­—å¹•æ–‡ä»¶URL
  },
  "output_data": {
    "final_video_info": "object"  // æœ€ç»ˆè§†é¢‘ä¿¡æ¯
  },
  "output_files": ["video_url"],
  "original_files": ["video_url"],
  "preview_required": true
}
```

### 2. ä»»åŠ¡æ‰§è¡Œé¡µé¢é‡æ„

#### 2.1 é¡µé¢å¸ƒå±€éœ€æ±‚
ç”¨æˆ·ç«¯å‰ç«¯é¡¹ç›®çš„é¦–é¡µä¸­æœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œç‚¹å‡»æäº¤æ—¶ä¼šè·³è½¬åˆ°ã€ä»»åŠ¡ä¸­å¿ƒé¡µé¢ã€‘(`http://localhost:3000/ai-task`)ã€‚

**å½“å‰ä»»åŠ¡æ‰§è¡Œé¡µé¢éœ€è¦é‡æ„ï¼Œå‚è€ƒè®¾è®¡æˆªå›¾**ï¼š/mnt/d/software/beilv-agent/ä»»åŠ¡æ‰§è¡Œé¡µé¢.png

- **å·¦ä¾§é¢æ¿**ï¼šæ˜¾ç¤ºå†å²é¡¹ç›®åˆ—è¡¨
  - æ”¯æŒé¡¹ç›®æœç´¢å’Œåˆ†ç±»
  - ç‚¹å‡»é¡¹ç›®å¯ä»¥åŠ è½½å¹¶åœ¨å³ä¾§æŸ¥çœ‹è¯¦ç»†å†…å®¹
  - é¡¹ç›®çŠ¶æ€æ˜¾ç¤ºï¼ˆè¿›è¡Œä¸­ã€å·²å®Œæˆã€å¤±è´¥ç­‰ï¼‰

- **å³ä¾§é¢æ¿**ï¼šå¯¹è¯æ¡†ç•Œé¢
  - åªæ”¯æŒä¸€è½®å¯¹è¯ï¼ˆç”¨æˆ·è¾“å…¥ â†’ AIæ‰§è¡Œ â†’ å®Œæˆï¼‰
  - ç”¨æˆ·å¯ä»¥è¾“å…¥ä»»æ„è¦æ±‚
  - å®æ—¶æ˜¾ç¤ºå·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹
  - ä¸­é—´ç»“æœé¢„è§ˆï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ï¼‰

#### 2.2 äº¤äº’æµç¨‹
1. **è¾“å…¥é˜¶æ®µ**ï¼šç”¨æˆ·è¾“å…¥æç¤ºè¯ï¼Œå¯é€‰æ‹©ä¸Šä¼ å‚è€ƒå›¾ç‰‡ï¼ˆ0-6å¼ ï¼‰
   - **çº¯æ–‡å­—æ¨¡å¼**ï¼šä»…è¾“å…¥æç¤ºè¯ï¼Œç³»ç»Ÿé€šè¿‡æ–‡ç”Ÿå›¾â†’å›¾ç”Ÿè§†é¢‘æˆ–ç›´æ¥æ–‡ç”Ÿè§†é¢‘
   - **å›¾ç‰‡è¾…åŠ©æ¨¡å¼**ï¼šä¸Šä¼ 1-6å¼ å‚è€ƒå›¾ç‰‡ï¼Œç»“åˆæç¤ºè¯è¿›è¡Œå›¾ç”Ÿå›¾â†’å›¾ç”Ÿè§†é¢‘
   - **æ··åˆæ¨¡å¼**ï¼šéƒ¨åˆ†å›¾ç‰‡+æ–‡å­—æè¿°ï¼Œçµæ´»ç»„åˆç”Ÿæˆå†…å®¹
2. **åˆ†æé˜¶æ®µ**ï¼šPythonåç«¯LLMåˆ†ææç¤ºè¯å’Œä¸Šä¼ å†…å®¹ï¼Œç”ŸæˆåŠ¨æ€å·¥ä½œæµ
3. **æ‰§è¡Œé˜¶æ®µ**ï¼šæŒ‰é¡ºåºæ‰§è¡Œå·¥ä½œæµèŠ‚ç‚¹ï¼Œå®æ—¶åé¦ˆè¿›åº¦
4. **é¢„è§ˆé˜¶æ®µ**ï¼šæ¯ä¸ªèŠ‚ç‚¹å®Œæˆåï¼Œç«‹å³åœ¨å¯¹è¯æ¡†ä¸­é¢„è§ˆç»“æœ
5. **å®Œæˆé˜¶æ®µ**ï¼šæ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œå®Œæˆï¼Œç”Ÿæˆæœ€ç»ˆè§†é¢‘

#### 2.3 å®æ—¶åé¦ˆéœ€æ±‚
æäº¤æç¤ºè¯åï¼Œåç«¯ä¼šæŒ‰é¡ºåºè¾“å‡ºä¸­é—´ç»“æœï¼Œä¾‹å¦‚ï¼š
- å…ˆç”Ÿæˆå›¾ç‰‡ â†’ å¯¹è¯æ¡†é¢„è§ˆå›¾ç‰‡
- ç„¶åç”Ÿæˆè§†é¢‘ â†’ å¯¹è¯æ¡†é¢„è§ˆè§†é¢‘
- åˆ›å»ºèƒŒæ™¯éŸ³ä¹ â†’ å¯¹è¯æ¡†é¢„è§ˆéŸ³é¢‘
- åˆ›å»ºå¹¿å‘Šå£æ’­ â†’ å¯¹è¯æ¡†é¢„è§ˆéŸ³é¢‘å’Œæ–‡æ¡ˆ
- æœ€ååˆæˆè§†é¢‘ â†’ å¯¹è¯æ¡†é¢„è§ˆæœ€ç»ˆè§†é¢‘

### 3. é¡¹ç›®ä»»åŠ¡åˆ›å»ºæµç¨‹

#### 3.1 é¡¹ç›®åˆ›å»º
ç”¨æˆ·æäº¤æç¤ºè¯åï¼ˆå¯åŒ…å«0-6å¼ å›¾ç‰‡ï¼‰ï¼Œåç«¯åˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼š
- é¡¹ç›®çŠ¶æ€ï¼šåˆå§‹çŠ¶æ€
- å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„æç¤ºè¯
- ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å…ˆä¸Šä¼ åˆ°æ–‡ä»¶å­˜å‚¨æœåŠ¡ï¼Œè·å–objectNameåå­˜å‚¨åˆ°æ•°æ®åº“ä¸­
- åˆ†é…å”¯ä¸€çš„é¡¹ç›®ID
- **LLMæ™ºèƒ½å†…å®¹åˆ†æ**ï¼šé€šè¿‡RPCè°ƒç”¨PythonæœåŠ¡ï¼ŒLLMæ ¹æ®ç”¨æˆ·è¾“å…¥æ™ºèƒ½åˆ¤æ–­å¹¶æ‰§è¡Œç›¸åº”çš„åˆ†ææ­¥éª¤ï¼š
  - **å†…å®¹è§£æ**ï¼šç†è§£ç”¨æˆ·éœ€æ±‚å’Œåˆ›ä½œæ„å›¾ï¼ˆæ‰€æœ‰åœºæ™¯å¿…éœ€ï¼‰
  - **å›¾ç‰‡ç†è§£**ï¼šä»…å½“ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡æ—¶æ‰§è¡Œï¼Œåˆ†æå›¾ç‰‡å†…å®¹ç”Ÿæˆè¯¦ç»†æè¿°
  - **ç”Ÿæˆå›¾ç‰‡æç¤ºè¯**ï¼šä»…å½“éœ€è¦å›¾ç‰‡ç”Ÿæˆæ—¶æ‰§è¡Œï¼Œä¼˜åŒ–å›¾ç‰‡ç”Ÿæˆæç¤ºè¯
  - **ç”Ÿæˆè§†é¢‘æç¤ºè¯**ï¼šä»…å½“éœ€è¦è§†é¢‘ç”Ÿæˆæ—¶æ‰§è¡Œï¼Œä¼˜åŒ–è§†é¢‘ç”Ÿæˆæç¤ºè¯
  - **å£æ’­æ–‡æ¡ˆç”Ÿæˆ**ï¼šä»…å½“éœ€è¦è¯­éŸ³/æ–‡æ¡ˆæ—¶æ‰§è¡Œï¼Œç”Ÿæˆåˆé€‚çš„å£æ’­å†…å®¹
  - **å·¥ä½œæµæ¨¡å¼ç¡®å®š**ï¼šæ ¹æ®ç”¨æˆ·éœ€æ±‚æ™ºèƒ½é€‰æ‹©æœ€é€‚åˆçš„å·¥ä½œæµæ¨¡å¼
  - **å®Œæ•´æ‰§è¡Œè®¡åˆ’ç”Ÿæˆ**ï¼šåŸºäºç¡®å®šçš„æ¨¡å¼ç”ŸæˆåŒ…å«æ‰§è¡Œé¡ºåºçš„å·¥ä½œæµJSONï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹é¢„è®¾å‚æ•°

**æ™ºèƒ½åˆ†æç‰¹ç‚¹**ï¼š
- **æŒ‰éœ€åˆ†æ**ï¼šåªæ‰§è¡Œç”¨æˆ·éœ€æ±‚ç›¸å…³çš„åˆ†ææ­¥éª¤ï¼Œé¿å…ä¸å¿…è¦çš„å¤„ç†
- **åœºæ™¯é€‚é…**ï¼šä¸åŒè¾“å…¥åœºæ™¯è§¦å‘ä¸åŒçš„åˆ†ææµç¨‹
- **æ•ˆç‡ä¼˜åŒ–**ï¼šç®€å•éœ€æ±‚å¿«é€Ÿå¤„ç†ï¼Œå¤æ‚éœ€æ±‚å…¨é¢åˆ†æ
- å°†LLMåˆ†æç»“æœå’Œå®Œæ•´å·¥ä½œæµé…ç½®å­˜å‚¨åˆ°é¡¹ç›®æ•°æ®ä¸­
- **é¡¹ç›®çŠ¶æ€æ›´æ–°**ï¼šä»"åˆå§‹çŠ¶æ€"è½¬ä¸º"åˆ†æå®Œæˆ"ï¼Œå‡†å¤‡æ‰§è¡Œé˜¶æ®µ

#### 3.2 å·¥ä½œæµæ‰§è¡Œå¯åŠ¨
é¡¹ç›®åˆ›å»ºå’ŒLLMåˆ†æå®Œæˆåï¼Œç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨å·¥ä½œæµæ‰§è¡Œï¼š

**æ‰§è¡Œå¯åŠ¨æµç¨‹**ï¼š
- **å¼‚æ­¥RPCè°ƒç”¨**ï¼šJavaåç«¯é€šè¿‡RPCå¼‚æ­¥è°ƒç”¨PythonæœåŠ¡æ‰§è¡Œå·¥ä½œæµ
- **ç«‹å³å“åº”**ï¼šRPCè°ƒç”¨åç«‹å³è¿”å›æˆåŠŸçŠ¶æ€ï¼Œä¸ç­‰å¾…æ‰§è¡Œå®Œæˆï¼Œé¿å…é•¿æ—¶é—´é˜»å¡
- **é¡¹ç›®çŠ¶æ€æ›´æ–°**ï¼šé¡¹ç›®çŠ¶æ€ä»"åˆ†æå®Œæˆ"è½¬ä¸º"æ‰§è¡Œä¸­"
- **æ‰§è¡Œæƒè½¬ç§»**ï¼šPythonç«¯Agentæ¥ç®¡å·¥ä½œæµæ‰§è¡Œï¼ŒJavaç«¯ä¸“æ³¨çŠ¶æ€ç®¡ç†

**RPCæ¥å£è®¾è®¡**ï¼š
```java
// Javaç«¯å¼‚æ­¥è°ƒç”¨
CompletableFuture<Void> future = pythonRpcService.executeWorkflowAsync(projectId, workflowConfig);
return ResponseEntity.ok("å·¥ä½œæµæ‰§è¡Œå·²å¯åŠ¨");
```

**æ‰§è¡Œå‚æ•°ä¼ é€’**ï¼š
- é¡¹ç›®IDå’Œå·¥ä½œæµé…ç½®
- å®Œæ•´çš„èŠ‚ç‚¹å‚æ•°å’Œæç¤ºè¯
- æ–‡ä»¶å­˜å‚¨é…ç½®ä¿¡æ¯
- å›è°ƒæ¥å£åœ°å€

#### 3.3 å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹
Pythonç«¯æ¥æ”¶åˆ°å·¥ä½œæµæ‰§è¡Œè¯·æ±‚åï¼Œé‡‡ç”¨Agentä¸»å¯¼çš„æ‰§è¡Œæ¨¡å¼ï¼š

**æ‰§è¡Œæ¶æ„**ï¼š
- **Python Agentä¸»å¯¼**ï¼šè´Ÿè´£langchainå·¥å…·é“¾çš„å…·ä½“æ‰§è¡Œ
- **Javaç«¯çŠ¶æ€ç®¡ç†**ï¼šé€šè¿‡å›è°ƒæ¥å£å®æ—¶æ¥æ”¶çŠ¶æ€æ›´æ–°
- **å¼‚æ­¥éé˜»å¡**ï¼šæ‰§è¡Œè¿‡ç¨‹ä¸å½±å“ç”¨æˆ·çš„å…¶ä»–æ“ä½œ

**èŠ‚ç‚¹æ‰§è¡Œæµç¨‹**ï¼š
```python
async def execute_workflow(project_id, workflow):
    for node in workflow.nodes:
        # 1. èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œ - å›è°ƒé€šçŸ¥Javaç«¯
        await callback_java_api(project_id, node.id, "running", None)

        try:
            # 2. æ‰§è¡Œå…·ä½“çš„AIå·¥å…·
            result = await execute_node(node)

            # 3. ä¸Šä¼ ç”Ÿæˆæ–‡ä»¶åˆ°å­˜å‚¨æœåŠ¡
            if result.output_files:
                file_urls = await upload_files_to_storage(result.output_files)
                result.file_object_names = file_urls

            # 4. èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ - å›è°ƒé€šçŸ¥Javaç«¯
            await callback_java_api(project_id, node.id, "completed", result)

        except Exception as e:
            # 5. èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥ - å›è°ƒé€šçŸ¥Javaç«¯
            await callback_java_api(project_id, node.id, "failed", str(e))
            break

        # 6. æ›´æ–°é¡¹ç›®æ•´ä½“è¿›åº¦
        progress = calculate_progress(workflow, current_node)
        await update_project_progress(project_id, progress)
```

**çŠ¶æ€åŒæ­¥æœºåˆ¶**ï¼š
- **å®æ—¶å›è°ƒ**ï¼šæ¯ä¸ªèŠ‚ç‚¹çŠ¶æ€å˜åŒ–ç«‹å³é€šçŸ¥Javaç«¯
- **æ•°æ®æŒä¹…åŒ–**ï¼šJavaç«¯æ¥æ”¶å›è°ƒåæ›´æ–°æ•°æ®åº“çŠ¶æ€
- **é”™è¯¯å¤„ç†**ï¼šå¼‚å¸¸æƒ…å†µä¸‹å›æ»šçŠ¶æ€å¹¶é€šçŸ¥ç”¨æˆ·
- **è¿›åº¦è¿½è¸ª**ï¼šå®æ—¶è®¡ç®—å’Œæ›´æ–°é¡¹ç›®æ‰§è¡Œè¿›åº¦

**Javaç«¯å›è°ƒæ¥å£**ï¼š
```java
@PostMapping("/api/workflow/callback")
public ResponseEntity<?> workflowCallback(@RequestBody CallbackRequest request) {
    // æ›´æ–°èŠ‚ç‚¹çŠ¶æ€å’Œç»“æœ
    workflowService.updateNodeStatus(
        request.getProjectId(),
        request.getNodeId(),
        request.getStatus(),
        request.getResult()
    );

    // æ›´æ–°é¡¹ç›®çŠ¶æ€
    if (request.getStatus().equals("failed")) {
        projectService.updateStatus(request.getProjectId(), "æ‰§è¡Œå¤±è´¥");
    }

    return ResponseEntity.ok();
}
```

**æ–‡ä»¶ç®¡ç†**ï¼š
- æ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆçš„æ–‡ä»¶å…ˆä¸Šä¼ åˆ°æ–‡ä»¶å­˜å‚¨æœåŠ¡
- è·å–objectNameåé€šè¿‡å›è°ƒä¼ é€’ç»™Javaç«¯
- Javaç«¯å°†objectNameä¿å­˜åˆ°æ•°æ®åº“çš„èŠ‚ç‚¹è¾“å‡ºå­—æ®µ

#### 3.4 å·¥ä½œæµç¤ºä¾‹

**åœºæ™¯1ï¼šå›¾ç‰‡è¾…åŠ©è§†é¢‘åˆ¶ä½œï¼ˆæœ‰ä¸Šä¼ å›¾ç‰‡ï¼‰**
```text
å›¾ç”Ÿå›¾1->å›¾ç”Ÿå›¾2->å›¾ç”Ÿå›¾3->å›¾ç”Ÿè§†é¢‘1->å›¾ç”Ÿè§†é¢‘2->å›¾ç”Ÿè§†é¢‘3->æ–‡æ¡ˆè½¬è¯­éŸ³->è¯­éŸ³ç”Ÿæˆå­—å¹•->èƒŒæ™¯éŸ³ä¹ç”Ÿæˆ->è§†é¢‘åˆå¹¶->éŸ³è§†é¢‘åˆå¹¶1->éŸ³è§†é¢‘åˆå¹¶2->å­—å¹•è§†é¢‘åˆå¹¶
```
*ç”¨æˆ·è¾“å…¥ï¼šåˆ¶ä½œé¦™æ°´å¹¿å‘Šè§†é¢‘* + ä¸Šä¼ 3å¼ å›¾ç‰‡
*LLMåˆ†æï¼šå›¾ç‰‡ç†è§£ â†’ å†…å®¹è§£æ â†’ ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ â†’ ç”Ÿæˆè§†é¢‘æç¤ºè¯ â†’ å£æ’­æ–‡æ¡ˆç”Ÿæˆ â†’ å·¥ä½œæµæ¨¡å¼ç¡®å®šï¼ˆå®Œæ•´è§†é¢‘åˆ¶ä½œï¼‰*

**åœºæ™¯2ï¼šçº¯æ–‡å­—è§†é¢‘åˆ¶ä½œï¼ˆæ— ä¸Šä¼ å›¾ç‰‡ï¼‰**
```text
æ–‡ç”Ÿå›¾1->æ–‡ç”Ÿå›¾2->æ–‡ç”Ÿå›¾3->å›¾ç”Ÿè§†é¢‘1->å›¾ç”Ÿè§†é¢‘2->å›¾ç”Ÿè§†é¢‘3->æ–‡æ¡ˆè½¬è¯­éŸ³->è¯­éŸ³ç”Ÿæˆå­—å¹•->èƒŒæ™¯éŸ³ä¹ç”Ÿæˆ->è§†é¢‘åˆå¹¶->éŸ³è§†é¢‘åˆå¹¶1->éŸ³è§†é¢‘åˆå¹¶2->å­—å¹•è§†é¢‘åˆå¹¶
```
*ç”¨æˆ·è¾“å…¥ï¼šåˆ¶ä½œç¾é£Ÿæ¨å¹¿è§†é¢‘*
*LLMåˆ†æï¼šå†…å®¹è§£æ â†’ ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ â†’ ç”Ÿæˆè§†é¢‘æç¤ºè¯ â†’ å£æ’­æ–‡æ¡ˆç”Ÿæˆ â†’ å·¥ä½œæµæ¨¡å¼ç¡®å®šï¼ˆå®Œæ•´è§†é¢‘åˆ¶ä½œï¼‰*

**åœºæ™¯3ï¼šç›´æ¥æ–‡ç”Ÿè§†é¢‘åˆ¶ä½œ**
```text
æ–‡ç”Ÿè§†é¢‘1->æ–‡ç”Ÿè§†é¢‘2->æ–‡ç”Ÿè§†é¢‘3->æ–‡æ¡ˆè½¬è¯­éŸ³->è¯­éŸ³ç”Ÿæˆå­—å¹•->èƒŒæ™¯éŸ³ä¹ç”Ÿæˆ->è§†é¢‘åˆå¹¶->éŸ³è§†é¢‘åˆå¹¶1->éŸ³è§†é¢‘åˆå¹¶2->å­—å¹•è§†é¢‘åˆå¹¶
```
*ç”¨æˆ·è¾“å…¥ï¼šç›´æ¥ç”Ÿæˆç§‘æŠ€äº§å“æ¼”ç¤ºè§†é¢‘*
*LLMåˆ†æï¼šå†…å®¹è§£æ â†’ ç”Ÿæˆè§†é¢‘æç¤ºè¯ â†’ å£æ’­æ–‡æ¡ˆç”Ÿæˆ â†’ å·¥ä½œæµæ¨¡å¼ç¡®å®šï¼ˆæ–‡ç”Ÿè§†é¢‘åˆ¶ä½œï¼‰*

**åœºæ™¯4ï¼šçº¯å£æ’­æ–‡æ¡ˆåœºæ™¯**
```text
æ–‡æ¡ˆè½¬è¯­éŸ³
```
*ç”¨æˆ·è¾“å…¥ï¼šå¸®æˆ‘ç”Ÿæˆä¸€æ®µå–å†…è¡£çš„å£æ’­æ–‡æ¡ˆä»¥åŠé…éŸ³*
*LLMåˆ†æï¼šå†…å®¹è§£æ â†’ å£æ’­æ–‡æ¡ˆç”Ÿæˆ â†’ å·¥ä½œæµæ¨¡å¼ç¡®å®šï¼ˆæ–‡æ¡ˆè½¬è¯­éŸ³ï¼‰*

**åœºæ™¯5ï¼šçº¯å›¾ç‰‡ç”Ÿæˆåœºæ™¯**
```text
æ–‡ç”Ÿå›¾1->æ–‡ç”Ÿå›¾2
```
*ç”¨æˆ·è¾“å…¥ï¼šå¸®æˆ‘ç”Ÿæˆä¸¤å¼ æ²™æ»©ç¾å¥³å›¾ç‰‡*
*LLMåˆ†æï¼šå†…å®¹è§£æ â†’ ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ â†’ å·¥ä½œæµæ¨¡å¼ç¡®å®šï¼ˆå¤šå›¾ç”Ÿæˆï¼‰*

**åœºæ™¯6ï¼šéŸ³é¢‘å¤„ç†åœºæ™¯**
```text
è¯­éŸ³ç”Ÿæˆå­—å¹•
```
*ç”¨æˆ·è¾“å…¥ï¼šå¸®æˆ‘ä¸ºè¿™æ®µéŸ³é¢‘ç”Ÿæˆå­—å¹•* + ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
*LLMåˆ†æï¼šå†…å®¹è§£æ â†’ å·¥ä½œæµæ¨¡å¼ç¡®å®šï¼ˆéŸ³é¢‘è½¬å­—å¹•ï¼‰*

**åœºæ™¯7ï¼šå›¾ç‰‡ä¼˜åŒ–åœºæ™¯**
```text
å›¾ç”Ÿå›¾1->å›¾ç”Ÿå›¾2->å›¾ç”Ÿå›¾3
```
*ç”¨æˆ·è¾“å…¥ï¼šå¸®æˆ‘ä¼˜åŒ–è¿™äº›äº§å“å›¾ç‰‡* + ä¸Šä¼ 3å¼ å›¾ç‰‡
*LLMåˆ†æï¼šå›¾ç‰‡ç†è§£ â†’ å†…å®¹è§£æ â†’ ç”Ÿæˆå›¾ç‰‡æç¤ºè¯ â†’ å·¥ä½œæµæ¨¡å¼ç¡®å®šï¼ˆå›¾ç‰‡ä¼˜åŒ–ï¼‰*

#### 3.5 æ™ºèƒ½å·¥ä½œæµæ¨¡å¼ç¡®å®šé€»è¾‘

LLMæ ¹æ®ä»¥ä¸‹å› ç´ æ™ºèƒ½åˆ¤æ–­å·¥ä½œæµæ¨¡å¼ï¼š

**è¾“å…¥ç±»å‹åˆ¤æ–­**ï¼š
- **æœ‰ä¸Šä¼ å›¾ç‰‡** â†’ ä¼˜å…ˆè€ƒè™‘å›¾ç‰‡ç›¸å…³å¤„ç†ï¼ˆå›¾ç”Ÿå›¾ã€å›¾ç”Ÿè§†é¢‘ï¼‰
- **æœ‰ä¸Šä¼ éŸ³é¢‘** â†’ éŸ³é¢‘å¤„ç†æ¨¡å¼ï¼ˆè¯­éŸ³è½¬å­—å¹•ã€éŸ³é¢‘ä¼˜åŒ–ï¼‰
- **çº¯æ–‡å­—è¾“å…¥** â†’ æ ¹æ®éœ€æ±‚å†…å®¹åˆ¤æ–­ç”Ÿæˆç±»å‹

**éœ€æ±‚å…³é”®è¯è¯†åˆ«**ï¼š
- **åŒ…å«"æ–‡æ¡ˆ"ã€"é…éŸ³"ã€"å£æ’­"** â†’ æ–‡æ¡ˆè½¬è¯­éŸ³æ¨¡å¼
- **åŒ…å«"å›¾ç‰‡"ã€"ç…§ç‰‡"ã€"ç”Ÿæˆå›¾"** â†’ å›¾ç‰‡ç”Ÿæˆæ¨¡å¼
- **åŒ…å«"è§†é¢‘"ã€"å¹¿å‘Š"ã€"å®£ä¼ ç‰‡"** â†’ è§†é¢‘åˆ¶ä½œæ¨¡å¼
- **åŒ…å«"å­—å¹•"ã€"è½¬å½•"** â†’ è¯­éŸ³è½¬å­—å¹•æ¨¡å¼
- **åŒ…å«"ä¼˜åŒ–"ã€"ç¾åŒ–"** + ä¸Šä¼ æ–‡ä»¶ â†’ æ–‡ä»¶ä¼˜åŒ–æ¨¡å¼

**å¤æ‚åº¦è¯„ä¼°**ï¼š
- **ç®€å•å•ä¸€éœ€æ±‚**ï¼šç”Ÿæˆæœ€ç²¾ç®€çš„å·¥ä½œæµï¼ˆå¦‚å•çº¯æ–‡æ¡ˆè½¬è¯­éŸ³ï¼‰
- **ä¸­ç­‰å¤æ‚éœ€æ±‚**ï¼šç”Ÿæˆä¸­ç­‰é•¿åº¦å·¥ä½œæµï¼ˆå¦‚å¤šå›¾ç”Ÿæˆï¼‰
- **å¤æ‚ç»¼åˆéœ€æ±‚**ï¼šç”Ÿæˆå®Œæ•´å·¥ä½œæµï¼ˆå¦‚å®Œæ•´è§†é¢‘åˆ¶ä½œï¼‰

**æ™ºèƒ½ä¼˜åŒ–**ï¼š
- æ ¹æ®ç”¨æˆ·å†å²åå¥½è°ƒæ•´å·¥ä½œæµç»“æ„
- è‡ªåŠ¨æ’é™¤ä¸å¿…è¦çš„å¤„ç†æ­¥éª¤
- ä¼˜åŒ–èŠ‚ç‚¹é¡ºåºä»¥æé«˜æ‰§è¡Œæ•ˆç‡

è¿™ç§æ™ºèƒ½æ¨¡å¼ç¡®å®šæœºåˆ¶ç¡®ä¿æ¯ä¸ªç”¨æˆ·éœ€æ±‚éƒ½èƒ½å¾—åˆ°æœ€åˆé€‚ã€æœ€é«˜æ•ˆçš„å·¥ä½œæµé…ç½®ã€‚

### 4. Langchainå·¥å…·é“¾æ‰§è¡Œç»†èŠ‚

#### 4.1 å·¥å…·é“¾æ¶æ„
Pythonç«¯ä½¿ç”¨langchainæ¡†æ¶ç®¡ç†AIå·¥å…·çš„è°ƒç”¨å’Œåè°ƒï¼š

**æ ¸å¿ƒç»„ä»¶**ï¼š
- **å·¥å…·æ³¨å†Œå™¨**ï¼šç®¡ç†æ‰€æœ‰AIå·¥å…·ï¼ˆæ–‡ç”Ÿå›¾ã€å›¾ç”Ÿè§†é¢‘ã€è¯­éŸ³åˆæˆç­‰ï¼‰
- **æ‰§è¡Œè°ƒåº¦å™¨**ï¼šæŒ‰ç…§å·¥ä½œæµé¡ºåºè°ƒåº¦å·¥å…·æ‰§è¡Œ
- **çŠ¶æ€ç®¡ç†å™¨**ï¼šè·Ÿè¸ªæ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡ŒçŠ¶æ€
- **å›è°ƒå¤„ç†å™¨**ï¼šè´Ÿè´£ä¸Javaç«¯çš„çŠ¶æ€åŒæ­¥

#### 4.2 å·¥å…·æ‰§è¡Œæµç¨‹
```python
class WorkflowExecutor:
    async def execute_node(self, node):
        # 1. è·å–èŠ‚ç‚¹å¯¹åº”çš„å·¥å…·
        tool = self.tool_registry.get_tool(node.tool_type)

        # 2. å‡†å¤‡è¾“å…¥å‚æ•°
        input_params = self.prepare_input_params(node)

        # 3. æ‰§è¡Œå·¥å…·
        result = await tool.execute(input_params)

        # 4. å¤„ç†è¾“å‡ºæ–‡ä»¶
        if result.output_files:
            result.file_urls = await self.upload_files(result.output_files)

        # 5. è¿”å›æ‰§è¡Œç»“æœ
        return result
```

#### 4.3 æ‰§è¡Œç¤ºä¾‹
ä»¥é¦™æ°›äº§å“è§†é¢‘ä¸ºä¾‹çš„å®é™…æ‰§è¡Œè¿‡ç¨‹ï¼š

**æ‰§è¡Œåºåˆ—**ï¼š
1. **å›¾ç”Ÿå›¾1**ï¼šè¾“å…¥å›¾ç‰‡1 + æç¤ºè¯ â†’ ä¼˜åŒ–å›¾ç‰‡1 â†’ å›è°ƒæ›´æ–°çŠ¶æ€
2. **å›¾ç”Ÿå›¾2**ï¼šè¾“å…¥å›¾ç‰‡2 + æç¤ºè¯ â†’ ä¼˜åŒ–å›¾ç‰‡2 â†’ å›è°ƒæ›´æ–°çŠ¶æ€
3. **å›¾ç”Ÿå›¾3**ï¼šè¾“å…¥å›¾ç‰‡3 + æç¤ºè¯ â†’ ä¼˜åŒ–å›¾ç‰‡3 â†’ å›è°ƒæ›´æ–°çŠ¶æ€
4. **å›¾ç”Ÿè§†é¢‘1**ï¼šä¼˜åŒ–å›¾ç‰‡1 â†’ è§†é¢‘ç‰‡æ®µ1 â†’ å›è°ƒæ›´æ–°çŠ¶æ€
5. **å›¾ç”Ÿè§†é¢‘2**ï¼šä¼˜åŒ–å›¾ç‰‡2 â†’ è§†é¢‘ç‰‡æ®µ2 â†’ å›è°ƒæ›´æ–°çŠ¶æ€
6. **å›¾ç”Ÿè§†é¢‘3**ï¼šä¼˜åŒ–å›¾ç‰‡3 â†’ è§†é¢‘ç‰‡æ®µ3 â†’ å›è°ƒæ›´æ–°çŠ¶æ€
7. **æ–‡æ¡ˆè½¬è¯­éŸ³**ï¼šé¢„ç”Ÿæˆæ–‡æ¡ˆ â†’ è¯­éŸ³æ–‡ä»¶ â†’ å›è°ƒæ›´æ–°çŠ¶æ€
8. **è¯­éŸ³ç”Ÿæˆå­—å¹•**ï¼šè¯­éŸ³æ–‡ä»¶ â†’ å­—å¹•æ–‡ä»¶ â†’ å›è°ƒæ›´æ–°çŠ¶æ€
9. **èƒŒæ™¯éŸ³ä¹ç”Ÿæˆ**ï¼šé£æ ¼å‚æ•° â†’ èƒŒæ™¯éŸ³ä¹ â†’ å›è°ƒæ›´æ–°çŠ¶æ€
10. **è§†é¢‘åˆå¹¶**ï¼š3ä¸ªè§†é¢‘ç‰‡æ®µ â†’ ä¸»è§†é¢‘ â†’ å›è°ƒæ›´æ–°çŠ¶æ€
11. **éŸ³è§†é¢‘åˆå¹¶1**ï¼šä¸»è§†é¢‘+èƒŒæ™¯éŸ³ä¹ â†’ å¸¦éŸ³ä¹è§†é¢‘ â†’ å›è°ƒæ›´æ–°çŠ¶æ€
12. **éŸ³è§†é¢‘åˆå¹¶2**ï¼šå¸¦éŸ³ä¹è§†é¢‘+è¯­éŸ³ â†’ å®Œæ•´éŸ³é¢‘è§†é¢‘ â†’ å›è°ƒæ›´æ–°çŠ¶æ€
13. **å­—å¹•è§†é¢‘åˆå¹¶**ï¼šå®Œæ•´éŸ³é¢‘è§†é¢‘+å­—å¹• â†’ æœ€ç»ˆè§†é¢‘ â†’ é¡¹ç›®å®Œæˆ

**å…³é”®ç‰¹æ€§**ï¼š
- æ¯ä¸ªæ­¥éª¤å®Œæˆåç«‹å³é€šè¿‡å›è°ƒæ›´æ–°Javaç«¯çŠ¶æ€
- ç”Ÿæˆçš„æ–‡ä»¶å®æ—¶ä¸Šä¼ åˆ°å­˜å‚¨æœåŠ¡å¹¶è·å–objectName
- å‰ç«¯å¯ä»¥å®æ—¶æŸ¥çœ‹æ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œç»“æœå’Œé¢„è§ˆ

#### 4.4 é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **å·¥å…·æ‰§è¡Œå¤±è´¥**ï¼šè®°å½•é”™è¯¯ä¿¡æ¯ï¼Œå›è°ƒé€šçŸ¥Javaç«¯ï¼Œç»ˆæ­¢åç»­æ‰§è¡Œ
- **ç½‘ç»œå¼‚å¸¸**ï¼šè‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œæœ€å¤šé‡è¯•3æ¬¡
- **æ–‡ä»¶ä¸Šä¼ å¤±è´¥**ï¼šé‡è¯•æ–‡ä»¶ä¸Šä¼ ï¼Œå¤±è´¥åˆ™å›æ»šèŠ‚ç‚¹çŠ¶æ€
- **çŠ¶æ€åŒæ­¥å¤±è´¥**ï¼šæœ¬åœ°ä¿å­˜çŠ¶æ€ï¼Œåç»­æ‰¹é‡åŒæ­¥

### 5. æ–‡ä»¶ä¸Šä¼ å’Œè½¬æ¢æœåŠ¡è®¾è®¡

#### 5.1 æœåŠ¡æ¶æ„

**Javaåç«¯æ–‡ä»¶è½¬æ¢æœåŠ¡**ï¼š
```java
@Service
public class FileConversionService {

    @Autowired
    private FileStorageService fileStorageService;

    /**
     * å°†original_filesè½¬æ¢ä¸ºoutput_files
     * @param originalFiles åŸå§‹æ–‡ä»¶URLåˆ—è¡¨
     * @param nodeId èŠ‚ç‚¹IDï¼Œç”¨äºç”Ÿæˆå¯¹è±¡åç§°
     * @return è½¬æ¢åçš„objectNameåˆ—è¡¨
     */
    public List<String> convertFilesToStorage(List<String> originalFiles, String nodeId) {
        List<String> objectNames = new ArrayList<>();
        List<File> tempFiles = new ArrayList<>();

        try {
            for (int i = 0; i < originalFiles.size(); i++) {
                String originalUrl = originalFiles.get(i);

                // 1. ä¸‹è½½åŸå§‹æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•
                File tempFile = downloadFile(originalUrl, nodeId + "_" + i);
                tempFiles.add(tempFile);

                // 2. ä½¿ç”¨FileStorageServiceä¸Šä¼ åˆ°å­˜å‚¨ç³»ç»Ÿ
                MultipartFile multipartFile = convertToMultipartFile(tempFile);
                FileStorageService.FileUploadResult result = fileStorageService.uploadFile(multipartFile);
                objectNames.add(result.getObjectName());
            }
        } finally {
            // 3. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            cleanupTempFiles(tempFiles);
        }

        return objectNames;
    }

    /**
     * ä¸‹è½½åŸå§‹æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•
     */
    private File downloadFile(String originalUrl, String fileName) {
        // å®ç°æ–‡ä»¶ä¸‹è½½é€»è¾‘
        // ä»originalUrlä¸‹è½½æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•
    }

    /**
     * å°†Fileè½¬æ¢ä¸ºMultipartFile
     */
    private MultipartFile convertToMultipartFile(File file) {
        // å®ç°Fileåˆ°MultipartFileçš„è½¬æ¢
    }

    /**
     * æ¸…ç†ä¸´æ—¶æ–‡ä»¶
     */
    private void cleanupTempFiles(List<File> tempFiles) {
        for (File file : tempFiles) {
            if (file.exists()) {
                file.delete();
            }
        }
    }
}
```

#### 5.2 è½¬æ¢æµç¨‹

**æ­¥éª¤1ï¼šåŸå§‹æ–‡ä»¶ä¸‹è½½**
- ä»original_filesæ•°ç»„ä¸­è·å–æ‰€æœ‰åŸå§‹æ–‡ä»¶é“¾æ¥
- å¹¶å‘ä¸‹è½½æ–‡ä»¶åˆ°ä¸´æ—¶ç›®å½•ï¼š`/tmp/tool-files/{nodeId}/`
- æ ¹æ®æ–‡ä»¶æ‰©å±•åç¡®å®šæ–‡ä»¶ç±»å‹ï¼ˆimage/video/audioï¼‰
- ä¸‹è½½å¤±è´¥æ—¶è®°å½•é”™è¯¯å¹¶è·³è¿‡è¯¥æ–‡ä»¶

**æ­¥éª¤2ï¼šæ–‡ä»¶ä¸Šä¼ å­˜å‚¨**
- æ ¹æ®æ–‡ä»¶ç±»å‹å’Œå½“å‰æ—¥æœŸç”Ÿæˆå­˜å‚¨è·¯å¾„ï¼š`{type}/{year}/{month}/{filename}`
- è°ƒç”¨OSSæœåŠ¡ä¸Šä¼ æ–‡ä»¶
- è·å¾—objectNameå¹¶æ·»åŠ åˆ°output_filesæ•°ç»„
- è®°å½•ä¸Šä¼ ç»“æœå’Œè€—æ—¶

**æ­¥éª¤3ï¼šä¸´æ—¶æ–‡ä»¶æ¸…ç†**
- ä¸Šä¼ æˆåŠŸåç«‹å³åˆ é™¤æœ¬åœ°ä¸´æ—¶æ–‡ä»¶
- å®šæœŸæ¸…ç†è¶…æ—¶çš„ä¸´æ—¶æ–‡ä»¶ï¼ˆ1å°æ—¶åè‡ªåŠ¨æ¸…ç†ï¼‰
- å¼‚å¸¸æƒ…å†µä¸‹ç¡®ä¿ä¸´æ—¶æ–‡ä»¶ä¸ä¼šå †ç§¯

#### 5.3 å¼‚å¸¸å¤„ç†

**ä¸‹è½½å¤±è´¥å¤„ç†**ï¼š
- è®°å½•å¤±è´¥çš„åŸå§‹é“¾æ¥å’Œé”™è¯¯åŸå› 
- è®¾ç½®é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼‰
- éƒ¨åˆ†æ–‡ä»¶å¤±è´¥ä¸å½±å“å…¶ä»–æ–‡ä»¶å¤„ç†
- åœ¨èŠ‚ç‚¹error_messageä¸­è®°å½•å¤±è´¥è¯¦æƒ…

**ä¸Šä¼ å¤±è´¥å¤„ç†**ï¼š
- è®°å½•ä¸Šä¼ å¤±è´¥çš„æ–‡ä»¶å’Œé”™è¯¯åŸå› 
- ä¿ç•™å·²æˆåŠŸä¸Šä¼ çš„æ–‡ä»¶objectName
- è®¾ç½®é‡è¯•æœºåˆ¶
- é€šçŸ¥å‰ç«¯éƒ¨åˆ†æ–‡ä»¶å¤„ç†å¤±è´¥

#### 5.4 é…ç½®å‚æ•°

```yaml
file.conversion:
  temp-dir: /tmp/tool-files/
  download-timeout: 30s
  upload-timeout: 60s
  max-file-size: 100MB
  retry-times: 3
  cleanup-interval: 1h
  supported-formats:
    image: [jpg, jpeg, png, gif, webp]
    video: [mp4, avi, mov, mkv]
    audio: [mp3, wav, aac, flac]
```

### 6. LLMé¢„å¤„ç†æœåŠ¡è®¾è®¡

#### 6.1 é¢„å¤„ç†æµç¨‹

**è¾“å…¥**ï¼š
- ç”¨æˆ·æç¤ºè¯ï¼šæ–‡å­—æè¿°éœ€æ±‚
- ä¸Šä¼ å›¾ç‰‡ï¼š0-6å¼ å‚è€ƒå›¾ç‰‡ï¼ˆå¯é€‰ï¼‰

**LLMå¤„ç†æ­¥éª¤**ï¼š
1. **éœ€æ±‚åˆ†æ**ï¼šç†è§£ç”¨æˆ·æ„å›¾ã€é£æ ¼è¦æ±‚ã€è¾“å‡ºè§„æ ¼ç­‰
2. **å›¾ç‰‡ç†è§£**ï¼šè°ƒç”¨è§†è§‰æ¨¡å‹åˆ†æä¸Šä¼ çš„å›¾ç‰‡ï¼Œç”Ÿæˆè¯¦ç»†æè¿°
3. **æç¤ºè¯ä¼˜åŒ–**ï¼šåŸºäºéœ€æ±‚å’Œå›¾ç‰‡åˆ†æï¼Œç”Ÿæˆä¸“ä¸šçš„AIæç¤ºè¯
4. **å·¥ä½œæµè§„åˆ’**ï¼šç¡®å®šæ‰§è¡Œè·¯å¾„å’Œå·¥å…·åºåˆ—
5. **å‚æ•°é¢„è®¾**ï¼šä¸ºæ¯ä¸ªå·¥å…·èŠ‚ç‚¹é¢„è®¾ä¼˜åŒ–çš„å‚æ•°

**è¾“å‡º**ï¼š
- å®Œæ•´çš„å·¥ä½œæµJSONï¼ŒåŒ…å«æ‰€æœ‰èŠ‚ç‚¹çš„é¢„è®¾æç¤ºè¯
- å›¾ç‰‡åˆ†æç»“æœï¼ˆç”¨äºé¡¹ç›®è®°å½•ï¼‰
- æ‰§è¡Œç­–ç•¥è¯´æ˜

#### 6.2 æç¤ºè¯ç”Ÿæˆç­–ç•¥

**å›¾ç‰‡æç¤ºè¯ç”Ÿæˆ**ï¼š
```python
def generate_image_prompt(user_input, image_analysis):
    # ç»“åˆç”¨æˆ·éœ€æ±‚å’Œå›¾ç‰‡ç‰¹å¾
    # æ·»åŠ ä¸“ä¸šæ‘„å½±æœ¯è¯­
    # ä¼˜åŒ–è‰ºæœ¯é£æ ¼æè¿°
    # ç¡®ä¿AIç”Ÿæˆè´¨é‡
    return optimized_prompt
```

**è§†é¢‘æç¤ºè¯ç”Ÿæˆ**ï¼š
```python
def generate_video_prompt(user_input, image_prompt=None):
    # æ·»åŠ é•œå¤´è¿åŠ¨æè¿°
    # æŒ‡å®šæ—¶é•¿å’Œå¸§ç‡
    # ä¼˜åŒ–åŠ¨ä½œå’Œè½¬åœº
    # ç¡®ä¿è§†é¢‘è¿è´¯æ€§
    return optimized_prompt
```

### 7. å…³é”®æŠ€æœ¯éš¾ç‚¹

#### 5.1 åŠ¨æ€å·¥ä½œæµå‚æ•°ä¼ é€’
**é—®é¢˜**ï¼šå¦‚ä½•ä¿è¯åŠ¨æ€ç”Ÿæˆçš„å·¥ä½œæµï¼ˆå·¥å…·é“¾ï¼‰èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œè¡”æ¥ï¼Œä¸è‡³äºå…¥å‚æ··ä¹±é”™è¯¯ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨JSON Schemaå®šä¹‰å·¥å…·è¾“å…¥è¾“å‡ºæ ¼å¼
- LLMç”Ÿæˆå·¥ä½œæµæ—¶åŒ…å«è¯¦ç»†çš„å‚æ•°æ˜ å°„è§„åˆ™
- è¿è¡Œæ—¶åŠ¨æ€è§£æå’ŒéªŒè¯å‚æ•°
- å·¥å…·è°ƒç”¨å‰è¿›è¡Œå‚æ•°ç±»å‹æ£€æŸ¥å’Œè½¬æ¢

#### 5.2 ä»»åŠ¡ä¸­æ–­æ¢å¤
**é—®é¢˜**ï¼šå¦‚ä½•èƒ½å¤Ÿåœ¨å·¥ä½œæµè¿è¡Œä¸­çªç„¶å®•æœºç„¶åé‡å¯åèƒ½å¤Ÿç»§ç»­æ¢å¤ä»»åŠ¡ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œåç«‹å³ä¿å­˜çŠ¶æ€åˆ°æ•°æ®åº“
- è®°å½•å½“å‰æ‰§è¡Œä½ç½®å’Œä¸­é—´ç»“æœ
- é‡å¯æ—¶ä»æœ€åæˆåŠŸèŠ‚ç‚¹ç»§ç»­æ‰§è¡Œ
- æ–‡ä»¶å¼•ç”¨ä½¿ç”¨objectNameç¡®ä¿æŒä¹…åŒ–

#### 5.3 æ–‡ä»¶è‡ªåŠ¨ç®¡ç†
**é—®é¢˜**ï¼šå¦‚ä½•èƒ½å¤Ÿè‡ªåŠ¨ä¸‹è½½éœ€è¦çš„æ–‡ä»¶æ•°æ®ä»¥åŠè‡ªåŠ¨ä¸Šä¼ è¾“å‡ºçš„æ–‡ä»¶æ•°æ®ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- èŠ‚ç‚¹æ‰§è¡Œå‰è‡ªåŠ¨ä»æ–‡ä»¶å­˜å‚¨ä¸‹è½½æ‰€éœ€æ–‡ä»¶
- èŠ‚ç‚¹å®Œæˆåè‡ªåŠ¨ä¸Šä¼ è¾“å‡ºæ–‡ä»¶åˆ°æ–‡ä»¶å­˜å‚¨
- ä¸´æ—¶æ–‡ä»¶ç›®å½•ç®¡ç†å’Œæ¸…ç†
- æ–‡ä»¶URLç”Ÿæˆå’Œè®¿é—®æƒé™æ§åˆ¶

#### 5.4 é¢„è§ˆç»“æœæ§åˆ¶
**é—®é¢˜**ï¼šå¦‚ä½•è®¾ç½®å·¥å…·é“¾ä¸­ï¼Œå“ªäº›å·¥å…·çš„ç»“æœéœ€è¦è¿”å›å‰ç«¯å¹¶é¢„è§ˆï¼Œå“ªäº›å·¥å…·ç»“æœä¸åšé¢„è§ˆç›´æ¥ä¸‹ä¸€æ­¥ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å·¥å…·å®šä¹‰ä¸­åŒ…å«`preview_required`å­—æ®µ
- é‡è¦çš„ä¸­é—´ç»“æœï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ï¼‰éœ€è¦é¢„è§ˆ
- çº¯æ–‡æœ¬å¤„ç†ç»“æœå¯ä»¥ä¸é¢„è§ˆ
- æ”¯æŒé…ç½®åŒ–çš„é¢„è§ˆç­–ç•¥

#### 5.5 å®æ—¶çŠ¶æ€æ¨é€
**é—®é¢˜**ï¼šå¦‚ä½•åœ¨å·¥ä½œæµè¿è¡Œä¸­åŠ¨æ€è¿”å›ç”Ÿæˆçš„ç»“æœå¹¶å®æ—¶äº¤äº’é€šçŸ¥å‰ç«¯æ˜¾ç¤ºæµç¨‹ä¸­é—´ç»“æœï¼Ÿ

**æ¶æ„è®¾è®¡**ï¼š
```
å‰ç«¯ â†â†’ Javaåç«¯WebSocket â†â† Pythonå›è°ƒæ¥å£
```

**å®ç°æ–¹æ¡ˆ**ï¼š

**1. å‰ç«¯WebSocketè¿æ¥**ï¼š
```javascript
// å‰ç«¯é€šè¿‡é¡¹ç›®IDå»ºç«‹WebSocketè¿æ¥
const ws = new WebSocket(`ws://localhost:8080/ws/project/${projectId}`);

ws.onmessage = function(event) {
    const message = JSON.parse(event.data);
    handleWorkflowUpdate(message);
};
```

**2. Javaç«¯WebSocketç®¡ç†**ï¼š
```java
@Component
@ServerEndpoint("/ws/project/{projectId}")
public class WorkflowWebSocketHandler {

    // ç»´æŠ¤é¡¹ç›®IDåˆ°WebSocketä¼šè¯çš„æ˜ å°„
    private static Map<String, Session> projectSessions = new ConcurrentHashMap<>();

    @OnOpen
    public void onOpen(@PathParam("projectId") String projectId, Session session) {
        projectSessions.put(projectId, session);
        log.info("é¡¹ç›® {} å»ºç«‹WebSocketè¿æ¥", projectId);
    }

    @OnClose
    public void onClose(@PathParam("projectId") String projectId) {
        projectSessions.remove(projectId);
        log.info("é¡¹ç›® {} å…³é—­WebSocketè¿æ¥", projectId);
    }

    /**
     * å‘æŒ‡å®šé¡¹ç›®æ¨é€æ¶ˆæ¯
     */
    public static void pushToProject(String projectId, WorkflowMessage message) {
        Session session = projectSessions.get(projectId);
        if (session != null && session.isOpen()) {
            try {
                session.getBasicRemote().sendText(JSON.toJSONString(message));
            } catch (IOException e) {
                log.error("æ¨é€æ¶ˆæ¯å¤±è´¥", e);
            }
        }
    }
}
```

**3. Pythonå›è°ƒæ¥å£**ï¼š
```java
@RestController
@RequestMapping("/api/workflow")
public class WorkflowCallbackController {

    @PostMapping("/callback/status")
    public ResponseEntity<?> workflowStatusCallback(@RequestBody StatusCallbackRequest request) {
        // 1. æ›´æ–°æ•°æ®åº“çŠ¶æ€
        workflowService.updateNodeStatus(request.getProjectId(),
                                       request.getNodeId(),
                                       request.getStatus(),
                                       request.getResult());

        // 2. æ„å»ºWebSocketæ¨é€æ¶ˆæ¯
        WorkflowMessage message = WorkflowMessage.builder()
            .type("node_status")
            .projectId(request.getProjectId())
            .nodeId(request.getNodeId())
            .status(request.getStatus())
            .result(request.getResult())
            .timestamp(System.currentTimeMillis())
            .build();

        // 3. æ¨é€åˆ°å‰ç«¯
        WorkflowWebSocketHandler.pushToProject(request.getProjectId(), message);

        return ResponseEntity.ok();
    }
}
```

**4. Pythonç«¯å›è°ƒå®ç°**ï¼š
```python
async def callback_java_api(project_id: str, node_id: str, status: str, result: dict = None):
    """å›è°ƒJavaæ¥å£æ›´æ–°çŠ¶æ€å¹¶è§¦å‘WebSocketæ¨é€"""
    callback_data = {
        "projectId": project_id,
        "nodeId": node_id,
        "status": status,  # running, completed, failed
        "result": result,
        "timestamp": int(time.time() * 1000)
    }

    async with aiohttp.ClientSession() as session:
        await session.post(
            f"{JAVA_BACKEND_URL}/api/workflow/callback/status",
            json=callback_data
        )
```

**5. æ¶ˆæ¯æ ¼å¼å®šä¹‰**ï¼š
```json
{
  "type": "node_status",           // æ¶ˆæ¯ç±»å‹
  "projectId": "project_123",      // é¡¹ç›®ID
  "nodeId": "node_001",           // èŠ‚ç‚¹ID
  "status": "completed",          // çŠ¶æ€ï¼šrunning/completed/failed
  "result": {                     // èŠ‚ç‚¹æ‰§è¡Œç»“æœ
    "output_data": {},
    "output_files": ["objectName1", "objectName2"],
    "file_urls": ["url1", "url2"]  // å‰ç«¯é¢„è§ˆç”¨çš„å®Œæ•´URL
  },
  "timestamp": 1634567890123      // æ—¶é—´æˆ³
}
```

**6. å‰ç«¯å¤„ç†é€»è¾‘**ï¼š
```javascript
function handleWorkflowUpdate(message) {
    switch(message.type) {
        case 'node_status':
            updateNodeUI(message.nodeId, message.status);
            if (message.result && message.result.file_urls) {
                showPreviewFiles(message.result.file_urls);
            }
            break;
        case 'workflow_complete':
            showFinalResult(message.result);
            break;
        case 'error':
            showErrorMessage(message.error);
            break;
    }
}
```

**ä¼˜åŠ¿**ï¼š
- **è§£è€¦åˆ**ï¼šPythonä¸“æ³¨æ‰§è¡Œï¼ŒJavaä¸“æ³¨è¿æ¥ç®¡ç†
- **å®æ—¶æ€§**ï¼šèŠ‚ç‚¹çŠ¶æ€å˜åŒ–ç«‹å³æ¨é€åˆ°å‰ç«¯
- **å¯é æ€§**ï¼šé€šè¿‡å›è°ƒæ¥å£ä¿è¯æ¶ˆæ¯æŠ•é€’
- **æ‰©å±•æ€§**ï¼šæ”¯æŒå¤šç§æ¶ˆæ¯ç±»å‹å’Œå¤šé¡¹ç›®å¹¶å‘

## æ•°æ®åº“è®¾è®¡

### 1. AIé¡¹ç›®è¡¨ (ai_project)
```sql
CREATE TABLE ai_project (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    prompt TEXT NOT NULL,           -- ç”¨æˆ·è¾“å…¥çš„æç¤ºè¯
    uploaded_files JSON,            -- ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨
    status INT DEFAULT 0,           -- 0:åˆ›å»ºä¸­ 1:æ‰§è¡Œä¸­ 2:å·²å®Œæˆ 3:å¤±è´¥
    member_id BIGINT NOT NULL,      -- æ‰€å±ç”¨æˆ·ID
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 2. AIä»»åŠ¡è¡¨ (ai_task)
```sql
CREATE TABLE ai_task (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    project_id BIGINT NOT NULL,
    task_type VARCHAR(100) NOT NULL,
    status INT DEFAULT 0,           -- 0:å¾…æ‰§è¡Œ 1:æ‰§è¡Œä¸­ 2:å·²å®Œæˆ 3:å¤±è´¥
    workflow_json TEXT,             -- å·¥ä½œæµå®šä¹‰JSON
    current_step INT DEFAULT 0,     -- å½“å‰æ‰§è¡Œæ­¥éª¤
    total_steps INT DEFAULT 0,      -- æ€»æ­¥éª¤æ•°
    python_task_id VARCHAR(100),    -- Pythonåç«¯ä»»åŠ¡ID
    result_files JSON,              -- æœ€ç»ˆç»“æœæ–‡ä»¶åˆ—è¡¨
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 3. å·¥ä½œæµæ‰§è¡Œè®°å½•è¡¨ (ai_workflow_execution)
```sql
CREATE TABLE ai_workflow_execution (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    task_id BIGINT NOT NULL,
    node_id VARCHAR(100) NOT NULL,      -- èŠ‚ç‚¹å”¯ä¸€ID
    tool_uuid VARCHAR(100) NOT NULL,    -- å·¥å…·UUID
    tool_name VARCHAR(100) NOT NULL,    -- å·¥å…·åç§°
    step_index INT NOT NULL,            -- æ­¥éª¤ç´¢å¼•
    status INT DEFAULT 0,               -- 0:å¾…æ‰§è¡Œ 1:æ‰§è¡Œä¸­ 2:å·²å®Œæˆ 3:å¤±è´¥
    input_data TEXT,                    -- è¾“å…¥æ•°æ®JSON
    output_data TEXT,                   -- è¾“å‡ºæ•°æ®JSON
    output_files JSON,                  -- è¾“å‡ºæ–‡ä»¶åˆ—è¡¨ï¼ˆé¡¹ç›®å­˜å‚¨objectNameï¼‰
    original_files JSON,                -- åŸå§‹æ–‡ä»¶åˆ—è¡¨ï¼ˆç¬¬ä¸‰æ–¹APIè¿”å›é“¾æ¥ï¼‰
    preview_required BOOLEAN DEFAULT FALSE, -- æ˜¯å¦éœ€è¦å‰ç«¯é¢„è§ˆ
    error_message TEXT,                 -- é”™è¯¯ä¿¡æ¯
    start_time DATETIME,
    end_time DATETIME,
    duration_ms INT,                    -- æ‰§è¡Œè€—æ—¶(æ¯«ç§’)
    creator_id BIGINT,                  -- åˆ›å»ºè€…ID
    workflow_id VARCHAR(100),           -- å·¥ä½œæµID
    parent_node_id VARCHAR(100),        -- çˆ¶èŠ‚ç‚¹ID
    sort_order INT                      -- èŠ‚ç‚¹æ’åº
);
```

### 4. AIå·¥å…·æ³¨å†Œè¡¨ (ai_tool)
```sql
CREATE TABLE ai_tool (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    tool_uuid VARCHAR(100) UNIQUE NOT NULL,  -- å·¥å…·UUID
    tool_name VARCHAR(100) NOT NULL,         -- å·¥å…·åç§°
    tool_description TEXT,                   -- å·¥å…·æè¿°
    tool_type VARCHAR(50) NOT NULL,          -- å·¥å…·ç±»å‹(image,video,audio,text)
    input_schema JSON,                       -- è¾“å…¥å‚æ•°Schema
    output_schema JSON,                      -- è¾“å‡ºå‚æ•°Schema
    preview_required BOOLEAN DEFAULT FALSE,  -- æ˜¯å¦éœ€è¦å‰ç«¯é¢„è§ˆ
    is_local BOOLEAN DEFAULT FALSE,          -- æ˜¯å¦æœ¬åœ°å·¥å…·
    api_endpoint VARCHAR(255),               -- APIç«¯ç‚¹
    status INT DEFAULT 1,                    -- å·¥å…·çŠ¶æ€ 0:ç¦ç”¨ 1:å¯ç”¨
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 7. å®ç°ç¤ºä¾‹

#### 7.1 æ–‡ä»¶è½¬æ¢æœåŠ¡å®ç°

```java
@Service
@Slf4j
public class FileConversionServiceImpl implements FileConversionService {

    @Autowired
    private OssService ossService;

    @Value("${file.conversion.temp-dir:/tmp/tool-files/}")
    private String tempDir;

    @Value("${file.conversion.retry-times:3}")
    private int retryTimes;

    @Override
    public List<String> convertFilesToStorage(List<String> originalFiles, String nodeId) {
        if (CollectionUtils.isEmpty(originalFiles)) {
            return new ArrayList<>();
        }

        List<String> outputFiles = new ArrayList<>();
        List<File> tempFiles = new ArrayList<>();

        try {
            // åˆ›å»ºä¸´æ—¶ç›®å½•
            String nodeTempDir = tempDir + "/" + nodeId;
            FileUtils.forceMkdir(new File(nodeTempDir));

            // å¹¶å‘ä¸‹è½½åŸå§‹æ–‡ä»¶
            List<CompletableFuture<DownloadResult>> downloadFutures = originalFiles.stream()
                .map(url -> CompletableFuture.supplyAsync(() -> downloadWithRetry(url, nodeTempDir)))
                .collect(Collectors.toList());

            // ç­‰å¾…æ‰€æœ‰ä¸‹è½½å®Œæˆ
            CompletableFuture.allOf(downloadFutures.toArray(new CompletableFuture[0])).join();

            // å¤„ç†ä¸‹è½½ç»“æœ
            for (CompletableFuture<DownloadResult> future : downloadFutures) {
                DownloadResult result = future.get();
                if (result.isSuccess()) {
                    tempFiles.add(result.getFile());

                    // ä¸Šä¼ åˆ°å­˜å‚¨ç³»ç»Ÿ
                    String objectName = uploadWithRetry(result.getFile());
                    if (objectName != null) {
                        outputFiles.add(objectName);
                    }
                } else {
                    log.error("æ–‡ä»¶ä¸‹è½½å¤±è´¥: {}, é”™è¯¯: {}", result.getOriginalUrl(), result.getError());
                }
            }

        } catch (Exception e) {
            log.error("æ–‡ä»¶è½¬æ¢æœåŠ¡å¼‚å¸¸", e);
        } finally {
            // æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            cleanupTempFiles(tempFiles);
        }

        return outputFiles;
    }

    private DownloadResult downloadWithRetry(String originalUrl, String tempDir) {
        for (int i = 0; i < retryTimes; i++) {
            try {
                File file = downloadFile(originalUrl, tempDir);
                return DownloadResult.success(file, originalUrl);
            } catch (Exception e) {
                log.warn("ç¬¬{}æ¬¡ä¸‹è½½å¤±è´¥: {}, é”™è¯¯: {}", i + 1, originalUrl, e.getMessage());
                if (i == retryTimes - 1) {
                    return DownloadResult.failure(originalUrl, e.getMessage());
                }
                // ç­‰å¾…åé‡è¯•
                try {
                    Thread.sleep(1000 * (i + 1));
                } catch (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    break;
                }
            }
        }
        return DownloadResult.failure(originalUrl, "é‡è¯•æ¬¡æ•°è€—å°½");
    }

    private String uploadWithRetry(File file) {
        for (int i = 0; i < retryTimes; i++) {
            try {
                return uploadToStorage(file);
            } catch (Exception e) {
                log.warn("ç¬¬{}æ¬¡ä¸Šä¼ å¤±è´¥: {}, é”™è¯¯: {}", i + 1, file.getName(), e.getMessage());
                if (i < retryTimes - 1) {
                    try {
                        Thread.sleep(1000 * (i + 1));
                    } catch (InterruptedException ie) {
                        Thread.currentThread().interrupt();
                        break;
                    }
                }
            }
        }
        return null;
    }
}
```

#### 7.2 å·¥å…·èŠ‚ç‚¹å¤„ç†æµç¨‹

```java
@Service
public class ToolNodeProcessor {

    @Autowired
    private FileConversionService fileConversionService;

    /**
     * å¤„ç†å·¥å…·èŠ‚ç‚¹æ‰§è¡Œç»“æœ
     */
    public void processToolNodeResult(ToolNodeResult nodeResult) {
        try {
            // 1. æ›´æ–°èŠ‚ç‚¹çŠ¶æ€ä¸ºæ‰§è¡Œä¸­
            updateNodeStatus(nodeResult.getNodeId(), NodeStatus.PROCESSING);

            // 2. å¤„ç†original_filesè½¬æ¢ä¸ºoutput_files
            if (CollectionUtils.isNotEmpty(nodeResult.getOriginalFiles())) {
                List<String> outputFiles = fileConversionService.convertFilesToStorage(
                    nodeResult.getOriginalFiles(),
                    nodeResult.getNodeId()
                );
                nodeResult.setOutputFiles(outputFiles);
            }

            // 3. ä¿å­˜èŠ‚ç‚¹æ‰§è¡Œç»“æœ
            saveNodeResult(nodeResult);

            // 4. æ›´æ–°èŠ‚ç‚¹çŠ¶æ€ä¸ºå®Œæˆ
            updateNodeStatus(nodeResult.getNodeId(), NodeStatus.COMPLETED);

            // 5. å¦‚æœéœ€è¦é¢„è§ˆï¼Œæ¨é€ç»“æœåˆ°å‰ç«¯
            if (nodeResult.isPreviewRequired()) {
                pushResultToFrontend(nodeResult);
            }

        } catch (Exception e) {
            log.error("å¤„ç†å·¥å…·èŠ‚ç‚¹ç»“æœå¤±è´¥: {}", nodeResult.getNodeId(), e);
            updateNodeStatus(nodeResult.getNodeId(), NodeStatus.FAILED);
            updateNodeError(nodeResult.getNodeId(), e.getMessage());
        }
    }
}
```

## APIæ¥å£è®¾è®¡

### Javaåç«¯æ–°å¢API

#### 1. é¡¹ç›®ç®¡ç†API
```java
@RestController
@RequestMapping("/api/ai/project")
public class AIProjectController {

    @PostMapping("/create")
    CommonResult<AIProject> createProject(@RequestBody CreateProjectParam param);

    @GetMapping("/list")
    CommonResult<List<AIProjectListResult>> getProjectList(@RequestParam Long memberId);

    @GetMapping("/{id}")
    CommonResult<AIProjectDetailResult> getProjectDetail(@PathVariable Long id);

    @DeleteMapping("/{id}")
    CommonResult<Void> deleteProject(@PathVariable Long id);
}
```

#### 2. AIä»»åŠ¡API
```java
@RestController
@RequestMapping("/api/ai/task")
public class AITaskController {

    @PostMapping("/submit")
    CommonResult<AITask> submitTask(@RequestBody SubmitTaskParam param);

    @GetMapping("/{taskId}/status")
    CommonResult<TaskStatusResult> getTaskStatus(@PathVariable Long taskId);

    @GetMapping("/{taskId}/workflow")
    CommonResult<WorkflowStatusResult> getWorkflowStatus(@PathVariable Long taskId);

    @PostMapping("/{taskId}/stop")
    CommonResult<Void> stopTask(@PathVariable Long taskId);
}
```

### Python FastAPIæ¥å£

#### 1. å·¥ä½œæµAPI
```python
@router.post("/workflow/generate")
async def generate_workflow(request: WorkflowGenerateRequest) -> WorkflowResponse:
    """æ ¹æ®æç¤ºè¯ç”Ÿæˆå·¥ä½œæµ"""
    pass

@router.post("/workflow/execute")
async def execute_workflow(request: WorkflowExecuteRequest) -> TaskResponse:
    """æ‰§è¡Œå·¥ä½œæµ"""
    pass

@router.get("/workflow/{task_id}/status")
async def get_workflow_status(task_id: str) -> WorkflowStatusResponse:
    """è·å–å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€"""
    pass
```

#### 2. AIå·¥å…·API
```python
@router.get("/tools/list")
async def list_tools() -> ToolListResponse:
    """è·å–å¯ç”¨å·¥å…·åˆ—è¡¨"""
    pass

@router.post("/tools/{tool_uuid}/execute")
async def execute_tool(tool_uuid: str, request: ToolExecuteRequest) -> ToolResponse:
    """æ‰§è¡ŒæŒ‡å®šå·¥å…·"""
    pass
```

## å®æ–½ä¼˜å…ˆçº§

### Phase 1: åŸºç¡€æ¶æ„ (3-4å¤©)
1. åˆ›å»ºPython FastAPIé¡¹ç›®åŸºç¡€ç»“æ„
2. æ•°æ®åº“è¡¨è®¾è®¡å’Œåˆ›å»º
3. Javaåç«¯APIæ¡†æ¶æ­å»º
4. åŸºç¡€çš„é¡¹ç›®CRUDåŠŸèƒ½
5. **AIæ¨¡å‹é€‚é…å™¨æ¶æ„å®ç°**
   - å®šä¹‰BaseAIAdapteræŠ½è±¡åŸºç±»
   - å®ç°AIAdapterFactoryå·¥å‚ç±»
   - é…ç½®ç®¡ç†ç³»ç»Ÿè®¾è®¡
   - é€‚é…å™¨æ³¨å†Œå’Œå‘ç°æœºåˆ¶

### Phase 2: æ··åˆå¹³å°AIå·¥å…·é›†æˆ (5-6å¤©)

#### ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒæ¶æ„å®ç° (Day 1-2)
1. **æ™ºèƒ½é€‚é…å™¨é€‰æ‹©å™¨å®ç°**
   - SmartAdapterSelectoræ ¸å¿ƒé€»è¾‘
   - æ··åˆå¹³å°é…ç½®ç®¡ç†ç³»ç»Ÿ
   - é™çº§ç­–ç•¥å’Œå¥åº·æ£€æŸ¥æœºåˆ¶
   - æ€§èƒ½ç›‘æ§å’Œä½¿ç”¨ç»Ÿè®¡

2. **è±†åŒ…é€‚é…å™¨å®Œå–„**
   - åŸºäºå¼‚æ­¥ä»»åŠ¡æ¨¡å¼çš„æ ¸å¿ƒæ¶æ„ï¼ˆâœ… å·²æœ‰å›¾ç”Ÿè§†é¢‘ï¼‰
   - å®Œå–„å…¶ä½™APIæ¥å£å®ç°
   - ç»Ÿä¸€çš„HTTPè¯·æ±‚å°è£…å’Œé”™è¯¯å¤„ç†

#### ç¬¬äºŒé˜¶æ®µï¼šå¤šå¹³å°é€‚é…å™¨å®ç° (Day 3-4)
1. **é€šä¹‰åƒé—®é€‚é…å™¨** - ä¸“ç²¾å›¾åƒç”Ÿæˆ
   - TongYiAdapteråŸºç¡€å®ç°
   - text_to_imageä¼˜è´¨å®ç°ï¼ˆä¸»åŠ›ï¼‰
   - image_to_imageä¼˜è´¨å®ç°ï¼ˆä¸»åŠ›ï¼‰
   - å…¶ä»–æ¥å£åŸºç¡€å®ç°ï¼ˆå¤‡ç”¨ï¼‰

2. **æ–‡å¿ƒä¸€è¨€é€‚é…å™¨** - ä¸“ç²¾éŸ³é¢‘å¤„ç†
   - WenXinAdapteråŸºç¡€å®ç°
   - generate_musicä¼˜è´¨å®ç°ï¼ˆä¸»åŠ›ï¼‰
   - text_to_speechä¼˜è´¨å®ç°ï¼ˆä¸»åŠ›ï¼‰
   - å…¶ä»–æ¥å£åŸºç¡€å®ç°ï¼ˆå¤‡ç”¨ï¼‰

3. **è±†åŒ…é€‚é…å™¨è¡¥å…¨** - ä¸“ç²¾è§†é¢‘ç”Ÿæˆ
   - image_to_videoä¼˜è´¨å®ç°ï¼ˆâœ… å·²å®Œæˆï¼‰
   - text_to_videoä¼˜è´¨å®ç°ï¼ˆâœ… å·²å®Œæˆï¼‰
   - speech_to_subtitleä¼˜è´¨å®ç°ï¼ˆä¸»åŠ›ï¼‰
   - æ–‡ç”Ÿå›¾ã€å›¾ç”Ÿå›¾åŸºç¡€å®ç°ï¼ˆå¤‡ç”¨ï¼‰

#### ç¬¬ä¸‰é˜¶æ®µï¼šæ··åˆå¹³å°é›†æˆæµ‹è¯• (Day 5-6)
1. **æ··åˆå·¥ä½œæµæµ‹è¯•**
   - å›¾åƒç”Ÿæˆï¼ˆé€šä¹‰ï¼‰â†’ è§†é¢‘ç”Ÿæˆï¼ˆè±†åŒ…ï¼‰â†’ éŸ³é¢‘å¤„ç†ï¼ˆæ–‡å¿ƒï¼‰
   - æ•…éšœè½¬ç§»æµ‹è¯•ï¼šä¸»å¹³å°æŒ‚æ‰åè‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨å¹³å°
   - æˆæœ¬ä¼˜åŒ–æµ‹è¯•ï¼šæ ¹æ®é…ç½®é€‰æ‹©æœ€ç»æµçš„å¹³å°ç»„åˆ

2. **å¹³å°æ€§èƒ½å¯¹æ¯”**
   - å„å¹³å°åœ¨ä¸åŒä»»åŠ¡ä¸Šçš„è´¨é‡å¯¹æ¯”
   - æˆæœ¬æ•ˆç›Šåˆ†æå’Œä¼˜åŒ–å»ºè®®
   - å“åº”æ—¶é—´å’Œç¨³å®šæ€§æµ‹è¯•

3. **é…ç½®ç®¡ç†å’Œç›‘æ§**
   - çƒ­é…ç½®æ›´æ–°åŠŸèƒ½
   - å¹³å°ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ
   - å‘Šè­¦å’Œæ•…éšœæ¢å¤æœºåˆ¶

**Phase 2 çš„å…³é”®äº¤ä»˜ç‰©ï¼š**
- âœ… æ™ºèƒ½é€‚é…å™¨é€‰æ‹©ç³»ç»Ÿ
- âœ… ä¸‰å¤§å¹³å°é€‚é…å™¨ï¼ˆè±†åŒ…ã€é€šä¹‰ã€æ–‡å¿ƒï¼‰
- âœ… æ··åˆå¹³å°é…ç½®ç®¡ç†
- âœ… æ•…éšœè½¬ç§»å’Œæ€§èƒ½ç›‘æ§
- âœ… å®Œæ•´çš„æ··åˆå·¥ä½œæµæµ‹è¯•æŠ¥å‘Š

**å¹³å°èƒ½åŠ›åˆ†å·¥ï¼š**
```text
ğŸ“¸ å›¾åƒä»»åŠ¡  â†’ é€šä¹‰åƒé—®ï¼ˆä¸»ï¼‰+ è±†åŒ…ï¼ˆå¤‡ï¼‰+ æ–‡å¿ƒï¼ˆå¤‡ï¼‰
ğŸ¬ è§†é¢‘ä»»åŠ¡  â†’ è±†åŒ…ï¼ˆä¸»ï¼‰+ é€šä¹‰ï¼ˆå¤‡ï¼‰+ æ–‡å¿ƒï¼ˆå¤‡ï¼‰
ğŸµ éŸ³é¢‘ä»»åŠ¡  â†’ æ–‡å¿ƒï¼ˆä¸»ï¼‰+ è±†åŒ…ï¼ˆå¤‡ï¼‰+ é€šä¹‰ï¼ˆå¤‡ï¼‰
```

### Phase 3: å·¥ä½œæµå¼•æ“ (4-5å¤©)
1. LLMå·¥ä½œæµç”Ÿæˆé€»è¾‘
2. å·¥ä½œæµæ‰§è¡Œå¼•æ“
3. çŠ¶æ€ç®¡ç†å’Œä¸­æ–­æ¢å¤
4. å‚æ•°ä¼ é€’å’ŒéªŒè¯

### Phase 4: å‰ç«¯é‡æ„ (3-4å¤©)
1. ä»»åŠ¡æ‰§è¡Œé¡µé¢UIé‡æ„
2. WebSocketå®æ—¶é€šä¿¡é›†æˆ
3. ä¸­é—´ç»“æœé¢„è§ˆåŠŸèƒ½
4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### Phase 5: é›†æˆæµ‹è¯• (2-3å¤©)
1. ç«¯åˆ°ç«¯æµç¨‹æµ‹è¯•
2. é”™è¯¯å¤„ç†æµ‹è¯•
3. æ€§èƒ½ä¼˜åŒ–
4. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

## æˆåŠŸæ ‡å‡†

### åŸºç¡€åŠŸèƒ½æ ‡å‡†
1. **åŠŸèƒ½å®Œæ•´æ€§**ï¼šç”¨æˆ·å¯ä»¥è¾“å…¥æç¤ºè¯å’Œå›¾ç‰‡ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå®Œæ•´è§†é¢‘
2. **å®æ—¶åé¦ˆ**ï¼šå·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‰ç«¯èƒ½å®æ—¶æ˜¾ç¤ºè¿›åº¦å’Œä¸­é—´ç»“æœ
3. **ç¨³å®šæ€§**ï¼šç³»ç»Ÿåœ¨å¼‚å¸¸æƒ…å†µä¸‹èƒ½å¤Ÿæ¢å¤å’Œç»§ç»­æ‰§è¡Œ
4. **æ€§èƒ½**ï¼šå•ä¸ªä»»åŠ¡å¤„ç†æ—¶é—´åœ¨åˆç†èŒƒå›´å†…ï¼ˆ10-30åˆ†é’Ÿï¼‰
5. **ç”¨æˆ·ä½“éªŒ**ï¼šç•Œé¢å‹å¥½ï¼Œæ“ä½œç®€å•ï¼Œé”™è¯¯æç¤ºæ¸…æ™°

### æ··åˆå¹³å°é›†æˆæ ‡å‡†
6. **å¹³å°æ™ºèƒ½é€‰æ‹©**ï¼šç³»ç»Ÿèƒ½æ ¹æ®ä»»åŠ¡ç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ä½³AIå¹³å°
   - æ–‡ç”Ÿå›¾è‡ªåŠ¨é€‰æ‹©é€šä¹‰åƒé—®
   - å›¾ç”Ÿè§†é¢‘è‡ªåŠ¨é€‰æ‹©è±†åŒ…
   - éŸ³é¢‘å¤„ç†è‡ªåŠ¨é€‰æ‹©æ–‡å¿ƒä¸€è¨€
7. **æ•…éšœè‡ªåŠ¨è½¬ç§»**ï¼šä¸»å¹³å°ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨å¹³å°ï¼ŒæˆåŠŸç‡â‰¥95%
8. **æˆæœ¬ä¼˜åŒ–**ï¼šåœ¨ä¿è¯è´¨é‡å‰æä¸‹ï¼Œå¹³å‡æˆæœ¬æ¯”å•ä¸€å¹³å°é™ä½20-30%
9. **é…ç½®çƒ­æ›´æ–°**ï¼šæ”¯æŒä¸é‡å¯æœåŠ¡çš„å¹³å°é…ç½®æ›´æ–°
10. **æ€§èƒ½ç›‘æ§**ï¼šå®æ—¶ç›‘æ§å„å¹³å°ä½¿ç”¨æƒ…å†µã€æˆåŠŸç‡ã€å“åº”æ—¶é—´

## é£é™©å’ŒæŒ‘æˆ˜

1. **AIæœåŠ¡ç¨³å®šæ€§**ï¼šç¬¬ä¸‰æ–¹AI APIçš„å¯ç”¨æ€§å’Œå“åº”æ—¶é—´
2. **æ–‡ä»¶å¤„ç†æ€§èƒ½**ï¼šå¤§è§†é¢‘æ–‡ä»¶çš„ä¸Šä¼ ä¸‹è½½å’Œå¤„ç†æ•ˆç‡
3. **å·¥ä½œæµå¤æ‚åº¦**ï¼šåŠ¨æ€ç”Ÿæˆçš„å·¥ä½œæµå¯èƒ½è¿‡äºå¤æ‚éš¾ä»¥æ‰§è¡Œ
4. **æˆæœ¬æ§åˆ¶**ï¼šAI APIè°ƒç”¨è´¹ç”¨çš„æ§åˆ¶å’Œä¼˜åŒ–
5. **å¹¶å‘å¤„ç†**ï¼šå¤šç”¨æˆ·åŒæ—¶ä½¿ç”¨æ—¶çš„èµ„æºåˆ†é…å’Œæ€§èƒ½ä¿è¯

## åç»­æ‰©å±•

### åŸºç¡€åŠŸèƒ½æ‰©å±•
1. **æ¨¡æ¿åº“**ï¼šé¢„å®šä¹‰å¸¸ç”¨çš„å·¥ä½œæµæ¨¡æ¿
2. **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒæ‰¹é‡ä¸Šä¼ å’Œæ‰¹é‡ç”Ÿæˆ
3. **ç¤¾åŒºåŠŸèƒ½**ï¼šç”¨æˆ·åˆ†äº«ä½œå“å’Œæ¨¡æ¿
4. **APIå¼€æ”¾**ï¼šä¸ºç¬¬ä¸‰æ–¹å¼€å‘è€…æä¾›APIæ¥å£
5. **ç§»åŠ¨ç«¯æ”¯æŒ**ï¼šå¼€å‘ç§»åŠ¨ç«¯åº”ç”¨

### æ··åˆå¹³å°æ‰©å±•
6. **æ›´å¤šAIå¹³å°æ¥å…¥**ï¼š
   - å›½é™…å¹³å°ï¼šOpenAI GPT-4, Claude, Midjourney, Runway
   - å›½å†…å¹³å°ï¼šæ™ºè°±AI, ç™¾å·æ™ºèƒ½, MiniMax
   - å¼€æºæ¨¡å‹ï¼šStable Diffusion, LLaMAç­‰æœ¬åœ°éƒ¨ç½²
7. **æ™ºèƒ½æˆæœ¬æ§åˆ¶**ï¼š
   - AIé¢„ç®—ç®¡ç†å’Œç”¨é‡é™åˆ¶
   - å®æ—¶æˆæœ¬ç›‘æ§å’Œå‘Šè­¦
   - æˆæœ¬ä¼˜åŒ–å»ºè®®å¼•æ“
8. **å¹³å°æ€§èƒ½ä¼˜åŒ–**ï¼š
   - è´Ÿè½½å‡è¡¡å’Œå¹¶å‘æ§åˆ¶
   - ç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤è°ƒç”¨
   - é¢„æµ‹æ€§æ•…éšœæ£€æµ‹
9. **ä¼ä¸šçº§åŠŸèƒ½**ï¼š
   - å¤šç§Ÿæˆ·å¹³å°é…ç½®éš”ç¦»
   - ç²¾ç»†åŒ–æƒé™æ§åˆ¶
   - å®¡è®¡æ—¥å¿—å’Œåˆè§„æ€§æ”¯æŒ

### æŠ€æœ¯åˆ›æ–°æ‰©å±•
10. **AIæ¨¡å‹è‡ªåŠ¨è¯„ä¼°**ï¼šæ ¹æ®ä»»åŠ¡ç»“æœè‡ªåŠ¨è°ƒæ•´å¹³å°é€‰æ‹©ç­–ç•¥
11. **æ··åˆæ¨ç†**ï¼šåŒæ—¶è°ƒç”¨å¤šä¸ªå¹³å°å¯¹æ¯”ç»“æœï¼Œé€‰æ‹©æœ€ä½³è¾“å‡º
12. **è¾¹ç¼˜è®¡ç®—é›†æˆ**ï¼šæœ¬åœ°æ¨¡å‹ + äº‘ç«¯æ¨¡å‹æ··åˆéƒ¨ç½²
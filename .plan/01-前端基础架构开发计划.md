# 第一阶段: 前端基础架构开发计划

## 阶段概述
**时间周期**: 2周  
**优先级**: 最高  
**目标**: 搭建完整的前端开发基础架构，为后续功能开发提供稳定的技术底座

## 技术选型详细说明

### 核心框架
- **React 18**: 利用最新的并发特性，提供更好的用户体验
- **TypeScript 5.x**: 提供类型安全，提高代码质量和开发效率
- **Vite 5.x**: 快速的构建工具，支持热更新和优化的生产构建

### 开发工具配置
- **ESLint**: 代码质量检查
- **Prettier**: 代码格式化
- **Husky**: Git hooks管理
- **lint-staged**: 暂存区代码检查
- **Commitizen**: 规范化提交信息

## 详细开发任务

### 1. 项目初始化 (第1天)

#### 1.1 创建Vite项目
```bash
npm create vite@latest beilv-frontend -- --template react-ts
cd beilv-frontend
npm install
```

#### 1.2 配置开发环境
**任务清单**:
- [ ] 配置Vite开发服务器
- [ ] 设置环境变量管理
- [ ] 配置路径别名(@符号)
- [ ] 配置代理服务器连接后端API

**环境变量配置示例**:
```env
# .env.development
VITE_API_BASE_URL=http://localhost:8080/api
VITE_APP_TITLE=BEILV AI Development

# .env.production  
VITE_API_BASE_URL=https://api.beilv.com/api
VITE_APP_TITLE=BEILV AI
```

#### 1.3 配置代码规范
**ESLint配置**:
```json
{
  "extends": [
    "@typescript-eslint/recommended",
    "plugin:react-hooks/recommended",
    "plugin:react/recommended"
  ],
  "rules": {
    "react/react-in-jsx-scope": "off",
    "@typescript-eslint/no-unused-vars": "error"
  }
}
```

**Prettier配置**:
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2
}
```

### 2. 路由系统搭建 (第2天)

#### 2.1 安装React Router
```bash
npm install react-router-dom @types/react-router-dom
```

#### 2.2 设计路由结构
```typescript
// src/router/routes.ts
export const routes = [
  {
    path: '/',
    element: <MainLayout />,
    children: [
      { path: '', element: <HomePage /> },
      { path: 'login', element: <LoginPage /> },
      { path: 'register', element: <RegisterPage /> },
      { path: 'profile', element: <ProfilePage />, auth: true },
      { path: 'credits', element: <CreditsPage />, auth: true },
      { path: 'plans', element: <PlansPage /> },
      { path: 'purchase', element: <PurchasePage />, auth: true },
    ]
  }
];
```

#### 2.3 实现路由守卫
**功能要求**:
- [ ] 实现登录状态检查
- [ ] 实现权限验证
- [ ] 实现未登录重定向
- [ ] 实现404页面处理

### 3. 状态管理系统 (第3-4天)

#### 3.1 Redux Toolkit配置
```bash
npm install @reduxjs/toolkit react-redux
```

#### 3.2 Store结构设计
```typescript
// src/store/index.ts
export const store = configureStore({
  reducer: {
    auth: authSlice.reducer,
    user: userSlice.reducer,
    credits: creditsSlice.reducer,
    ui: uiSlice.reducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: {
        ignoredActions: [FLUSH, REHYDRATE, PAUSE, PERSIST, PURGE, REGISTER],
      },
    }).concat(api.middleware),
});
```

#### 3.3 状态切片设计
**认证状态 (authSlice)**:
```typescript
interface AuthState {
  isAuthenticated: boolean;
  token: string | null;
  refreshToken: string | null;
  user: User | null;
  loading: boolean;
}
```

**用户状态 (userSlice)**:
```typescript
interface UserState {
  profile: UserProfile | null;
  preferences: UserPreferences;
  loading: boolean;
}
```

**积分状态 (creditsSlice)**:
```typescript
interface CreditsState {
  totalCredits: number;
  freeCredits: number;
  usedCredits: number;
  history: CreditHistory[];
  loading: boolean;
}
```

### 4. HTTP请求封装 (第5天)

#### 4.1 Axios配置
```bash
npm install axios
```

#### 4.2 请求拦截器实现
**功能要求**:
- [ ] 自动添加认证头
- [ ] 请求/响应日志记录
- [ ] 错误统一处理
- [ ] Token自动刷新
- [ ] 请求取消管理

```typescript
// src/utils/request.ts
const apiClient = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000,
});

apiClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);
```

#### 4.3 RTK Query API设计
```typescript
// src/api/baseApi.ts
export const api = createApi({
  reducerPath: 'api',
  baseQuery: fetchBaseQuery({
    baseUrl: '/api/',
    prepareHeaders: (headers, { getState }) => {
      const token = (getState() as RootState).auth.token;
      if (token) {
        headers.set('authorization', `Bearer ${token}`);
      }
      return headers;
    },
  }),
  tagTypes: ['User', 'Credits', 'Plans', 'Orders'],
  endpoints: () => ({}),
});
```

### 5. 多语言国际化系统 (第6天)

#### 5.1 i18next配置
```bash
npm install react-i18next i18next i18next-browser-languagedetector
```

#### 5.2 语言资源文件结构
```
src/locales/
├── zh-CN/
│   ├── common.json
│   ├── auth.json
│   ├── credits.json
│   └── plans.json
├── en-US/
│   ├── common.json
│   ├── auth.json
│   ├── credits.json
│   └── plans.json
└── index.ts
```

#### 5.3 语言切换组件
```typescript
// components/LanguageSwitch.tsx
const LanguageSwitch: React.FC = () => {
  const { i18n } = useTranslation();
  
  const handleLanguageChange = (language: string) => {
    i18n.changeLanguage(language);
    localStorage.setItem('language', language);
  };
  
  return (
    <Select value={i18n.language} onChange={handleLanguageChange}>
      <Option value="zh-CN">简体中文</Option>
      <Option value="en-US">English</Option>
    </Select>
  );
};
```

### 6. UI组件库集成 (第7天)

#### 6.1 选择UI框架
**推荐方案**: Ant Design 5.x
```bash
npm install antd @ant-design/icons
```

**备选方案**: Material-UI v5
```bash
npm install @mui/material @mui/icons-material @emotion/react @emotion/styled
```

#### 6.2 主题定制
```typescript
// src/theme/index.ts
export const theme = {
  token: {
    colorPrimary: '#ff6b35',
    colorSuccess: '#52c41a',
    colorWarning: '#faad14',
    colorError: '#ff4d4f',
    borderRadius: 8,
    fontSize: 14,
  },
  components: {
    Button: {
      controlHeight: 40,
      fontSize: 14,
    },
    Input: {
      controlHeight: 40,
    },
  },
};
```

#### 6.3 全局样式配置
```typescript
// src/styles/global.ts
export const GlobalStyle = createGlobalStyle`
  * {
    box-sizing: border-box;
  }
  
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    background-color: #f8f9fa;
    color: #333;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
  }
`;
```

### 7. 响应式布局基础 (第8天)

#### 7.1 断点设计
```typescript
// src/utils/breakpoints.ts
export const breakpoints = {
  xs: 0,
  sm: 576,
  md: 768,
  lg: 992,
  xl: 1200,
  xxl: 1600,
};
```

#### 7.2 布局组件实现
```typescript
// components/Layout/MainLayout.tsx
const MainLayout: React.FC = () => {
  return (
    <Layout className="min-h-screen">
      <Header />
      <Layout>
        <Sidebar />
        <Content className="p-6">
          <Outlet />
        </Content>
      </Layout>
    </Layout>
  );
};
```

#### 7.3 响应式工具函数
```typescript
// hooks/useResponsive.ts
export const useResponsive = () => {
  const [windowSize, setWindowSize] = useState({
    width: window.innerWidth,
    height: window.innerHeight,
  });

  useEffect(() => {
    const handleResize = () => {
      setWindowSize({
        width: window.innerWidth,
        height: window.innerHeight,
      });
    };

    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  return {
    isMobile: windowSize.width < breakpoints.md,
    isTablet: windowSize.width >= breakpoints.md && windowSize.width < breakpoints.lg,
    isDesktop: windowSize.width >= breakpoints.lg,
    ...windowSize,
  };
};
```

### 8. 工具函数库 (第9天)

#### 8.1 通用工具函数
```typescript
// src/utils/index.ts

// 格式化数字
export const formatNumber = (num: number): string => {
  if (num >= 1000) {
    return (num / 1000).toFixed(1) + 'k';
  }
  return num.toString();
};

// 防抖函数
export const debounce = <T extends (...args: any[]) => any>(
  func: T,
  delay: number
): ((...args: Parameters<T>) => void) => {
  let timeoutId: NodeJS.Timeout;
  return (...args: Parameters<T>) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => func(...args), delay);
  };
};

// 本地存储操作
export const storage = {
  set: (key: string, value: any) => {
    localStorage.setItem(key, JSON.stringify(value));
  },
  get: <T>(key: string, defaultValue?: T): T | null => {
    const item = localStorage.getItem(key);
    return item ? JSON.parse(item) : defaultValue || null;
  },
  remove: (key: string) => {
    localStorage.removeItem(key);
  },
};
```

#### 8.2 验证工具函数
```typescript
// src/utils/validators.ts
export const validators = {
  email: (email: string): boolean => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  },
  
  password: (password: string): boolean => {
    // 至少8位，包含字母和数字
    const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/;
    return passwordRegex.test(password);
  },
  
  phone: (phone: string): boolean => {
    const phoneRegex = /^1[3-9]\d{9}$/;
    return phoneRegex.test(phone);
  },
};
```

### 9. 错误处理系统 (第10天)

#### 9.1 错误边界组件
```typescript
// components/ErrorBoundary.tsx
class ErrorBoundary extends React.Component<
  { children: React.ReactNode },
  { hasError: boolean; error?: Error }
> {
  constructor(props: { children: React.ReactNode }) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
    // 这里可以发送错误到监控服务
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} />;
    }

    return this.props.children;
  }
}
```

#### 9.2 全局错误处理
```typescript
// src/utils/errorHandler.ts
export const errorHandler = {
  handle: (error: any) => {
    if (error.response) {
      // HTTP错误
      const { status, data } = error.response;
      switch (status) {
        case 401:
          message.error('登录已过期，请重新登录');
          // 清除token并跳转登录页
          break;
        case 403:
          message.error('权限不足');
          break;
        case 500:
          message.error('服务器错误');
          break;
        default:
          message.error(data?.message || '请求失败');
      }
    } else if (error.request) {
      message.error('网络连接失败');
    } else {
      message.error(error.message || '未知错误');
    }
  },
};
```

### 10. 构建配置优化 (第11-12天)

#### 10.1 Vite配置优化
```typescript
// vite.config.ts
export default defineConfig({
  plugins: [
    react(),
    // 代码分割插件
    splitVendorChunkPlugin(),
  ],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          antd: ['antd'],
          utils: ['axios', 'dayjs'],
        },
      },
    },
    // 启用代码压缩
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true,
      },
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
      '@utils': path.resolve(__dirname, 'src/utils'),
      '@api': path.resolve(__dirname, 'src/api'),
    },
  },
});
```

#### 10.2 环境变量管理
```bash
# .env.development
VITE_API_BASE_URL=http://localhost:8080
VITE_APP_TITLE=BEILV AI Dev
VITE_ENABLE_MOCK=true

# .env.production
VITE_API_BASE_URL=https://api.beilv.com
VITE_APP_TITLE=BEILV AI
VITE_ENABLE_MOCK=false
```

#### 10.3 打包脚本配置
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "build:dev": "tsc && vite build --mode development",
    "build:prod": "tsc && vite build --mode production",
    "preview": "vite preview",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "type-check": "tsc --noEmit",
    "test": "jest",
    "test:watch": "jest --watch"
  }
}
```

## 质量保证

### 代码质量检查
- [ ] TypeScript类型检查通过
- [ ] ESLint检查无错误
- [ ] Prettier格式化一致
- [ ] 单元测试覆盖率 > 70%

### 性能指标
- [ ] 首屏加载时间 < 3秒
- [ ] 代码分割正确实现
- [ ] 图片懒加载
- [ ] 打包体积优化

### 兼容性测试
- [ ] Chrome 90+
- [ ] Firefox 90+
- [ ] Safari 14+
- [ ] Edge 90+

## 交付物

### 文档
- [ ] 项目README.md
- [ ] API接口文档
- [ ] 组件使用文档
- [ ] 部署说明文档

### 代码
- [ ] 完整的项目脚手架
- [ ] 基础组件库
- [ ] 工具函数库
- [ ] 类型定义文件

## 验收标准

1. **功能完整性**: 所有计划功能100%实现
2. **代码质量**: 通过所有代码质量检查
3. **性能达标**: 满足所有性能指标要求
4. **文档完善**: 提供完整的开发文档
5. **团队认可**: 团队成员review通过

## 风险与对策

### 技术风险
1. **依赖版本冲突**: 选择稳定版本，做好版本锁定
2. **构建工具问题**: 准备备选方案，如Webpack
3. **第三方库兼容性**: 提前进行兼容性测试

### 进度风险
1. **学习成本**: 团队技术培训和知识分享
2. **需求变更**: 预留缓冲时间
3. **技术难点**: 提前进行技术预研

## 后续规划

基础架构完成后，即可开始第二阶段的用户认证系统开发。确保：
1. 所有基础组件和工具函数经过测试
2. 开发规范和流程已建立
3. 团队成员熟悉项目结构
4. 持续集成流水线搭建完成
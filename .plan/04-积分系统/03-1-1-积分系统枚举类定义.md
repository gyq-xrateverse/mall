# 03-1-1: 积分系统枚举类定义

## 任务概述
**时间**: 第1天上午 (2小时)  
**目标**: 定义积分系统相关的所有枚举类  
**优先级**: 最高  
**依赖**: 积分系统数据库表结构设计完成

## 详细任务清单

### 1.1 积分类型相关枚举

#### 1.1.1 积分类型枚举
```java
// enums/CreditType.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 积分类型枚举
 * 对应数据库字段: ums_integration_change_history.credit_type
 */
@Getter
@AllArgsConstructor
public enum CreditType {
    FREE(1, "free", "免费积分"),
    PERMANENT(2, "permanent", "永久积分");
    
    private final Integer code;
    private final String type;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static CreditType fromCode(Integer code) {
        for (CreditType type : values()) {
            if (type.getCode().equals(code)) {
                return type;
            }
        }
        throw new IllegalArgumentException("Invalid CreditType code: " + code);
    }
    
    /**
     * 根据type获取枚举
     */
    public static CreditType fromType(String type) {
        for (CreditType creditType : values()) {
            if (creditType.getType().equals(type)) {
                return creditType;
            }
        }
        throw new IllegalArgumentException("Invalid CreditType type: " + type);
    }
    
    /**
     * 判断是否为免费积分
     */
    public boolean isFree() {
        return this == FREE;
    }
    
    /**
     * 判断是否为永久积分
     */
    public boolean isPermanent() {
        return this == PERMANENT;
    }
}
```

#### 1.1.2 积分变动类型枚举
```java
// enums/CreditChangeType.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 积分变动类型枚举
 * 对应数据库字段: ums_integration_change_history.change_type
 */
@Getter
@AllArgsConstructor
public enum CreditChangeType {
    GAINED(0, "gained", "获得"),
    CONSUMED(1, "consumed", "消费");
    
    private final Integer code;
    private final String type;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static CreditChangeType fromCode(Integer code) {
        for (CreditChangeType type : values()) {
            if (type.getCode().equals(code)) {
                return type;
            }
        }
        throw new IllegalArgumentException("Invalid CreditChangeType code: " + code);
    }
    
    /**
     * 根据type获取枚举
     */
    public static CreditChangeType fromType(String type) {
        for (CreditChangeType changeType : values()) {
            if (changeType.getType().equals(type)) {
                return changeType;
            }
        }
        throw new IllegalArgumentException("Invalid CreditChangeType type: " + type);
    }
    
    /**
     * 判断是否为获得
     */
    public boolean isGained() {
        return this == GAINED;
    }
    
    /**
     * 判断是否为消费
     */
    public boolean isConsumed() {
        return this == CONSUMED;
    }
    
    /**
     * 获取变动符号
     */
    public String getSymbol() {
        return this == GAINED ? "+" : "-";
    }
}
```

#### 1.1.3 积分来源类型枚举
```java
// enums/CreditSourceType.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 积分来源类型枚举
 * 对应数据库字段: ums_integration_change_history.source_type
 */
@Getter
@AllArgsConstructor
public enum CreditSourceType {
    PURCHASE(0, "purchase", "购买商品"),
    ADMIN_ADJUST(1, "admin", "管理员调整"),
    DAILY_RESET(2, "daily_reset", "每日重置"),
    SYSTEM_REWARD(3, "system_reward", "系统奖励"),
    SUBSCRIPTION_BONUS(4, "subscription", "套餐赠送"),
    REFUND(5, "refund", "退款返还");
    
    private final Integer code;
    private final String type;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static CreditSourceType fromCode(Integer code) {
        for (CreditSourceType type : values()) {
            if (type.getCode().equals(code)) {
                return type;
            }
        }
        throw new IllegalArgumentException("Invalid CreditSourceType code: " + code);
    }
    
    /**
     * 根据type获取枚举
     */
    public static CreditSourceType fromType(String type) {
        for (CreditSourceType sourceType : values()) {
            if (sourceType.getType().equals(type)) {
                return sourceType;
            }
        }
        throw new IllegalArgumentException("Invalid CreditSourceType type: " + type);
    }
    
    /**
     * 判断是否为系统操作
     */
    public boolean isSystemOperation() {
        return this == ADMIN_ADJUST || this == DAILY_RESET || this == SYSTEM_REWARD;
    }
    
    /**
     * 判断是否为用户操作
     */
    public boolean isUserOperation() {
        return this == PURCHASE || this == SUBSCRIPTION_BONUS;
    }
}
```

### 1.2 商品类型相关枚举

#### 1.2.1 商品类型枚举
```java
// enums/ProductType.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 商品类型枚举
 * 对应数据库字段: pms_product.product_type
 */
@Getter
@AllArgsConstructor
public enum ProductType {
    NORMAL(1, "normal", "普通商品"),
    CREDITS(2, "credits", "积分商品"),
    SUBSCRIPTION(3, "subscription", "套餐商品");
    
    private final Integer code;
    private final String type;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static ProductType fromCode(Integer code) {
        for (ProductType type : values()) {
            if (type.getCode().equals(code)) {
                return type;
            }
        }
        throw new IllegalArgumentException("Invalid ProductType code: " + code);
    }
    
    /**
     * 根据type获取枚举
     */
    public static ProductType fromType(String type) {
        for (ProductType productType : values()) {
            if (productType.getType().equals(type)) {
                return productType;
            }
        }
        throw new IllegalArgumentException("Invalid ProductType type: " + type);
    }
    
    /**
     * 判断是否为积分商品
     */
    public boolean isCredits() {
        return this == CREDITS;
    }
    
    /**
     * 判断是否为套餐商品
     */
    public boolean isSubscription() {
        return this == SUBSCRIPTION;
    }
    
    /**
     * 判断是否为普通商品
     */
    public boolean isNormal() {
        return this == NORMAL;
    }
}
```

### 1.3 消费业务相关枚举

#### 1.3.1 业务类型枚举
```java
// enums/BusinessType.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 业务类型枚举
 * 用于标识积分消费的具体业务场景
 */
@Getter
@AllArgsConstructor
public enum BusinessType {
    AI_GENERATION("ai_generation", "AI生成", 10, "使用AI生成内容"),
    IMAGE_GENERATION("image_generation", "图片生成", 15, "AI图片生成"),
    TEXT_GENERATION("text_generation", "文本生成", 5, "AI文本生成"),
    CODE_GENERATION("code_generation", "代码生成", 20, "AI代码生成"),
    TRANSLATION("translation", "翻译服务", 8, "AI翻译服务"),
    ANALYSIS("analysis", "分析服务", 12, "数据分析服务");
    
    private final String code;
    private final String name;
    private final Integer defaultCost;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static BusinessType fromCode(String code) {
        for (BusinessType type : values()) {
            if (type.getCode().equals(code)) {
                return type;
            }
        }
        throw new IllegalArgumentException("Invalid BusinessType code: " + code);
    }
    
    /**
     * 判断是否为AI相关业务
     */
    public boolean isAIBusiness() {
        return this == AI_GENERATION || this == IMAGE_GENERATION || 
               this == TEXT_GENERATION || this == CODE_GENERATION;
    }
    
    /**
     * 获取业务成本等级
     */
    public CostLevel getCostLevel() {
        if (defaultCost <= 10) {
            return CostLevel.LOW;
        } else if (defaultCost <= 15) {
            return CostLevel.MEDIUM;
        } else {
            return CostLevel.HIGH;
        }
    }
    
    public enum CostLevel {
        LOW, MEDIUM, HIGH
    }
}
```

### 1.4 统计相关枚举

#### 1.4.1 统计周期枚举
```java
// enums/StatisticsPeriod.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 统计周期枚举
 * 用于积分使用统计的时间维度
 */
@Getter
@AllArgsConstructor
public enum StatisticsPeriod {
    DAILY(1, "daily", "日", 1),
    WEEKLY(2, "weekly", "周", 7),
    MONTHLY(3, "monthly", "月", 30),
    QUARTERLY(4, "quarterly", "季", 90),
    YEARLY(5, "yearly", "年", 365);
    
    private final Integer code;
    private final String type;
    private final String name;
    private final Integer days;
    
    /**
     * 根据code获取枚举
     */
    public static StatisticsPeriod fromCode(Integer code) {
        for (StatisticsPeriod period : values()) {
            if (period.getCode().equals(code)) {
                return period;
            }
        }
        throw new IllegalArgumentException("Invalid StatisticsPeriod code: " + code);
    }
    
    /**
     * 根据type获取枚举
     */
    public static StatisticsPeriod fromType(String type) {
        for (StatisticsPeriod period : values()) {
            if (period.getType().equals(type)) {
                return period;
            }
        }
        throw new IllegalArgumentException("Invalid StatisticsPeriod type: " + type);
    }
}
```

### 1.5 任务状态相关枚举

#### 1.5.1 任务状态枚举
```java
// enums/TaskStatus.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * AI任务状态枚举
 * 用于跟踪积分消费关联的任务状态
 */
@Getter
@AllArgsConstructor
public enum TaskStatus {
    PENDING(0, "pending", "待处理"),
    PROCESSING(1, "processing", "处理中"),
    COMPLETED(2, "completed", "已完成"),
    FAILED(3, "failed", "失败"),
    CANCELLED(4, "cancelled", "已取消");
    
    private final Integer code;
    private final String status;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static TaskStatus fromCode(Integer code) {
        for (TaskStatus status : values()) {
            if (status.getCode().equals(code)) {
                return status;
            }
        }
        throw new IllegalArgumentException("Invalid TaskStatus code: " + code);
    }
    
    /**
     * 根据status获取枚举
     */
    public static TaskStatus fromStatus(String status) {
        for (TaskStatus taskStatus : values()) {
            if (taskStatus.getStatus().equals(status)) {
                return taskStatus;
            }
        }
        throw new IllegalArgumentException("Invalid TaskStatus: " + status);
    }
    
    /**
     * 判断任务是否完成
     */
    public boolean isCompleted() {
        return this == COMPLETED;
    }
    
    /**
     * 判断任务是否失败
     */
    public boolean isFailed() {
        return this == FAILED || this == CANCELLED;
    }
    
    /**
     * 判断任务是否进行中
     */
    public boolean isInProgress() {
        return this == PENDING || this == PROCESSING;
    }
    
    /**
     * 判断是否需要退还积分
     */
    public boolean shouldRefundCredits() {
        return this == FAILED || this == CANCELLED;
    }
}
```

### 1.6 枚举工具类

#### 1.6.1 积分枚举工具类
```java
// utils/CreditEnumUtils.java
package com.beilv.utils;

import com.beilv.enums.*;

/**
 * 积分相关枚举转换工具类
 */
public class CreditEnumUtils {
    
    /**
     * 安全转换积分类型枚举
     */
    public static CreditType safeFromCreditTypeCode(Integer code) {
        try {
            return code != null ? CreditType.fromCode(code) : CreditType.FREE;
        } catch (IllegalArgumentException e) {
            return CreditType.FREE;
        }
    }
    
    /**
     * 安全转换积分变动类型枚举
     */
    public static CreditChangeType safeFromChangeTypeCode(Integer code) {
        try {
            return code != null ? CreditChangeType.fromCode(code) : CreditChangeType.GAINED;
        } catch (IllegalArgumentException e) {
            return CreditChangeType.GAINED;
        }
    }
    
    /**
     * 安全转换来源类型枚举
     */
    public static CreditSourceType safeFromSourceTypeCode(Integer code) {
        try {
            return code != null ? CreditSourceType.fromCode(code) : CreditSourceType.SYSTEM_REWARD;
        } catch (IllegalArgumentException e) {
            return CreditSourceType.SYSTEM_REWARD;
        }
    }
    
    /**
     * 安全转换商品类型枚举
     */
    public static ProductType safeFromProductTypeCode(Integer code) {
        try {
            return code != null ? ProductType.fromCode(code) : ProductType.NORMAL;
        } catch (IllegalArgumentException e) {
            return ProductType.NORMAL;
        }
    }
    
    /**
     * 安全转换业务类型枚举
     */
    public static BusinessType safeFromBusinessTypeCode(String code) {
        try {
            return code != null ? BusinessType.fromCode(code) : BusinessType.AI_GENERATION;
        } catch (IllegalArgumentException e) {
            return BusinessType.AI_GENERATION;
        }
    }
    
    /**
     * 根据业务类型获取默认积分消费
     */
    public static Integer getDefaultCreditCost(String businessCode) {
        BusinessType businessType = safeFromBusinessTypeCode(businessCode);
        return businessType.getDefaultCost();
    }
    
    /**
     * 判断是否为高消费业务
     */
    public static boolean isHighCostBusiness(String businessCode) {
        BusinessType businessType = safeFromBusinessTypeCode(businessCode);
        return businessType.getCostLevel() == BusinessType.CostLevel.HIGH;
    }
    
    /**
     * 格式化积分变动显示
     */
    public static String formatCreditChange(Integer changeType, Integer amount) {
        CreditChangeType type = safeFromChangeTypeCode(changeType);
        return type.getSymbol() + amount + "分";
    }
}
```

## 验收标准
- [x] 所有积分相关状态字段都有对应枚举类
- [x] 枚举类包含code、type、description等必要字段
- [x] 提供fromCode和fromType转换方法
- [x] 包含业务判断方法和工具方法
- [x] 提供安全转换工具类
- [x] 完整的异常处理机制
- [x] 业务逻辑方法完善（如isCompleted、shouldRefundCredits等）
- [x] 符合Java命名规范和代码风格

## 交付物
- [x] CreditType.java - 积分类型枚举
- [x] CreditChangeType.java - 积分变动类型枚举
- [x] CreditSourceType.java - 积分来源类型枚举
- [x] ProductType.java - 商品类型枚举
- [x] BusinessType.java - 业务类型枚举
- [x] StatisticsPeriod.java - 统计周期枚举
- [x] TaskStatus.java - 任务状态枚举
- [x] CreditEnumUtils.java - 积分枚举工具类

## 验证测试
1. 编译所有枚举类无错误
2. 测试fromCode和fromType方法
3. 验证异常处理机制
4. 测试业务判断方法
5. 检查工具类转换功能
6. 验证积分消费计算逻辑

## 风险控制
- **类型安全**: 所有枚举转换都有异常处理
- **业务逻辑**: 积分消费和退还逻辑清晰
- **数据一致性**: 枚举值与数据库约束保持一致
- **扩展性**: 便于新增业务类型和来源类型

## 下一步
完成后集成到 `03-1-2-积分核心服务实现`
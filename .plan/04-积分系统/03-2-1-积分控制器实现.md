# 03-2-1: 积分控制器实现

## 任务概述
**时间估算**: 45分钟  
**优先级**: 最高  
**依赖关系**: 需要完成积分核心服务实现(03-1-2)  
**技术栈**: Java/Spring Boot, Spring MVC, REST API  
**复杂度**: 中等

## 详细任务清单

### 1. DTO类定义
- [ ] 创建CreditsBalanceVO响应类
- [ ] 创建ConsumeCreditsRequest请求类
- [ ] 创建PurchaseCreditsRequest请求类  
- [ ] 创建CreditsHistoryVO响应类
- [ ] 创建CreditProductVO响应类

### 2. 积分控制器主要接口
- [ ] 实现GET /api/credits/balance (获取积分余额)
- [ ] 实现GET /api/credits/history (获取积分历史)
- [ ] 实现GET /api/credits/products (获取积分商品)
- [ ] 实现POST /api/credits/purchase (购买积分)
- [ ] 实现POST /api/credits/consume (消费积分)
- [ ] 实现POST /api/credits/check-balance (检查余额)

### 3. 请求参数验证
- [ ] 添加JSR303验证注解
- [ ] 实现自定义参数验证逻辑
- [ ] 添加业务规则验证
- [ ] 处理参数校验异常

### 4. 响应处理和异常处理
- [ ] 统一响应格式(CommonResult)
- [ ] 实现业务异常处理
- [ ] 添加详细的错误日志
- [ ] 实现友好的错误提示

### 5. 安全控制
- [ ] JWT令牌解析和用户身份验证
- [ ] 用户权限检查
- [ ] 防止越权访问
- [ ] API接口文档注解

## 验收标准

### 功能验收
- [ ] 所有API接口能正常响应
- [ ] 积分余额查询准确
- [ ] 积分消费功能正确
- [ ] 积分购买流程完整
- [ ] 历史记录查询正常

### 质量验收
- [ ] 参数验证完善
- [ ] 异常处理友好
- [ ] 日志记录完整
- [ ] API文档清晰
- [ ] 代码符合RESTful规范

### 安全验收
- [ ] JWT身份验证生效
- [ ] 用户权限控制正确
- [ ] 敏感信息不泄露
- [ ] 防止恶意请求

## 交付物
- [ ] CreditsController.java控制器文件
- [ ] 相关DTO类文件
- [ ] API接口文档
- [ ] 单元测试用例
- [ ] 集成测试用例

## 技术要点

### RESTful API设计
- 使用标准HTTP状态码
- 统一的响应格式
- 合理的URL路径设计
- 支持分页和筛选

### 参数验证策略
- 使用@Valid注解进行基础验证
- 自定义验证逻辑处理业务规则
- 提供清晰的错误提示信息

### 安全控制机制
- JWT令牌验证用户身份
- 从令牌中解析用户信息
- 确保用户只能操作自己的积分

### 错误处理方案
- 区分业务异常和系统异常
- 提供用户友好的错误信息
- 记录详细的错误日志用于排查

## 下一步
完成后进入 `03-2-2-积分统计接口` 任务

## 注意事项
1. 确保所有敏感操作都需要身份验证
2. 注意防止SQL注入和XSS攻击
3. 合理设置API接口的超时时间
4. 考虑API接口的幂等性设计
5. 提供清晰的API文档和示例
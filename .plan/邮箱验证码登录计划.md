# 邮箱验证码登录功能开发计划

## 项目现状分析

### ✅ 已完成的部分
- **后端API**：完整的邮箱验证码登录系统已实现
  - `POST /api/auth/send-code` - 发送验证码
  - `POST /api/auth/login-with-code` - 验证码登录
- **前端UI**：LoginPage.tsx 已包含完整的验证码登录界面
- **状态管理**：Redux + RTK Query 架构已搭建

### ⚠️ 需要完善的部分
- **前端API对接**：将UI界面连接到真实的后端API
- **错误处理**：完善用户体验和错误提示

## 开发计划

### 第一阶段：API服务层改造

#### 1. 创建认证API服务
**文件**：`src/services/authApi.ts`
**功能**：
- 封装RTK Query API调用
- 发送验证码接口：`sendVerificationCode`
- 验证码登录接口：`loginWithCode`
- 统一错误处理

#### 2. 更新Redux状态管理
**文件**：`src/store/slices/authSlice.ts`  
**功能**：
- 添加验证码相关状态
- 修改`loginUser` thunk支持验证码登录
- 添加发送验证码action

### 第二阶段：前端UI对接

#### 3. 完善LoginPage.tsx
**文件**：`src/pages/auth/LoginPage.tsx`
**改动**：
- 替换第78行TODO，实现真实的发送验证码逻辑
- 修改表单提交逻辑，支持验证码登录
- 完善错误处理和用户反馈

#### 4. 配置API基础地址
**文件**：`src/services/baseApi.ts`
**改动**：
- 配置后端API基础URL
- 确保请求头和认证token正确传递

### 第三阶段：测试和优化

#### 5. 功能测试
- 验证码发送功能测试
- 验证码登录流程测试
- 错误场景处理测试（验证码错误、过期等）

#### 6. 用户体验优化
- 验证码倒计时优化
- 加载状态显示
- 错误提示优化

## 技术实现要点

### API接口调用
```typescript
// 发送验证码
POST /api/auth/send-code
Body: { email: string, codeType: 2 } // 2表示登录类型

// 验证码登录  
POST /api/auth/login-with-code
Body: { email: string, code: string }
```

### 前端状态流转
```
用户输入邮箱 -> 点击发送验证码 -> 调用sendVerificationCode API -> 
显示倒计时 -> 用户输入验证码 -> 点击登录 -> 调用loginWithCode API -> 
登录成功/失败处理
```

## 预估工作量

| 任务 | 预估时间 | 优先级 |
|------|----------|--------|
| 创建authApi.ts | 1小时 | 高 |
| 更新authSlice.ts | 30分钟 | 高 |
| 完善LoginPage.tsx | 1小时 | 高 |
| 配置baseApi.ts | 15分钟 | 中 |
| 功能测试 | 30分钟 | 高 |
| UI优化 | 30分钟 | 低 |

**总计**：约3-4小时

## 风险评估

### 低风险
- 后端API已完全实现，前端主要是对接工作
- UI界面已完成，只需要绑定真实数据

### 需要注意
- API地址配置正确性
- 跨域问题处理
- 验证码有效期处理

## 成功标准

1. ✅ 用户能够通过邮箱接收验证码
2. ✅ 用户能够使用验证码成功登录
3. ✅ 错误场景有合适的提示信息
4. ✅ 登录状态正确保存到Redux store
5. ✅ 页面跳转和用户体验流畅

## 实现步骤总结

1. **创建authApi.ts** - 封装后端API调用
2. **更新authSlice.ts** - 支持验证码登录状态管理  
3. **完善LoginPage.tsx** - 对接真实API，完善交互逻辑
4. **配置baseApi.ts** - 确保API基础配置正确
5. **功能测试** - 验证完整登录流程
6. **UI优化** - 提升用户体验

## 关键文件清单

- `mall/beilv-agent-web/src/services/authApi.ts` (新建)
- `mall/beilv-agent-web/src/store/slices/authSlice.ts` (修改)  
- `mall/beilv-agent-web/src/pages/auth/LoginPage.tsx` (修改)
- `mall/beilv-agent-web/src/services/baseApi.ts` (修改)

---

**备注**：由于后端API已完全实现，本次开发重点在前端对接，预计可以快速完成功能交付。
# 05-1-1: 支付系统枚举类定义

## 任务概述
**时间**: 第1天上午 (2小时)  
**目标**: 定义支付系统相关的所有枚举类  
**优先级**: 最高  
**依赖**: 支付系统数据库表结构设计完成

## 详细任务清单

### 1.1 订单相关枚举

#### 1.1.1 订单类型枚举
```java
// enums/OrderType.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 订单类型枚举
 * 对应数据库字段: oms_order.order_type
 */
@Getter
@AllArgsConstructor
public enum OrderType {
    PRODUCT(0, "product", "普通商品订单"),
    SUBSCRIPTION(1, "subscription", "套餐订单"),
    CREDITS(2, "credits", "积分充值订单");
    
    private final Integer code;
    private final String type;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static OrderType fromCode(Integer code) {
        for (OrderType type : values()) {
            if (type.getCode().equals(code)) {
                return type;
            }
        }
        throw new IllegalArgumentException("Invalid OrderType code: " + code);
    }
    
    /**
     * 根据type获取枚举
     */
    public static OrderType fromType(String type) {
        for (OrderType orderType : values()) {
            if (orderType.getType().equals(type)) {
                return orderType;
            }
        }
        throw new IllegalArgumentException("Invalid OrderType: " + type);
    }
    
    /**
     * 判断是否为套餐订单
     */
    public boolean isSubscription() {
        return this == SUBSCRIPTION;
    }
    
    /**
     * 判断是否为积分订单
     */
    public boolean isCredits() {
        return this == CREDITS;
    }
    
    /**
     * 判断是否为普通商品订单
     */
    public boolean isProduct() {
        return this == PRODUCT;
    }
    
    /**
     * 获取支付场景
     */
    public String getPaymentScene() {
        switch (this) {
            case SUBSCRIPTION:
                return "subscription";
            case CREDITS:
                return "credits";
            default:
                return "purchase";
        }
    }
}
```

#### 1.1.2 订单状态枚举
```java
// enums/OrderStatus.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 订单状态枚举
 * 对应数据库字段: oms_order.status
 */
@Getter
@AllArgsConstructor
public enum OrderStatus {
    PENDING_PAYMENT(0, "pending", "待支付"),
    PAID(1, "paid", "已支付"),
    FAILED(2, "failed", "支付失败"),
    CANCELLED(3, "cancelled", "已取消"),
    REFUNDED(4, "refunded", "已退款"),
    PROCESSING(5, "processing", "处理中"),
    COMPLETED(6, "completed", "已完成");
    
    private final Integer code;
    private final String status;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static OrderStatus fromCode(Integer code) {
        for (OrderStatus status : values()) {
            if (status.getCode().equals(code)) {
                return status;
            }
        }
        throw new IllegalArgumentException("Invalid OrderStatus code: " + code);
    }
    
    /**
     * 根据status获取枚举
     */
    public static OrderStatus fromStatus(String status) {
        for (OrderStatus orderStatus : values()) {
            if (orderStatus.getStatus().equals(status)) {
                return orderStatus;
            }
        }
        throw new IllegalArgumentException("Invalid OrderStatus: " + status);
    }
    
    /**
     * 判断是否已支付
     */
    public boolean isPaid() {
        return this == PAID || this == PROCESSING || this == COMPLETED;
    }
    
    /**
     * 判断是否可以支付
     */
    public boolean canPay() {
        return this == PENDING_PAYMENT;
    }
    
    /**
     * 判断是否可以取消
     */
    public boolean canCancel() {
        return this == PENDING_PAYMENT || this == FAILED;
    }
    
    /**
     * 判断是否可以退款
     */
    public boolean canRefund() {
        return this == PAID || this == PROCESSING || this == COMPLETED;
    }
    
    /**
     * 判断是否为最终状态
     */
    public boolean isFinalStatus() {
        return this == COMPLETED || this == CANCELLED || this == REFUNDED;
    }
}
```

### 1.2 支付相关枚举

#### 1.2.1 支付方式枚举
```java
// enums/PaymentMethod.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 支付方式枚举
 * 对应数据库字段: oms_order_payment.payment_method
 */
@Getter
@AllArgsConstructor
public enum PaymentMethod {
    ALIPAY("alipay", "支付宝", "支付宝在线支付", true, 0),
    WECHAT_PAY("wechat", "微信支付", "微信在线支付", true, 0),
    BANK_CARD("bank", "银行卡", "银行卡支付", false, 0),
    PAYPAL("paypal", "PayPal", "PayPal国际支付", false, 3.5),
    STRIPE("stripe", "Stripe", "Stripe信用卡支付", false, 2.9);
    
    private final String code;
    private final String name;
    private final String description;
    private final Boolean enabled;
    private final Double feeRate; // 手续费率(%)
    
    /**
     * 根据code获取枚举
     */
    public static PaymentMethod fromCode(String code) {
        for (PaymentMethod method : values()) {
            if (method.getCode().equals(code)) {
                return method;
            }
        }
        throw new IllegalArgumentException("Invalid PaymentMethod code: " + code);
    }
    
    /**
     * 判断是否启用
     */
    public boolean isEnabled() {
        return this.enabled;
    }
    
    /**
     * 判断是否有手续费
     */
    public boolean hasFee() {
        return this.feeRate > 0;
    }
    
    /**
     * 计算手续费
     */
    public java.math.BigDecimal calculateFee(java.math.BigDecimal amount) {
        if (!hasFee()) {
            return java.math.BigDecimal.ZERO;
        }
        return amount.multiply(java.math.BigDecimal.valueOf(feeRate / 100))
                    .setScale(2, java.math.RoundingMode.HALF_UP);
    }
    
    /**
     * 判断是否为国内支付方式
     */
    public boolean isDomestic() {
        return this == ALIPAY || this == WECHAT_PAY || this == BANK_CARD;
    }
    
    /**
     * 判断是否为国际支付方式
     */
    public boolean isInternational() {
        return this == PAYPAL || this == STRIPE;
    }
}
```

#### 1.2.2 支付状态枚举
```java
// enums/PaymentStatus.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 支付状态枚举
 * 对应数据库字段: oms_order_payment.status
 */
@Getter
@AllArgsConstructor
public enum PaymentStatus {
    PENDING(0, "pending", "待支付"),
    SUCCESS(1, "success", "支付成功"),
    FAILED(2, "failed", "支付失败"),
    CANCELLED(3, "cancelled", "已取消"),
    REFUNDING(4, "refunding", "退款中"),
    REFUNDED(5, "refunded", "已退款"),
    PARTIAL_REFUNDED(6, "partial_refunded", "部分退款");
    
    private final Integer code;
    private final String status;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static PaymentStatus fromCode(Integer code) {
        for (PaymentStatus status : values()) {
            if (status.getCode().equals(code)) {
                return status;
            }
        }
        throw new IllegalArgumentException("Invalid PaymentStatus code: " + code);
    }
    
    /**
     * 根据status获取枚举
     */
    public static PaymentStatus fromStatus(String status) {
        for (PaymentStatus paymentStatus : values()) {
            if (paymentStatus.getStatus().equals(status)) {
                return paymentStatus;
            }
        }
        throw new IllegalArgumentException("Invalid PaymentStatus: " + status);
    }
    
    /**
     * 判断是否支付成功
     */
    public boolean isSuccess() {
        return this == SUCCESS;
    }
    
    /**
     * 判断是否支付失败
     */
    public boolean isFailed() {
        return this == FAILED || this == CANCELLED;
    }
    
    /**
     * 判断是否可以退款
     */
    public boolean canRefund() {
        return this == SUCCESS;
    }
    
    /**
     * 判断是否为退款状态
     */
    public boolean isRefundStatus() {
        return this == REFUNDING || this == REFUNDED || this == PARTIAL_REFUNDED;
    }
    
    /**
     * 判断是否为最终状态
     */
    public boolean isFinalStatus() {
        return this != PENDING;
    }
}
```

#### 1.2.3 支付场景枚举
```java
// enums/PaymentScene.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 支付场景枚举
 * 对应数据库字段: oms_order_payment.payment_scene
 */
@Getter
@AllArgsConstructor
public enum PaymentScene {
    SUBSCRIPTION("subscription", "套餐订阅", "白鹿AI套餐订阅服务"),
    RENEWAL("renewal", "套餐续费", "白鹿AI套餐续费服务"),
    CREDITS("credits", "积分充值", "白鹿AI积分充值服务"),
    PURCHASE("purchase", "商品购买", "白鹿AI商品购买"),
    UPGRADE("upgrade", "套餐升级", "白鹿AI套餐升级服务"),
    REFILL("refill", "积分补充", "白鹿AI积分补充服务");
    
    private final String scene;
    private final String name;
    private final String description;
    
    /**
     * 根据scene获取枚举
     */
    public static PaymentScene fromScene(String scene) {
        for (PaymentScene paymentScene : values()) {
            if (paymentScene.getScene().equals(scene)) {
                return paymentScene;
            }
        }
        throw new IllegalArgumentException("Invalid PaymentScene: " + scene);
    }
    
    /**
     * 判断是否为套餐相关支付
     */
    public boolean isSubscriptionRelated() {
        return this == SUBSCRIPTION || this == RENEWAL || this == UPGRADE;
    }
    
    /**
     * 判断是否为积分相关支付
     */
    public boolean isCreditsRelated() {
        return this == CREDITS || this == REFILL;
    }
    
    /**
     * 获取支付宝商品代码
     */
    public String getAlipayProductCode() {
        return "FAST_INSTANT_TRADE_PAY";
    }
    
    /**
     * 获取微信支付商品代码
     */
    public String getWechatTradeType() {
        return "NATIVE"; // 二维码支付
    }
}
```

### 1.3 回调相关枚举

#### 1.3.1 回调处理状态枚举
```java
// enums/CallbackStatus.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 回调处理状态枚举
 * 对应数据库字段: oms_order_payment.callback_status
 */
@Getter
@AllArgsConstructor
public enum CallbackStatus {
    UNPROCESSED(0, "unprocessed", "未处理"),
    SUCCESS(1, "success", "处理成功"),
    FAILED(2, "failed", "处理失败"),
    RETRY(3, "retry", "重试中");
    
    private final Integer code;
    private final String status;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static CallbackStatus fromCode(Integer code) {
        for (CallbackStatus status : values()) {
            if (status.getCode().equals(code)) {
                return status;
            }
        }
        throw new IllegalArgumentException("Invalid CallbackStatus code: " + code);
    }
    
    /**
     * 根据status获取枚举
     */
    public static CallbackStatus fromStatus(String status) {
        for (CallbackStatus callbackStatus : values()) {
            if (callbackStatus.getStatus().equals(status)) {
                return callbackStatus;
            }
        }
        throw new IllegalArgumentException("Invalid CallbackStatus: " + status);
    }
    
    /**
     * 判断是否处理成功
     */
    public boolean isSuccess() {
        return this == SUCCESS;
    }
    
    /**
     * 判断是否需要重试
     */
    public boolean needsRetry() {
        return this == FAILED || this == RETRY;
    }
    
    /**
     * 判断是否为最终状态
     */
    public boolean isFinalStatus() {
        return this == SUCCESS;
    }
}
```

### 1.4 退款相关枚举

#### 1.4.1 退款状态枚举
```java
// enums/RefundStatus.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 退款状态枚举
 */
@Getter
@AllArgsConstructor
public enum RefundStatus {
    PENDING(0, "pending", "退款中"),
    SUCCESS(1, "success", "退款成功"),
    FAILED(2, "failed", "退款失败"),
    CANCELLED(3, "cancelled", "退款取消");
    
    private final Integer code;
    private final String status;
    private final String description;
    
    /**
     * 根据code获取枚举
     */
    public static RefundStatus fromCode(Integer code) {
        for (RefundStatus status : values()) {
            if (status.getCode().equals(code)) {
                return status;
            }
        }
        throw new IllegalArgumentException("Invalid RefundStatus code: " + code);
    }
    
    /**
     * 根据status获取枚举
     */
    public static RefundStatus fromStatus(String status) {
        for (RefundStatus refundStatus : values()) {
            if (refundStatus.getStatus().equals(status)) {
                return refundStatus;
            }
        }
        throw new IllegalArgumentException("Invalid RefundStatus: " + status);
    }
    
    /**
     * 判断是否退款成功
     */
    public boolean isSuccess() {
        return this == SUCCESS;
    }
    
    /**
     * 判断是否退款失败
     */
    public boolean isFailed() {
        return this == FAILED;
    }
    
    /**
     * 判断是否为最终状态
     */
    public boolean isFinalStatus() {
        return this != PENDING;
    }
}
```

#### 1.4.2 退款类型枚举
```java
// enums/RefundType.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 退款类型枚举
 */
@Getter
@AllArgsConstructor
public enum RefundType {
    FULL("full", "全额退款"),
    PARTIAL("partial", "部分退款"),
    AUTO("auto", "自动退款"),
    MANUAL("manual", "手动退款");
    
    private final String type;
    private final String description;
    
    /**
     * 根据type获取枚举
     */
    public static RefundType fromType(String type) {
        for (RefundType refundType : values()) {
            if (refundType.getType().equals(type)) {
                return refundType;
            }
        }
        throw new IllegalArgumentException("Invalid RefundType: " + type);
    }
    
    /**
     * 判断是否为全额退款
     */
    public boolean isFull() {
        return this == FULL;
    }
    
    /**
     * 判断是否为自动退款
     */
    public boolean isAuto() {
        return this == AUTO;
    }
}
```

### 1.5 通知相关枚举

#### 1.5.1 通知类型枚举
```java
// enums/NotificationType.java
package com.beilv.enums;

import lombok.AllArgsConstructor;
import lombok.Getter;

/**
 * 通知类型枚举
 * 用于支付结果通知
 */
@Getter
@AllArgsConstructor
public enum NotificationType {
    PAYMENT_SUCCESS("payment_success", "支付成功", "您的支付已成功完成"),
    PAYMENT_FAILED("payment_failed", "支付失败", "您的支付未能完成"),
    REFUND_SUCCESS("refund_success", "退款成功", "您的退款已成功处理"),
    REFUND_FAILED("refund_failed", "退款失败", "您的退款处理失败"),
    SUBSCRIPTION_ACTIVATED("subscription_activated", "套餐激活", "您的套餐已成功激活"),
    SUBSCRIPTION_EXPIRED("subscription_expired", "套餐过期", "您的套餐即将或已过期"),
    CREDITS_RECHARGED("credits_recharged", "积分充值", "您的积分已成功充值");
    
    private final String type;
    private final String title;
    private final String defaultMessage;
    
    /**
     * 根据type获取枚举
     */
    public static NotificationType fromType(String type) {
        for (NotificationType notificationType : values()) {
            if (notificationType.getType().equals(type)) {
                return notificationType;
            }
        }
        throw new IllegalArgumentException("Invalid NotificationType: " + type);
    }
    
    /**
     * 判断是否为成功类型通知
     */
    public boolean isSuccess() {
        return this == PAYMENT_SUCCESS || this == REFUND_SUCCESS || 
               this == SUBSCRIPTION_ACTIVATED || this == CREDITS_RECHARGED;
    }
    
    /**
     * 判断是否为失败类型通知
     */
    public boolean isFailed() {
        return this == PAYMENT_FAILED || this == REFUND_FAILED;
    }
    
    /**
     * 判断是否为警告类型通知
     */
    public boolean isWarning() {
        return this == SUBSCRIPTION_EXPIRED;
    }
}
```

### 1.6 枚举工具类

#### 1.6.1 支付枚举工具类
```java
// utils/PaymentEnumUtils.java
package com.beilv.utils;

import com.beilv.enums.*;
import java.math.BigDecimal;

/**
 * 支付相关枚举转换工具类
 */
public class PaymentEnumUtils {
    
    /**
     * 安全转换订单类型枚举
     */
    public static OrderType safeFromOrderTypeCode(Integer code) {
        try {
            return code != null ? OrderType.fromCode(code) : OrderType.PRODUCT;
        } catch (IllegalArgumentException e) {
            return OrderType.PRODUCT;
        }
    }
    
    /**
     * 安全转换订单状态枚举
     */
    public static OrderStatus safeFromOrderStatusCode(Integer code) {
        try {
            return code != null ? OrderStatus.fromCode(code) : OrderStatus.PENDING_PAYMENT;
        } catch (IllegalArgumentException e) {
            return OrderStatus.PENDING_PAYMENT;
        }
    }
    
    /**
     * 安全转换支付方式枚举
     */
    public static PaymentMethod safeFromPaymentMethodCode(String code) {
        try {
            return code != null ? PaymentMethod.fromCode(code) : PaymentMethod.ALIPAY;
        } catch (IllegalArgumentException e) {
            return PaymentMethod.ALIPAY;
        }
    }
    
    /**
     * 安全转换支付状态枚举
     */
    public static PaymentStatus safeFromPaymentStatusCode(Integer code) {
        try {
            return code != null ? PaymentStatus.fromCode(code) : PaymentStatus.PENDING;
        } catch (IllegalArgumentException e) {
            return PaymentStatus.PENDING;
        }
    }
    
    /**
     * 根据订单类型获取支付场景
     */
    public static PaymentScene getPaymentSceneByOrderType(OrderType orderType, String businessType) {
        switch (orderType) {
            case SUBSCRIPTION:
                if ("renewal".equals(businessType)) {
                    return PaymentScene.RENEWAL;
                } else if ("upgrade".equals(businessType)) {
                    return PaymentScene.UPGRADE;
                } else {
                    return PaymentScene.SUBSCRIPTION;
                }
            case CREDITS:
                return PaymentScene.CREDITS;
            default:
                return PaymentScene.PURCHASE;
        }
    }
    
    /**
     * 计算支付手续费
     */
    public static BigDecimal calculatePaymentFee(PaymentMethod method, BigDecimal amount) {
        return method.calculateFee(amount);
    }
    
    /**
     * 获取可用的支付方式
     */
    public static PaymentMethod[] getAvailablePaymentMethods() {
        return java.util.Arrays.stream(PaymentMethod.values())
                .filter(PaymentMethod::isEnabled)
                .toArray(PaymentMethod[]::new);
    }
    
    /**
     * 判断订单是否可以执行指定操作
     */
    public static boolean canPerformOrderAction(OrderStatus currentStatus, String action) {
        switch (action) {
            case "pay":
                return currentStatus.canPay();
            case "cancel":
                return currentStatus.canCancel();
            case "refund":
                return currentStatus.canRefund();
            default:
                return false;
        }
    }
    
    /**
     * 判断支付是否需要回调重试
     */
    public static boolean shouldRetryCallback(CallbackStatus status, int retryCount) {
        return status.needsRetry() && retryCount < 3;
    }
    
    /**
     * 获取支付状态显示文本
     */
    public static String getPaymentStatusText(PaymentStatus status, String language) {
        if ("en".equals(language)) {
            switch (status) {
                case PENDING: return "Pending Payment";
                case SUCCESS: return "Payment Successful";
                case FAILED: return "Payment Failed";
                case CANCELLED: return "Payment Cancelled";
                case REFUNDED: return "Refunded";
                default: return status.getDescription();
            }
        }
        return status.getDescription();
    }
    
    /**
     * 格式化支付金额显示
     */
    public static String formatPaymentAmount(BigDecimal amount, String currency) {
        if ("USD".equals(currency)) {
            return "$" + amount.toString();
        } else if ("EUR".equals(currency)) {
            return "€" + amount.toString();
        } else {
            return "¥" + amount.toString();
        }
    }
    
    /**
     * 获取通知消息内容
     */
    public static String getNotificationMessage(NotificationType type, Object... params) {
        String template = type.getDefaultMessage();
        
        switch (type) {
            case PAYMENT_SUCCESS:
                if (params.length > 0) {
                    template += "，订单号：" + params[0];
                }
                break;
            case CREDITS_RECHARGED:
                if (params.length > 0) {
                    template += "，充值金额：" + params[0] + "分";
                }
                break;
            case SUBSCRIPTION_ACTIVATED:
                if (params.length > 0) {
                    template += "，套餐：" + params[0];
                }
                break;
        }
        
        return template;
    }
}
```

## 验收标准
- [x] 所有支付相关状态字段都有对应枚举类
- [x] 枚举类包含完整的支付业务属性
- [x] 提供支付手续费计算功能
- [x] 支持多种支付方式和场景
- [x] 回调处理和重试机制枚举
- [x] 退款状态和类型管理
- [x] 通知类型和消息格式化
- [x] 完整的工具类和业务方法
- [x] 符合Java命名规范和代码风格

## 交付物
- [x] OrderType.java - 订单类型枚举
- [x] OrderStatus.java - 订单状态枚举
- [x] PaymentMethod.java - 支付方式枚举
- [x] PaymentStatus.java - 支付状态枚举
- [x] PaymentScene.java - 支付场景枚举
- [x] CallbackStatus.java - 回调处理状态枚举
- [x] RefundStatus.java - 退款状态枚举
- [x] RefundType.java - 退款类型枚举
- [x] NotificationType.java - 通知类型枚举
- [x] PaymentEnumUtils.java - 支付枚举工具类

## 验证测试
1. 编译所有枚举类无错误
2. 测试支付手续费计算功能
3. 验证支付状态转换逻辑
4. 测试回调重试机制
5. 检查退款流程枚举
6. 验证通知消息格式化

## 风险控制
- **支付安全**: 支付状态转换逻辑严格
- **金额计算**: 手续费和金额计算准确
- **回调处理**: 回调重试和失败处理机制完善
- **国际化**: 支持多语言和多货币

## 下一步
完成后集成到 `05-1-2-支付服务核心实现`
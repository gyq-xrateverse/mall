# 04-1-2: 数据库扩展设计

## 任务概述
**时间估算**: 30-45分钟  
**优先级**: 最高  
**依赖关系**: 03-积分系统完成

## 详细任务清单

### 核心任务
1. **扩展pms_product表支持套餐商品**
   - 添加product_type字段区分商品类型
   - 添加套餐特有字段：subscription_period、daily_credits等
   - 添加features JSON字段存储套餐特性配置

2. **扩展oms_order表支持套餐订阅**
   - 添加订阅相关字段：subscription_start_date、subscription_end_date
   - 添加订阅状态：subscription_status
   - 添加自动续费标识：auto_renew

3. **扩展ums_member表记录当前套餐**
   - 添加current_subscription_id关联当前套餐
   - 添加subscription_level套餐等级
   - 添加每日积分限额和使用量字段

4. **创建ums_subscription_usage统计表**
   - 记录用户每日套餐使用情况
   - 支持积分使用量和任务创建数统计
   - 建立合理的索引优化查询性能

### 技术要点
- 使用ALTER TABLE语句扩展现有表结构
- JSON字段存储灵活的特性配置
- 建立合理的索引提升查询性能
- 确保数据一致性和完整性约束

## 验收标准
- [ ] 所有表结构扩展SQL脚本编写完成
- [ ] 字段类型和约束设置正确
- [ ] 索引优化合理，查询性能满足要求
- [ ] 支持5级套餐层级管理
- [ ] 数据库脚本在测试环境执行成功

## 交付物
- [ ] 数据库扩展脚本文件
- [ ] 表结构设计文档
- [ ] 索引优化方案
- [ ] 数据迁移验证报告

## 技术要点
- **兼容性考虑**: 确保扩展不影响现有功能
- **性能优化**: 合理设计索引，避免全表扫描
- **数据完整性**: 设置适当的外键约束和检查约束
- **JSON使用**: 合理使用JSON字段存储灵活配置

## 下一步
完成后进入 `04-1-3-套餐配置数据`
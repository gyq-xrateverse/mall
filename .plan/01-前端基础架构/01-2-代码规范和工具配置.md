# 01-2: 代码规范和工具配置

## 任务概述
**时间**: 第2天  
**目标**: 配置ESLint、Prettier、Husky等开发工具，建立代码规范  
**优先级**: 最高  
**依赖**: 01-1 项目初始化完成

## 详细任务清单

### 2.1 ESLint配置
**安装ESLint相关依赖**:
```bash
npm install --save-dev eslint @eslint/js @types/eslint__js typescript-eslint eslint-plugin-react eslint-plugin-react-hooks eslint-plugin-react-refresh
```

**创建 `.eslintrc.cjs`**:
```javascript
module.exports = {
  root: true,
  env: { browser: true, es2020: true },
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
  ],
  ignorePatterns: ['dist', '.eslintrc.cjs'],
  parser: '@typescript-eslint/parser',
  plugins: ['react-refresh'],
  rules: {
    'react-refresh/only-export-components': [
      'warn',
      { allowConstantExport: true },
    ],
    '@typescript-eslint/no-unused-vars': 'error',
    'react-hooks/rules-of-hooks': 'error',
    'react-hooks/exhaustive-deps': 'warn',
    'no-console': 'warn',
    'no-debugger': 'error',
  },
}
```

**验收标准**:
- [x] ESLint能正确检查TypeScript和React代码
- [x] 编辑器实时显示ESLint错误
- [x] 命令行 `npm run lint` 正常工作

### 2.2 Prettier配置
**安装Prettier**:
```bash
npm install --save-dev prettier eslint-config-prettier eslint-plugin-prettier
```

**创建 `.prettierrc`**:
```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "endOfLine": "lf"
}
```

**创建 `.prettierignore`**:
```
dist/
node_modules/
*.md
*.json
```

**更新ESLint配置集成Prettier**:
```javascript
// 在extends数组末尾添加
'plugin:prettier/recommended'
```

**验收标准**:
- [x] Prettier自动格式化代码
- [x] ESLint和Prettier规则不冲突
- [x] 编辑器保存时自动格式化

### 2.3 Husky和lint-staged配置
**安装依赖**:
```bash
npm install --save-dev husky lint-staged
npx husky install
```

**配置package.json scripts**:
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint . --ext ts,tsx --fix",
    "format": "prettier --write .",
    "preview": "vite preview",
    "prepare": "husky install"
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{js,jsx,json,css,scss,md}": [
      "prettier --write"
    ]
  }
}
```

**创建Git hooks**:
```bash
npx husky add .husky/pre-commit "npx lint-staged"
npx husky add .husky/commit-msg "npx commitlint --edit \$1"
```

**验收标准**:
- [x] Git提交前自动运行代码检查
- [x] 代码格式问题自动修复
- [x] 不符合规范的代码无法提交

### 2.4 Commitizen和Commitlint配置
**安装依赖**:
```bash
npm install --save-dev @commitlint/config-conventional @commitlint/cli commitizen cz-conventional-changelog
```

**创建 `commitlint.config.js`**:
```javascript
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',     // 新功能
        'fix',      // 修复bug
        'docs',     // 文档更新
        'style',    // 代码格式修改
        'refactor', // 重构
        'perf',     // 性能优化
        'test',     // 测试相关
        'chore',    // 构建过程或工具变动
        'revert',   // 撤销提交
      ],
    ],
  },
}
```

**更新package.json**:
```json
{
  "config": {
    "commitizen": {
      "path": "./node_modules/cz-conventional-changelog"
    }
  },
  "scripts": {
    "commit": "cz"
  }
}
```

**验收标准**:
- [x] 使用 `npm run commit` 进行规范化提交
- [x] 不规范的提交信息被拒绝
- [x] 提交信息格式统一

### 2.5 EditorConfig配置
**创建 `.editorconfig`**:
```
root = true

[*]
charset = utf-8
end_of_line = lf
indent_style = space
indent_size = 2
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
trim_trailing_whitespace = false
```

**验收标准**:
- [x] 不同编辑器使用统一的编码风格
- [x] 缩进、换行符等设置一致

## 项目结构规范
```
src/
├── api/           # API接口相关
├── assets/        # 静态资源
├── components/    # 通用组件
│   ├── ui/        # 基础UI组件
│   └── common/    # 业务通用组件
├── hooks/         # 自定义Hooks
├── pages/         # 页面组件
├── store/         # 状态管理
├── styles/        # 全局样式
├── types/         # TypeScript类型定义
├── utils/         # 工具函数
├── App.tsx
└── main.tsx
```

## 交付物
- [x] 完整的ESLint配置
- [x] Prettier代码格式化配置
- [x] Git hooks和提交规范
- [x] 统一的编辑器配置
- [x] 规范的项目目录结构

## 验证测试
1. 创建一个不符合规范的文件，运行lint检查
2. 尝试提交不规范的代码，验证是否被阻止
3. 使用 `npm run commit` 进行一次规范提交
4. 验证编辑器自动格式化功能

## 风险控制
- **工具版本兼容性**: 使用稳定版本的开发工具
- **团队协作**: 确保所有开发者使用相同的配置
- **性能影响**: 避免过于严格的规则影响开发效率

## 验收记录
**完成时间**: 2025-01-09 10:45  
**验收状态**: ✅ 全部通过  
**验收人**: Claude Code  

### 详细验收记录
1. **2.1 ESLint配置**: ✅ 通过 - ESLint安装配置完成，支持TypeScript和React检查，命令行工具正常
2. **2.2 Prettier配置**: ✅ 通过 - Prettier安装配置完成，与ESLint集成无冲突，自动格式化正常
3. **2.3 Husky和lint-staged配置**: ✅ 通过 - Git hooks配置完成，pre-commit检查正常，不规范代码提交被阻止
4. **2.4 Commitizen和Commitlint配置**: ✅ 通过 - 提交信息规范配置完成，commitlint.config.cjs格式修复，规范提交成功
5. **2.5 EditorConfig配置**: ✅ 通过 - 编辑器配置文件创建完成，统一编码风格设置

### 测试结果
- ✅ `npm run lint` - ESLint检查正常运行
- ✅ `npm run format` - Prettier格式化成功
- ✅ Git提交测试 - 不规范代码被成功阻止
- ✅ 规范提交测试 - 标准commit消息提交成功
- ✅ `npm run build` - 构建成功无错误

### 问题解决记录
- 🔧 修复commitlint.config.js → commitlint.config.cjs (ES模块兼容性问题)
- 🔧 安装@types/node解决TypeScript构建错误
- 🔧 配置Git仓库初始化

## 下一步
完成后进入 `01-3-路由系统搭建` ✅ **准备开始**
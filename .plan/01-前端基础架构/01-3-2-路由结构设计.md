# 01-3-2-路由结构设计

## 任务概述
- **时间估算**: 45分钟
- **优先级**: 高
- **依赖关系**: 
  - 依赖：01-3-1-安装React Router（Router基础配置）
  - 前置：路由库安装完成
- **执行阶段**: 第一阶段-前端基础架构

## 详细任务清单

### 3.2.1 分析系统页面结构
- [ ] 梳理系统功能模块
- [ ] 确定页面层级关系
- [ ] 定义路由权限级别
- [ ] 设计URL路径规范

### 3.2.2 创建路由配置架构
- [ ] 设计路由配置数据结构
- [ ] 创建嵌套路由配置
- [ ] 定义动态路由参数
- [ ] 设置路由元信息

### 3.2.3 实现路由配置文件
- [ ] 创建主路由配置
- [ ] 配置公共页面路由
- [ ] 设计认证相关路由
- [ ] 创建404错误页面路由

### 3.2.4 路由工具函数
- [ ] 创建路由导航辅助函数
- [ ] 实现路由参数解析工具
- [ ] 添加路由历史记录管理
- [ ] 创建路由匹配工具

## 验收标准

### 功能验收
- [ ] 路由结构层次清晰合理
- [ ] 支持嵌套路由和动态路由
- [ ] 路由配置支持权限控制
- [ ] 404页面正确配置

### 代码质量验收
- [ ] 路由配置符合RESTful规范
- [ ] TypeScript类型定义完整
- [ ] 代码结构清晰易维护
- [ ] 路由命名规范统一

### 技术验收
- [ ] 路由配置可正常解析
- [ ] 嵌套路由渲染正确
- [ ] 动态路由参数传递正常
- [ ] 路由工具函数运行无误

## 交付物

### 1. 路由配置文件
```
src/router/
├── routes/
│   ├── index.ts           # 主路由配置
│   ├── auth.ts            # 认证相关路由
│   ├── dashboard.ts       # 控制台路由
│   ├── system.ts          # 系统管理路由
│   └── common.ts          # 公共页面路由
├── utils/
│   ├── navigation.ts      # 路由导航工具
│   ├── params.ts          # 参数解析工具
│   └── history.ts         # 历史记录管理
└── config.ts              # 路由总配置
```

### 2. 类型定义文件
```
src/types/router.ts - 路由相关类型定义
```

### 3. 路由文档
```
docs/router-structure.md - 路由结构说明文档
```

## 技术要点

### 路由配置结构设计
```typescript
// src/router/types.ts
export interface RouteConfig {
  path: string;
  name?: string;
  component: LazyExoticComponent<ComponentType>;
  meta?: RouteMeta;
  children?: RouteConfig[];
  redirect?: string;
}

export interface RouteMeta {
  title: string;
  icon?: string;
  requireAuth: boolean;
  roles?: string[];
  hidden?: boolean;
  keepAlive?: boolean;
}
```

### 主路由配置示例
```typescript
// src/router/routes/index.ts
export const routes: RouteConfig[] = [
  {
    path: '/',
    name: 'Root',
    component: lazy(() => import('@/layouts/BasicLayout')),
    redirect: '/dashboard',
    children: [
      {
        path: '/dashboard',
        name: 'Dashboard',
        component: lazy(() => import('@/pages/Dashboard')),
        meta: {
          title: '控制台',
          icon: 'dashboard',
          requireAuth: true,
        },
      },
      // 更多路由配置...
    ],
  },
  {
    path: '/login',
    name: 'Login',
    component: lazy(() => import('@/pages/Auth/Login')),
    meta: {
      title: '登录',
      requireAuth: false,
    },
  },
  {
    path: '/404',
    name: 'NotFound',
    component: lazy(() => import('@/pages/Error/404')),
    meta: {
      title: '页面不存在',
      requireAuth: false,
    },
  },
  {
    path: '*',
    redirect: '/404',
  },
];
```

### 路由导航工具
```typescript
// src/router/utils/navigation.ts
import { useNavigate, useLocation } from 'react-router-dom';

export const useRouterNavigation = () => {
  const navigate = useNavigate();
  const location = useLocation();

  const goTo = (path: string, options?: { replace?: boolean; state?: any }) => {
    navigate(path, options);
  };

  const goBack = () => {
    navigate(-1);
  };

  const goForward = () => {
    navigate(1);
  };

  const getCurrentPath = () => location.pathname;

  return {
    goTo,
    goBack,
    goForward,
    getCurrentPath,
    location,
  };
};
```

### 路由参数工具
```typescript
// src/router/utils/params.ts
import { useParams, useSearchParams } from 'react-router-dom';

export const useRouterParams = () => {
  const params = useParams();
  const [searchParams, setSearchParams] = useSearchParams();

  const getParam = (key: string) => params[key];
  
  const getQuery = (key: string) => searchParams.get(key);
  
  const setQuery = (key: string, value: string) => {
    searchParams.set(key, value);
    setSearchParams(searchParams);
  };

  const removeQuery = (key: string) => {
    searchParams.delete(key);
    setSearchParams(searchParams);
  };

  return {
    params,
    getParam,
    getQuery,
    setQuery,
    removeQuery,
  };
};
```

## 下一步
- **后续任务**: 01-3-3-Layout布局组件
- **关联任务**: 基于路由结构创建对应的布局组件
- **注意事项**: 
  - 路由结构需要考虑未来的扩展性
  - 权限设计要为后续的路由守卫做好准备
  - URL设计要符合SEO和用户体验要求

## 常见问题解决

### Q1: 嵌套路由不生效
- 检查父路由是否包含<Outlet />组件
- 确认子路由路径是否正确配置
- 验证路由组件是否正确导入

### Q2: 动态路由参数获取失败
- 确认路由路径参数定义格式（:id）
- 检查useParams hook使用方式
- 验证路由跳转时参数传递正确

### Q3: 路由重定向不工作
- 检查redirect配置是否正确
- 确认目标路由是否存在
- 验证路由匹配优先级设置
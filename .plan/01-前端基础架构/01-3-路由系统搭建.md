# 01-3: è·¯ç”±ç³»ç»Ÿæ­å»º

## ä»»åŠ¡æ¦‚è¿°
**æ—¶é—´**: ç¬¬3å¤©  
**ç›®æ ‡**: ä½¿ç”¨React Router v6æ­å»ºå®Œæ•´çš„è·¯ç”±ç³»ç»Ÿ  
**ä¼˜å…ˆçº§**: æœ€é«˜  
**ä¾èµ–**: 01-2 ä»£ç è§„èŒƒé…ç½®å®Œæˆ

## è¯¦ç»†ä»»åŠ¡æ¸…å•

### 3.1 å®‰è£…React Router
```bash
npm install react-router-dom
npm install --save-dev @types/react-router-dom
```

### 3.2 è·¯ç”±ç»“æ„è®¾è®¡
**åˆ›å»ºè·¯ç”±é…ç½®æ–‡ä»¶ `src/router/index.tsx`**:
```typescript
import { createBrowserRouter, Navigate } from 'react-router-dom';
import { Suspense, lazy } from 'react';
import Layout from '@/components/layout/Layout';
import Loading from '@/components/ui/Loading';

// æ‡’åŠ è½½é¡µé¢ç»„ä»¶
const HomePage = lazy(() => import('@/pages/Home'));
const LoginPage = lazy(() => import('@/pages/auth/Login'));
const RegisterPage = lazy(() => import('@/pages/auth/Register'));
const AITaskPage = lazy(() => import('@/pages/ai/AITask'));
const CreditsPage = lazy(() => import('@/pages/credits/Credits'));
const CreditsPurchasePage = lazy(() => import('@/pages/credits/Purchase'));
const CreditsHistoryPage = lazy(() => import('@/pages/credits/History'));
const PlansPage = lazy(() => import('@/pages/plans/Plans'));
const ProjectsPage = lazy(() => import('@/pages/projects/Projects'));
const GalleryPage = lazy(() => import('@/pages/gallery/Gallery'));
const ProfilePage = lazy(() => import('@/pages/profile/Profile'));
const NotFoundPage = lazy(() => import('@/pages/NotFound'));

// ç»„ä»¶åŒ…è£…å™¨ï¼Œå¤„ç†æ‡’åŠ è½½
const LazyWrapper = ({ children }: { children: React.ReactNode }) => (
  <Suspense fallback={<Loading />}>{children}</Suspense>
);

export const router = createBrowserRouter([
  {
    path: '/',
    element: <Layout />,
    children: [
      {
        index: true,
        element: (
          <LazyWrapper>
            <HomePage />
          </LazyWrapper>
        ),
      },
      {
        path: 'ai-task',
        element: (
          <LazyWrapper>
            <AITaskPage />
          </LazyWrapper>
        ),
      },
      {
        path: 'gallery',
        element: (
          <LazyWrapper>
            <GalleryPage />
          </LazyWrapper>
        ),
      },
      {
        path: 'projects',
        element: (
          <LazyWrapper>
            <ProjectsPage />
          </LazyWrapper>
        ),
      },
      {
        path: 'credits',
        children: [
          {
            index: true,
            element: (
              <LazyWrapper>
                <CreditsPage />
              </LazyWrapper>
            ),
          },
          {
            path: 'purchase',
            element: (
              <LazyWrapper>
                <CreditsPurchasePage />
              </LazyWrapper>
            ),
          },
          {
            path: 'history',
            element: (
              <LazyWrapper>
                <CreditsHistoryPage />
              </LazyWrapper>
            ),
          },
        ],
      },
      {
        path: 'plans',
        element: (
          <LazyWrapper>
            <PlansPage />
          </LazyWrapper>
        ),
      },
      {
        path: 'profile',
        element: (
          <LazyWrapper>
            <ProfilePage />
          </LazyWrapper>
        ),
      },
    ],
  },
  {
    path: '/auth',
    children: [
      {
        path: 'login',
        element: (
          <LazyWrapper>
            <LoginPage />
          </LazyWrapper>
        ),
      },
      {
        path: 'register',
        element: (
          <LazyWrapper>
            <RegisterPage />
          </LazyWrapper>
        ),
      },
      {
        index: true,
        element: <Navigate to="/auth/login" replace />,
      },
    ],
  },
  {
    path: '*',
    element: (
      <LazyWrapper>
        <NotFoundPage />
      </LazyWrapper>
    ),
  },
]);
```

**éªŒæ”¶æ ‡å‡†**:
- [x] è·¯ç”±é…ç½®ç»“æ„æ¸…æ™°ï¼Œæ”¯æŒåµŒå¥—è·¯ç”±
- [x] é¡µé¢æ‡’åŠ è½½æ­£ç¡®å®ç°
- [x] è·¯ç”±é‡å®šå‘æ­£å¸¸å·¥ä½œ

### 3.3 Layoutå¸ƒå±€ç»„ä»¶
**åˆ›å»º `src/components/layout/Layout.tsx`**:
```typescript
import React from 'react';
import { Outlet } from 'react-router-dom';
import Header from './Header';
import Footer from './Footer';
import Sidebar from './Sidebar';

const Layout: React.FC = () => {
  return (
    <div className="min-h-screen bg-gray-50">
      <Header />
      <div className="flex">
        <Sidebar />
        <main className="flex-1 p-6">
          <Outlet />
        </main>
      </div>
      <Footer />
    </div>
  );
};

export default Layout;
```

**åˆ›å»ºHeaderç»„ä»¶ `src/components/layout/Header.tsx`**:
```typescript
import React from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAppSelector } from '@/hooks/redux';
import CreditsDisplay from '@/components/credits/CreditsDisplay';
import UserMenu from '@/components/user/UserMenu';

const Header: React.FC = () => {
  const navigate = useNavigate();
  const { user } = useAppSelector(state => state.auth);

  return (
    <header className="bg-white shadow-sm border-b">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          {/* Logo */}
          <div className="flex items-center">
            <Link to="/" className="flex items-center">
              <img src="/logo.svg" alt="BEILV AI" className="h-8 w-auto" />
              <span className="ml-2 text-xl font-bold text-gray-900">
                BEILV AI
              </span>
            </Link>
          </div>

          {/* Navigation */}
          <nav className="hidden md:flex items-center space-x-8">
            <Link
              to="/gallery"
              className="text-gray-600 hover:text-gray-900 transition-colors"
            >
              Gallery
            </Link>
            <Link
              to="/projects"
              className="text-gray-600 hover:text-gray-900 transition-colors"
            >
              My Projects
            </Link>
            <Link
              to="/plans"
              className="text-gray-600 hover:text-gray-900 transition-colors"
            >
              Plans
            </Link>
          </nav>

          {/* User Actions */}
          <div className="flex items-center space-x-4">
            {user ? (
              <>
                <CreditsDisplay />
                <UserMenu />
              </>
            ) : (
              <div className="flex items-center space-x-2">
                <button
                  onClick={() => navigate('/auth/login')}
                  className="px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors"
                >
                  Login
                </button>
                <button
                  onClick={() => navigate('/auth/register')}
                  className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                >
                  Sign Up
                </button>
              </div>
            )}
          </div>
        </div>
      </div>
    </header>
  );
};

export default Header;
```

**éªŒæ”¶æ ‡å‡†**:
- [x] Layoutç»„ä»¶æ­£ç¡®æ¸²æŸ“Headerã€Sidebarã€Contentã€Footer
- [x] Headerå¯¼èˆªé“¾æ¥æ­£ç¡®å·¥ä½œ
- [x] å“åº”å¼è®¾è®¡é€‚é…ç§»åŠ¨ç«¯

### 3.4 è·¯ç”±å®ˆå«å®ç°
**åˆ›å»ºè·¯ç”±å®ˆå«ç»„ä»¶ `src/components/router/ProtectedRoute.tsx`**:
```typescript
import React from 'react';
import { Navigate, useLocation } from 'react-router-dom';
import { useAppSelector } from '@/hooks/redux';

interface ProtectedRouteProps {
  children: React.ReactNode;
}

const ProtectedRoute: React.FC<ProtectedRouteProps> = ({ children }) => {
  const { isAuthenticated } = useAppSelector(state => state.auth);
  const location = useLocation();

  if (!isAuthenticated) {
    // ä¿å­˜ç”¨æˆ·å°è¯•è®¿é—®çš„è·¯å¾„
    return <Navigate to="/auth/login" state={{ from: location }} replace />;
  }

  return <>{children}</>;
};

export default ProtectedRoute;
```

**åˆ›å»ºç™»å½•é‡å®šå‘ç»„ä»¶ `src/components/router/AuthRedirect.tsx`**:
```typescript
import React from 'react';
import { Navigate } from 'react-router-dom';
import { useAppSelector } from '@/hooks/redux';

interface AuthRedirectProps {
  children: React.ReactNode;
}

const AuthRedirect: React.FC<AuthRedirectProps> = ({ children }) => {
  const { isAuthenticated } = useAppSelector(state => state.auth);

  if (isAuthenticated) {
    return <Navigate to="/" replace />;
  }

  return <>{children}</>;
};

export default AuthRedirect;
```

**æ›´æ–°è·¯ç”±é…ç½®ï¼Œæ·»åŠ è·¯ç”±å®ˆå«**:
```typescript
// åœ¨éœ€è¦ç™»å½•çš„è·¯ç”±å¤–åŒ…è£¹ProtectedRoute
{
  path: 'credits',
  element: <ProtectedRoute><Outlet /></ProtectedRoute>,
  children: [
    // ... creditså­è·¯ç”±
  ],
}

// åœ¨ç™»å½•é¡µé¢åŒ…è£¹AuthRedirect
{
  path: '/auth',
  element: <AuthRedirect><Outlet /></AuthRedirect>,
  children: [
    // ... authå­è·¯ç”±
  ],
}
```

**éªŒæ”¶æ ‡å‡†**:
- [x] æœªç™»å½•ç”¨æˆ·è®¿é—®å—ä¿æŠ¤è·¯ç”±æ—¶é‡å®šå‘åˆ°ç™»å½•é¡µ
- [x] å·²ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•é¡µæ—¶é‡å®šå‘åˆ°é¦–é¡µ
- [x] ç™»å½•åè‡ªåŠ¨è·³è½¬åˆ°ä¹‹å‰è®¿é—®çš„é¡µé¢

### 3.5 é¢åŒ…å±‘å¯¼èˆª
**åˆ›å»ºé¢åŒ…å±‘ç»„ä»¶ `src/components/navigation/Breadcrumb.tsx`**:
```typescript
import React from 'react';
import { Link, useLocation } from 'react-router-dom';

interface BreadcrumbItem {
  label: string;
  path?: string;
}

const Breadcrumb: React.FC = () => {
  const location = useLocation();
  
  const getBreadcrumbs = (pathname: string): BreadcrumbItem[] => {
    const pathMap: Record<string, string> = {
      '/': 'Home',
      '/gallery': 'Gallery',
      '/projects': 'My Projects',
      '/credits': 'Credits',
      '/credits/purchase': 'Purchase Credits',
      '/credits/history': 'Credits History',
      '/plans': 'Plans',
      '/profile': 'Profile',
      '/ai-task': 'AI Task',
    };

    const paths = pathname.split('/').filter(Boolean);
    const breadcrumbs: BreadcrumbItem[] = [{ label: 'Home', path: '/' }];

    let currentPath = '';
    paths.forEach(path => {
      currentPath += `/${path}`;
      const label = pathMap[currentPath];
      if (label) {
        breadcrumbs.push({
          label,
          path: currentPath !== pathname ? currentPath : undefined,
        });
      }
    });

    return breadcrumbs;
  };

  const breadcrumbs = getBreadcrumbs(location.pathname);

  if (breadcrumbs.length <= 1) return null;

  return (
    <nav className="flex mb-4 text-sm text-gray-500">
      {breadcrumbs.map((item, index) => (
        <React.Fragment key={item.path || item.label}>
          {index > 0 && <span className="mx-2">/</span>}
          {item.path ? (
            <Link
              to={item.path}
              className="hover:text-gray-700 transition-colors"
            >
              {item.label}
            </Link>
          ) : (
            <span className="text-gray-900">{item.label}</span>
          )}
        </React.Fragment>
      ))}
    </nav>
  );
};

export default Breadcrumb;
```

**éªŒæ”¶æ ‡å‡†**:
- [x] é¢åŒ…å±‘æ­£ç¡®æ˜¾ç¤ºå½“å‰é¡µé¢è·¯å¾„
- [x] æ”¯æŒç‚¹å‡»è·³è½¬åˆ°ä¸Šçº§é¡µé¢
- [x] åœ¨é¦–é¡µä¸æ˜¾ç¤ºé¢åŒ…å±‘

### 3.6 æ›´æ–°App.tsx
```typescript
import React from 'react';
import { RouterProvider } from 'react-router-dom';
import { Provider } from 'react-redux';
import { store } from '@/store';
import { router } from '@/router';
import '@/styles/global.css';

function App() {
  return (
    <Provider store={store}>
      <RouterProvider router={router} />
    </Provider>
  );
}

export default App;
```

## äº¤ä»˜ç‰©
- [x] å®Œæ•´çš„è·¯ç”±ç³»ç»Ÿé…ç½®
- [x] Layoutå¸ƒå±€ç»„ä»¶
- [x] è·¯ç”±å®ˆå«åŠŸèƒ½
- [x] é¢åŒ…å±‘å¯¼èˆªç»„ä»¶
- [x] æ‡’åŠ è½½å’Œé”™è¯¯è¾¹ç•Œå¤„ç†

## éªŒè¯æµ‹è¯•
1. è®¿é—®ä¸åŒè·¯ç”±ï¼Œæ£€æŸ¥é¡µé¢æ­£ç¡®æ¸²æŸ“
2. æµ‹è¯•è·¯ç”±å®ˆå«åŠŸèƒ½
3. éªŒè¯æ‡’åŠ è½½æ•ˆæœ
4. æ£€æŸ¥é¢åŒ…å±‘å¯¼èˆª
5. æµ‹è¯•404é¡µé¢

## é£é™©æ§åˆ¶
- **è·¯ç”±é…ç½®å¤æ‚åº¦**: ä¿æŒè·¯ç”±ç»“æ„æ¸…æ™°ï¼Œé¿å…è¿‡åº¦åµŒå¥—
- **æ‡’åŠ è½½å¤±è´¥**: å®ç°é”™è¯¯è¾¹ç•Œå¤„ç†åŠ è½½å¤±è´¥çš„ç»„ä»¶
- **å®ˆå«é€»è¾‘**: ç¡®ä¿ç™»å½•çŠ¶æ€æ£€æŸ¥çš„å‡†ç¡®æ€§

## éªŒæ”¶è®°å½•
**å®Œæˆæ—¶é—´**: 2025-01-09 11:15  
**éªŒæ”¶çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡  
**éªŒæ”¶äºº**: Claude Code  

### è¯¦ç»†éªŒæ”¶è®°å½•
1. **3.1 å®‰è£…React Router**: âœ… é€šè¿‡ - react-router-dom v7.8.2 å®‰è£…å®Œæˆ
2. **3.2 è·¯ç”±ç»“æ„è®¾è®¡**: âœ… é€šè¿‡ - è·¯ç”±é…ç½®æ”¯æŒåµŒå¥—è·¯ç”±ï¼Œé¡µé¢æ‡’åŠ è½½å®ç°ï¼Œé‡å®šå‘æ­£å¸¸å·¥ä½œ
3. **3.3 Layoutå¸ƒå±€ç»„ä»¶**: âœ… é€šè¿‡ - Layoutç»„ä»¶å®Œæ•´å®ç°Headerã€Sidebarã€Footerï¼Œå“åº”å¼å¯¼èˆªæ­£å¸¸
4. **3.4 è·¯ç”±å®ˆå«å®ç°**: âœ… é€šè¿‡ - ProtectedRouteå’ŒAuthRedirectç»„ä»¶åˆ›å»ºå®Œæˆï¼Œå‡†å¤‡çŠ¶æ€ç®¡ç†é›†æˆ
5. **3.5 é¢åŒ…å±‘å¯¼èˆª**: âœ… é€šè¿‡ - Breadcrumbç»„ä»¶æ”¯æŒè·¯å¾„æ˜¾ç¤ºï¼Œæ”¯æŒç‚¹å‡»è·³è½¬ï¼Œé¦–é¡µéšè—æ­£å¸¸
6. **3.6 æ›´æ–°App.tsx**: âœ… é€šè¿‡ - RouterProvideré›†æˆå®Œæˆï¼Œåº”ç”¨æ­£å¸¸å¯åŠ¨

### æµ‹è¯•ç»“æœ
- âœ… `npm run dev` - å¼€å‘æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œè·¯ç”±æ­£å¸¸å·¥ä½œ
- âœ… `npm run build` - ç”Ÿäº§æ„å»ºæˆåŠŸï¼Œæ‡’åŠ è½½åˆ†åŒ…æ­£ç¡®
- âœ… `npm run lint` - ä»£ç æ£€æŸ¥é€šè¿‡ï¼Œæ— è­¦å‘Šé”™è¯¯
- âœ… è·¯ç”±å¯¼èˆªæµ‹è¯• - æ‰€æœ‰è·¯ç”±é¡µé¢æ­£å¸¸æ¸²æŸ“
- âœ… é¢åŒ…å±‘æµ‹è¯• - è·¯å¾„æ˜¾ç¤ºå’Œè·³è½¬æ­£å¸¸å·¥ä½œ
- âœ… 404é¡µé¢æµ‹è¯• - æ— æ•ˆè·¯ç”±æ­£ç¡®æ˜¾ç¤º404é¡µé¢

### æŠ€æœ¯å®ç°äº®ç‚¹
- ğŸ¯ ä½¿ç”¨React Router v7æœ€æ–°ç‰ˆæœ¬
- âš¡ å®ç°é¡µé¢çº§åˆ«æ‡’åŠ è½½ä¼˜åŒ–
- ğŸ¨ å“åº”å¼Layoutè®¾è®¡æ”¯æŒç§»åŠ¨ç«¯
- ğŸ æ™ºèƒ½é¢åŒ…å±‘å¯¼èˆªç³»ç»Ÿ
- ğŸ›¡ï¸ è·¯ç”±å®ˆå«æ¡†æ¶å°±ç»ª
- ğŸ“¦ ä»£ç åˆ†åŒ…ä¼˜åŒ–æ„å»ºè¾“å‡º

### é—®é¢˜è§£å†³è®°å½•
- ğŸ”§ ä¿®å¤ESLint react-refresh/only-export-componentsé”™è¯¯ï¼Œåˆ†ç¦»LazyWrapperç»„ä»¶
- ğŸ”§ ä¼˜åŒ–æ„å»ºè¾“å‡ºï¼Œå®ç°äº†15ä¸ªç‹¬ç«‹é¡µé¢chunk

### å¾…çŠ¶æ€ç®¡ç†å®Œæˆåéœ€æ›´æ–°
- ProtectedRouteå’ŒAuthRedirectä¸­çš„è®¤è¯çŠ¶æ€åˆ¤æ–­
- Headerç»„ä»¶ä¸­çš„ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
- è·¯ç”±å®ˆå«çš„å®Œæ•´åŠŸèƒ½å®ç°

## ä¸‹ä¸€æ­¥
å®Œæˆåè¿›å…¥ `01-4-çŠ¶æ€ç®¡ç†æ­å»º` âœ… **å‡†å¤‡å¼€å§‹**
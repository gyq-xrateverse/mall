# 01-6-4-图标系统

## 任务概述
- **时间估算**: 30分钟
- **优先级**: 中
- **依赖关系**: 
  - 依赖：01-6-3-基础UI组件库（组件库基础）
  - 依赖：01-6-2-Ant Design集成（图标库基础）
  - 前置：UI组件库和Ant Design配置完成
- **执行阶段**: 第一阶段-前端基础架构

## 详细任务清单

### 6.4.1 规划图标系统架构
- [ ] 分析项目图标需求
- [ ] 设计图标分类体系
- [ ] 定义图标使用规范
- [ ] 创建图标管理结构

### 6.4.2 集成Ant Design图标
- [ ] 配置Ant Design图标库
- [ ] 创建图标组件封装
- [ ] 实现按需加载机制
- [ ] 添加图标类型定义

### 6.4.3 扩展自定义图标
- [ ] 集成第三方图标库
- [ ] 添加SVG图标支持
- [ ] 创建图标字体文件
- [ ] 实现图标动画效果

### 6.4.4 创建图标管理工具
- [ ] 开发图标选择组件
- [ ] 创建图标预览工具
- [ ] 实现图标搜索功能
- [ ] 添加图标使用文档

## 验收标准

### 功能验收
- [ ] 图标系统正常工作
- [ ] 按需加载机制生效
- [ ] 自定义图标正确显示
- [ ] 图标动画效果流畅

### 代码质量验收
- [ ] 图标系统架构清晰
- [ ] TypeScript类型定义完整
- [ ] 图标组件可复用性好
- [ ] 代码可维护性良好

### 性能验收
- [ ] 图标加载速度快
- [ ] 包体积增长合理
- [ ] 图标缓存机制有效
- [ ] 内存使用优化

## 交付物

### 1. 图标系统配置
```
src/components/Icon/
├── index.tsx              # 图标组件主入口
├── types.ts               # 图标类型定义
├── constants.ts           # 图标常量配置
├── IconProvider.tsx       # 图标提供者组件
└── utils.ts               # 图标工具函数
```

### 2. 图标库文件
```
src/assets/icons/
├── svg/                   # SVG图标文件
│   ├── common/           # 通用图标
│   ├── business/         # 业务图标
│   └── brand/            # 品牌图标
├── fonts/                # 图标字体文件
└── index.ts              # 图标库导出
```

### 3. 图标工具组件
```
src/components/IconTools/
├── IconPicker.tsx         # 图标选择器
├── IconPreview.tsx        # 图标预览组件
├── IconSearch.tsx         # 图标搜索组件
└── IconDemo.tsx           # 图标演示组件
```

## 技术要点

### 安装图标相关依赖
```bash
# 核心图标库
pnpm add @ant-design/icons

# 第三方图标库（可选）
pnpm add @heroicons/react
pnpm add react-icons
pnpm add @tabler/icons-react

# 图标处理工具
pnpm add -D @svgr/webpack
pnpm add -D vite-plugin-svgr
```

### 图标组件封装
```typescript
// src/components/Icon/index.tsx
import React from 'react';
import type { IconBaseProps } from '@ant-design/icons/lib/components/Icon';
import { cn } from '@/utils/styles/classNames';
import { IconType, IconSize, IconName } from './types';
import * as AntIcons from '@ant-design/icons';
import * as CustomIcons from '@/assets/icons';

export interface IconProps extends Omit<IconBaseProps, 'component'> {
  name: IconName;
  size?: IconSize | number;
  color?: string;
  spin?: boolean;
  rotate?: number;
  flip?: 'horizontal' | 'vertical';
  type?: IconType;
  className?: string;
}

const Icon: React.FC<IconProps> = ({
  name,
  size = 'default',
  color,
  spin = false,
  rotate,
  flip,
  type = 'ant',
  className,
  style,
  ...props
}) => {
  // 尺寸映射
  const sizeMap: Record<IconSize, number> = {
    small: 14,
    default: 16,
    large: 20,
    xl: 24,
    xxl: 32,
  };

  // 获取图标尺寸
  const iconSize = typeof size === 'number' ? size : sizeMap[size];

  // 基础样式
  const baseStyle: React.CSSProperties = {
    fontSize: iconSize,
    color,
    transform: [
      rotate ? `rotate(${rotate}deg)` : '',
      flip === 'horizontal' ? 'scaleX(-1)' : '',
      flip === 'vertical' ? 'scaleY(-1)' : '',
    ].filter(Boolean).join(' ') || undefined,
    ...style,
  };

  // 基础类名
  const baseClassName = cn(
    'inline-flex items-center justify-center',
    {
      'animate-spin': spin,
    },
    className
  );

  // 根据类型渲染不同图标
  const renderIcon = () => {
    switch (type) {
      case 'ant': {
        // Ant Design图标
        const AntIcon = (AntIcons as any)[name];
        if (!AntIcon) {
          console.warn(`Ant Design icon "${name}" not found`);
          return <AntIcons.QuestionCircleOutlined />;
        }
        return (
          <AntIcon
            {...props}
            className={baseClassName}
            style={baseStyle}
          />
        );
      }
      
      case 'custom': {
        // 自定义SVG图标
        const CustomIcon = (CustomIcons as any)[name];
        if (!CustomIcon) {
          console.warn(`Custom icon "${name}" not found`);
          return <AntIcons.QuestionCircleOutlined />;
        }
        return (
          <CustomIcon
            className={baseClassName}
            style={baseStyle}
            {...props}
          />
        );
      }
      
      case 'heroicons': {
        // Heroicons图标（如果安装了）
        try {
          const HeroIcon = require('@heroicons/react/24/outline')[name];
          if (!HeroIcon) {
            console.warn(`Heroicons icon "${name}" not found`);
            return <AntIcons.QuestionCircleOutlined />;
          }
          return (
            <HeroIcon
              className={baseClassName}
              style={baseStyle}
            />
          );
        } catch (error) {
          console.warn('Heroicons not available');
          return <AntIcons.QuestionCircleOutlined />;
        }
      }
      
      default:
        return <AntIcons.QuestionCircleOutlined />;
    }
  };

  return renderIcon();
};

export default Icon;
```

### 图标类型定义
```typescript
// src/components/Icon/types.ts
import type * as AntIcons from '@ant-design/icons';

// 图标类型
export type IconType = 'ant' | 'custom' | 'heroicons';

// 图标尺寸
export type IconSize = 'small' | 'default' | 'large' | 'xl' | 'xxl';

// Ant Design图标名称
export type AntIconName = keyof typeof AntIcons;

// 自定义图标名称
export type CustomIconName = 
  | 'BeilVLogo'
  | 'AgentIcon'
  | 'ChatIcon'
  | 'DashboardIcon'
  | 'SettingsIcon'
  | 'UserManageIcon'
  | 'ReportIcon'
  | 'NotificationIcon';

// 所有图标名称
export type IconName = AntIconName | CustomIconName;

// 图标分类
export interface IconCategory {
  key: string;
  name: string;
  icons: IconName[];
}

// 图标配置
export interface IconConfig {
  name: IconName;
  type: IconType;
  category: string;
  keywords: string[];
  deprecated?: boolean;
}
```

### 图标常量配置
```typescript
// src/components/Icon/constants.ts
import { IconCategory, IconConfig } from './types';

// 图标分类
export const ICON_CATEGORIES: IconCategory[] = [
  {
    key: 'common',
    name: '通用',
    icons: [
      'HomeOutlined',
      'UserOutlined',
      'SettingOutlined',
      'SearchOutlined',
      'PlusOutlined',
      'EditOutlined',
      'DeleteOutlined',
      'SaveOutlined',
      'CloseOutlined',
      'CheckOutlined',
    ],
  },
  {
    key: 'navigation',
    name: '导航',
    icons: [
      'MenuOutlined',
      'MenuFoldOutlined',
      'MenuUnfoldOutlined',
      'LeftOutlined',
      'RightOutlined',
      'UpOutlined',
      'DownOutlined',
      'ArrowLeftOutlined',
      'ArrowRightOutlined',
    ],
  },
  {
    key: 'data',
    name: '数据',
    icons: [
      'TableOutlined',
      'FileTextOutlined',
      'FileOutlined',
      'FolderOutlined',
      'DatabaseOutlined',
      'CloudOutlined',
      'DownloadOutlined',
      'UploadOutlined',
      'ExportOutlined',
      'ImportOutlined',
    ],
  },
  {
    key: 'communication',
    name: '交流',
    icons: [
      'MessageOutlined',
      'CommentOutlined',
      'PhoneOutlined',
      'MailOutlined',
      'NotificationOutlined',
      'BellOutlined',
      'VideoCameraOutlined',
      'AudioOutlined',
    ],
  },
  {
    key: 'status',
    name: '状态',
    icons: [
      'CheckCircleOutlined',
      'CloseCircleOutlined',
      'ExclamationCircleOutlined',
      'InfoCircleOutlined',
      'QuestionCircleOutlined',
      'WarningOutlined',
      'LoadingOutlined',
      'SyncOutlined',
    ],
  },
  {
    key: 'business',
    name: '业务',
    icons: [
      'BeilVLogo',
      'AgentIcon',
      'ChatIcon',
      'DashboardIcon',
      'UserManageIcon',
      'ReportIcon',
    ],
  },
];

// 图标配置映射
export const ICON_CONFIGS: Record<string, IconConfig> = {
  // 通用图标
  'HomeOutlined': {
    name: 'HomeOutlined',
    type: 'ant',
    category: 'common',
    keywords: ['home', 'house', '首页', '主页'],
  },
  'UserOutlined': {
    name: 'UserOutlined',
    type: 'ant',
    category: 'common',
    keywords: ['user', 'person', '用户', '人员'],
  },
  
  // 业务图标
  'BeilVLogo': {
    name: 'BeilVLogo',
    type: 'custom',
    category: 'business',
    keywords: ['logo', 'brand', 'beilv', '北旅', '品牌'],
  },
  'AgentIcon': {
    name: 'AgentIcon',
    type: 'custom',
    category: 'business',
    keywords: ['agent', 'ai', 'robot', '智能体', '机器人'],
  },
  
  // 更多图标配置...
};

// 图标搜索索引
export const createIconSearchIndex = () => {
  const index = new Map<string, string[]>();
  
  Object.values(ICON_CONFIGS).forEach(config => {
    config.keywords.forEach(keyword => {
      const normalizedKeyword = keyword.toLowerCase();
      if (!index.has(normalizedKeyword)) {
        index.set(normalizedKeyword, []);
      }
      index.get(normalizedKeyword)!.push(config.name);
    });
  });
  
  return index;
};
```

### 图标选择器组件
```typescript
// src/components/IconTools/IconPicker.tsx
import React, { useState, useMemo } from 'react';
import { Modal, Input, Tabs, Row, Col, Tooltip, Empty } from 'antd';
import { SearchOutlined } from '@ant-design/icons';
import Icon from '@/components/Icon';
import { ICON_CATEGORIES, createIconSearchIndex } from '@/components/Icon/constants';
import { IconName } from '@/components/Icon/types';
import { cn } from '@/utils/styles/classNames';

const { Search } = Input;

export interface IconPickerProps {
  value?: IconName;
  onChange?: (icon: IconName) => void;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}

const IconPicker: React.FC<IconPickerProps> = ({
  value,
  onChange,
  open,
  onOpenChange,
}) => {
  const [searchText, setSearchText] = useState('');
  const [selectedIcon, setSelectedIcon] = useState<IconName | undefined>(value);
  
  // 创建搜索索引
  const searchIndex = useMemo(() => createIconSearchIndex(), []);

  // 搜索图标
  const searchResults = useMemo(() => {
    if (!searchText.trim()) return [];
    
    const normalizedSearch = searchText.toLowerCase();
    const results = new Set<IconName>();
    
    // 搜索关键词
    searchIndex.forEach((icons, keyword) => {
      if (keyword.includes(normalizedSearch)) {
        icons.forEach(icon => results.add(icon as IconName));
      }
    });
    
    return Array.from(results);
  }, [searchText, searchIndex]);

  // 渲染图标网格
  const renderIconGrid = (icons: IconName[]) => {
    if (icons.length === 0) {
      return <Empty description="没有找到匹配的图标" />;
    }
    
    return (
      <Row gutter={[8, 8]}>
        {icons.map(iconName => (
          <Col key={iconName} span={3}>
            <Tooltip title={iconName}>
              <div
                className={cn(
                  'flex flex-col items-center p-3 rounded cursor-pointer transition-colors',
                  'hover:bg-gray-100 dark:hover:bg-gray-700',
                  selectedIcon === iconName && 'bg-primary-50 border border-primary-300'
                )}
                onClick={() => setSelectedIcon(iconName)}
              >
                <Icon name={iconName} size="large" />
                <span className="text-xs mt-1 text-center truncate w-full">
                  {iconName}
                </span>
              </div>
            </Tooltip>
          </Col>
        ))}
      </Row>
    );
  };

  // 标签页配置
  const tabItems = [
    // 搜索结果
    ...(searchText ? [{
      key: 'search',
      label: `搜索结果 (${searchResults.length})`,
      children: renderIconGrid(searchResults),
    }] : []),
    
    // 分类标签页
    ...ICON_CATEGORIES.map(category => ({
      key: category.key,
      label: category.name,
      children: renderIconGrid(category.icons),
    })),
  ];

  const handleOk = () => {
    if (selectedIcon) {
      onChange?.(selectedIcon);
    }
    onOpenChange?.(false);
  };

  const handleCancel = () => {
    setSelectedIcon(value);
    onOpenChange?.(false);
  };

  return (
    <Modal
      title="选择图标"
      open={open}
      onOk={handleOk}
      onCancel={handleCancel}
      width={800}
      className="icon-picker-modal"
    >
      <div className="mb-4">
        <Search
          placeholder="搜索图标..."
          value={searchText}
          onChange={e => setSearchText(e.target.value)}
          allowClear
          prefix={<SearchOutlined />}
        />
      </div>
      
      <div className="max-h-96 overflow-y-auto">
        <Tabs
          items={tabItems}
          defaultActiveKey={searchText ? 'search' : 'common'}
          size="small"
        />
      </div>
      
      {selectedIcon && (
        <div className="mt-4 p-3 bg-gray-50 dark:bg-gray-800 rounded flex items-center gap-3">
          <span>已选择：</span>
          <Icon name={selectedIcon} size="large" />
          <span className="font-mono text-sm">{selectedIcon}</span>
        </div>
      )}
    </Modal>
  );
};

export default IconPicker;
```

### SVG图标处理
```typescript
// vite.config.ts 添加SVG支持
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react-swc';
import svgr from 'vite-plugin-svgr';

export default defineConfig({
  plugins: [
    react(),
    svgr({
      // SVG组件选项
      svgrOptions: {
        icon: true,
        replaceAttrValues: {
          '#000': 'currentColor',
        },
      },
      // 仅对icons目录下的SVG文件使用SVGR
      include: '**/icons/**/*.svg',
    }),
  ],
});
```

### 自定义SVG图标组件
```typescript
// src/assets/icons/BeilVLogo.tsx
import React from 'react';

interface BeilVLogoProps {
  className?: string;
  style?: React.CSSProperties;
  size?: number;
  color?: string;
}

const BeilVLogo: React.FC<BeilVLogoProps> = ({
  className,
  style,
  size = 24,
  color = 'currentColor',
}) => {
  return (
    <svg
      className={className}
      style={style}
      width={size}
      height={size}
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M12 2L2 7L12 12L22 7L12 2Z"
        stroke={color}
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M2 17L12 22L22 17"
        stroke={color}
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
      <path
        d="M2 12L12 17L22 12"
        stroke={color}
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
};

export default BeilVLogo;
```

### 图标动画效果
```css
/* src/styles/icon-animations.css */
@keyframes icon-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes icon-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

@keyframes icon-bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-10px);
  }
  60% {
    transform: translateY(-5px);
  }
}

/* 图标动画类 */
.icon-spin {
  animation: icon-spin 1s linear infinite;
}

.icon-pulse {
  animation: icon-pulse 2s ease-in-out infinite;
}

.icon-bounce {
  animation: icon-bounce 1s ease-in-out infinite;
}

/* 悬停效果 */
.icon-hover-scale:hover {
  transform: scale(1.1);
  transition: transform 0.2s ease-in-out;
}

.icon-hover-rotate:hover {
  transform: rotate(15deg);
  transition: transform 0.2s ease-in-out;
}
```

## 下一步
- **后续任务**: 01-6-5-响应式设计工具
- **关联任务**: 创建响应式设计的工具和组件
- **注意事项**: 
  - 图标加载要考虑性能优化
  - 确保图标在不同主题下的显示效果
  - 建立图标使用规范和文档

## 常见问题解决

### Q1: 图标不显示或显示异常
- 检查图标名称是否正确
- 确认图标库是否正确导入
- 验证SVG文件路径和格式

### Q2: 图标加载性能问题
- 使用按需导入减少包大小
- 对图标进行压缩优化
- 实现图标懒加载机制

### Q3: 自定义图标集成问题
- 检查SVGR配置是否正确
- 确认SVG文件格式规范
- 验证图标组件导出正确

### Q4: 图标样式冲突
- 使用CSS-in-JS或CSS Module隔离样式
- 确保图标容器样式正确
- 检查主题变量应用
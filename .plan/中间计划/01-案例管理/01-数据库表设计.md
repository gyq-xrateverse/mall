# 01-数据库表设计

## 任务概述
创建案例管理所需的数据库表结构，包括案例分类表和案例数据表。

## 前置条件
- MySQL数据库已配置
- 具有数据库DDL操作权限
- 已了解现有数据库表的命名规范

## 实施步骤

### 1. 分析现有表结构规范
参考现有的商品相关表（如`pms_product`、`pms_product_category`）的字段命名和数据类型规范。

### 2. 创建案例分类表
```sql
-- 案例分类表
CREATE TABLE `case_category` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '分类ID',
  `name` varchar(100) NOT NULL COMMENT '分类名称',
  `sort` int(11) DEFAULT '0' COMMENT '排序字段',
  `status` int(1) DEFAULT '1' COMMENT '状态：0->禁用；1->启用',
  `show_status` int(1) DEFAULT '1' COMMENT '显示状态：0->不显示；1->显示',
  `delete_status` int(1) DEFAULT '0' COMMENT '删除状态：0->未删除；1->已删除',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `modify_time` datetime DEFAULT NULL COMMENT '修改时间',
  `create_by` varchar(100) DEFAULT NULL COMMENT '创建人',
  `modify_by` varchar(100) DEFAULT NULL COMMENT '修改人',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_sort` (`sort`) USING BTREE COMMENT '排序索引',
  KEY `idx_status` (`status`, `show_status`) USING BTREE COMMENT '状态索引'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='案例分类表';
```

### 3. 创建案例数据表
```sql
-- 案例数据表
CREATE TABLE `case_data` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '案例ID',
  `category_id` bigint(20) NOT NULL COMMENT '分类类型ID',
  `title` varchar(200) NOT NULL COMMENT '案例标题',
  `description` text COMMENT '案例描述',
  `preview_image_url` varchar(500) DEFAULT NULL COMMENT '预览图URL',
  `video_url` varchar(500) DEFAULT NULL COMMENT '视频URL',
  `video_preview_url` varchar(500) DEFAULT NULL COMMENT '视频预览地址',
  `like_count` int(11) DEFAULT '0' COMMENT '点赞数',
  `view_count` int(11) DEFAULT '0' COMMENT '预览次数',
  `hot_score` decimal(10,2) DEFAULT '0' COMMENT '热度分数',
  `hot_update_time` datetime DEFAULT NULL COMMENT '热度更新时间',
  `sort` int(11) DEFAULT '0' COMMENT '排序字段',
  `status` int(1) DEFAULT '1' COMMENT '状态：0->禁用；1->启用',
  `show_status` int(1) DEFAULT '1' COMMENT '显示状态：0->不显示；1->显示',
  `delete_status` int(1) DEFAULT '0' COMMENT '删除状态：0->未删除；1->已删除',
  `create_time` datetime DEFAULT NULL COMMENT '创建时间',
  `modify_time` datetime DEFAULT NULL COMMENT '修改时间',
  `create_by` varchar(100) DEFAULT NULL COMMENT '创建人',
  `modify_by` varchar(100) DEFAULT NULL COMMENT '修改人',
  PRIMARY KEY (`id`) USING BTREE,
  KEY `idx_category_id` (`category_id`) USING BTREE COMMENT '分类索引',
  KEY `idx_status` (`status`, `show_status`) USING BTREE COMMENT '状态索引',
  KEY `idx_hot_score` (`hot_score` DESC) USING BTREE COMMENT '热度排序索引',
  KEY `idx_create_time` (`create_time` DESC) USING BTREE COMMENT '最新排序索引',
  KEY `idx_view_count` (`view_count` DESC) USING BTREE COMMENT '浏览量索引',
  KEY `idx_like_count` (`like_count` DESC) USING BTREE COMMENT '点赞量索引'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='案例数据表';
```

### 4. 插入初始分类数据
```sql
-- 插入默认分类数据
INSERT INTO `case_category` (`name`, `sort`, `status`, `show_status`, `create_time`) VALUES
('服装', 1, 1, 1, NOW()),
('模特', 2, 1, 1, NOW()),
('餐饮', 3, 1, 1, NOW()),
('建筑', 4, 1, 1, NOW()),
('艺术', 5, 1, 1, NOW()),
('科技', 6, 1, 1, NOW()),
('自然', 7, 1, 1, NOW());
```

## 设计说明

### 字段设计原则
1. **遵循现有规范**：与现有商城系统表结构保持一致
2. **支持软删除**：使用`delete_status`字段实现软删除
3. **多状态控制**：`status`（启用/禁用）和`show_status`（显示/隐藏）
4. **审计字段**：记录创建时间、修改时间、操作人

### 索引设计考虑
1. **热度排序**：`idx_hot_score`支持热门案例查询
2. **时间排序**：`idx_create_time`支持最新案例查询
3. **分类查询**：`idx_category_id`支持按分类查询
4. **状态过滤**：复合索引`(status, show_status)`优化状态过滤

### 热度分数说明
- 使用`decimal(10,2)`存储热度分数，支持小数点后2位
- 通过定时任务计算：`hot_score = (like_count * 0.7 + view_count * 0.3) * time_decay_factor`
- 考虑时间衰减因子，让新发布的内容有更高权重

## 验证步骤
1. 执行SQL创建表结构
2. 检查表和索引创建是否成功
3. 插入测试数据验证表结构
4. 测试各种查询场景的性能

## 输出物
- 创建完成的数据库表：`case_category`、`case_data`
- 初始化的分类数据
- 验证SQL脚本

## 后续任务
- 下一步：02-生成实体类和Mapper.md
# 15-用户端案例展示页面

## 任务概述
在用户端(beilv-agent-web)实现案例展示页面，包括案例列表展示、详情页面、分类筛选和搜索功能，使用React + Redux架构。

## 前置条件
- 13-重构Redux-store.md 已完成
- 14-实现懒加载组件.md 已完成
- 后端mall-portal案例查询API已部署
- UI设计稿已确认

## 实施步骤

### 1. 创建案例相关页面组件

#### 案例列表页面
**文件路径：** `beilv-agent-web/src/pages/Cases/CaseList.jsx`

```jsx
import React, { useEffect, useState } from 'react';
import { useSelector, useDispatch } from 'react-redux';
import { fetchCaseCategories, fetchCases, setSelectedCategory } from '../../store/slices/caseSlice';
import CaseGrid from '../../components/Cases/CaseGrid';
import CategoryFilter from '../../components/Cases/CategoryFilter';
import SearchBar from '../../components/Cases/SearchBar';
import InfiniteLoader from '../../components/Common/InfiniteLoader';
import './CaseList.scss';

const CaseList = () => {
  const dispatch = useDispatch();
  const {
    categories,
    cases,
    selectedCategory,
    loading,
    hasMore,
    searchKeyword
  } = useSelector(state => state.cases);

  const [searchQuery, setSearchQuery] = useState('');

  useEffect(() => {
    // 初始化加载分类和案例
    dispatch(fetchCaseCategories());
    dispatch(fetchCases({ 
      categoryId: selectedCategory,
      page: 1,
      keyword: searchKeyword 
    }));
  }, [dispatch, selectedCategory, searchKeyword]);

  const handleCategoryChange = (categoryId) => {
    dispatch(setSelectedCategory(categoryId));
  };

  const handleSearch = (keyword) => {
    setSearchQuery(keyword);
    dispatch(fetchCases({ 
      categoryId: selectedCategory,
      page: 1,
      keyword: keyword,
      reset: true 
    }));
  };

  const loadMore = () => {
    if (!loading && hasMore) {
      dispatch(fetchCases({ 
        categoryId: selectedCategory,
        keyword: searchQuery,
        loadMore: true 
      }));
    }
  };

  return (
    <div className="case-list-page">
      <div className="page-header">
        <h1 className="page-title">案例展示</h1>
        <p className="page-description">探索我们的优秀案例作品</p>
      </div>

      <div className="page-content">
        <div className="filter-section">
          <SearchBar
            value={searchQuery}
            onChange={setSearchQuery}
            onSearch={handleSearch}
            placeholder="搜索案例..."
          />
          <CategoryFilter
            categories={categories}
            selectedCategory={selectedCategory}
            onChange={handleCategoryChange}
          />
        </div>

        <div className="cases-section">
          {cases.length > 0 ? (
            <InfiniteLoader
              hasMore={hasMore}
              loading={loading}
              onLoadMore={loadMore}
            >
              <CaseGrid cases={cases} />
            </InfiniteLoader>
          ) : (
            <div className="empty-state">
              <div className="empty-icon">📋</div>
              <p className="empty-message">
                {loading ? '加载中...' : '暂无案例数据'}
              </p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default CaseList;
```

#### 案例详情页面
**文件路径：** `beilv-agent-web/src/pages/Cases/CaseDetail.jsx`

```jsx
import React, { useEffect, useState } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { useDispatch, useSelector } from 'react-redux';
import { fetchCaseDetail, incrementCaseViews } from '../../store/slices/caseSlice';
import ImageGallery from '../../components/Cases/ImageGallery';
import CaseInfo from '../../components/Cases/CaseInfo';
import RelatedCases from '../../components/Cases/RelatedCases';
import LoadingSpinner from '../../components/Common/LoadingSpinner';
import './CaseDetail.scss';

const CaseDetail = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const dispatch = useDispatch();
  
  const { currentCase, loading, error } = useSelector(state => state.cases);
  const [imageViewerOpen, setImageViewerOpen] = useState(false);
  const [currentImageIndex, setCurrentImageIndex] = useState(0);

  useEffect(() => {
    if (id) {
      dispatch(fetchCaseDetail(id));
      // 增加浏览量
      dispatch(incrementCaseViews(id));
    }
  }, [dispatch, id]);

  const handleImageClick = (index) => {
    setCurrentImageIndex(index);
    setImageViewerOpen(true);
  };

  const handleBackToList = () => {
    navigate('/cases');
  };

  if (loading) {
    return (
      <div className="case-detail-loading">
        <LoadingSpinner size="large" />
      </div>
    );
  }

  if (error || !currentCase) {
    return (
      <div className="case-detail-error">
        <div className="error-content">
          <h2>案例未找到</h2>
          <p>请检查链接是否正确或返回案例列表</p>
          <button onClick={handleBackToList} className="back-button">
            返回案例列表
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="case-detail-page">
      <div className="case-detail-header">
        <button onClick={handleBackToList} className="back-button">
          ← 返回列表
        </button>
      </div>

      <div className="case-detail-content">
        <div className="case-main">
          <div className="case-images">
            <ImageGallery
              images={currentCase.images}
              onImageClick={handleImageClick}
            />
          </div>

          <div className="case-content">
            <CaseInfo case={currentCase} />
            
            {currentCase.content && (
              <div className="case-description">
                <h3>项目描述</h3>
                <div
                  className="description-content"
                  dangerouslySetInnerHTML={{ __html: currentCase.content }}
                />
              </div>
            )}
          </div>
        </div>

        <div className="case-sidebar">
          <RelatedCases
            categoryId={currentCase.categoryId}
            excludeId={currentCase.id}
          />
        </div>
      </div>

      {/* 图片查看器 */}
      {imageViewerOpen && (
        <ImageViewer
          images={currentCase.images}
          currentIndex={currentImageIndex}
          onClose={() => setImageViewerOpen(false)}
          onIndexChange={setCurrentImageIndex}
        />
      )}
    </div>
  );
};

export default CaseDetail;
```

### 2. 创建案例相关组件

#### 案例卡片组件
**文件路径：** `beilv-agent-web/src/components/Cases/CaseCard.jsx`

```jsx
import React from 'react';
import { Link } from 'react-router-dom';
import LazyImage from '../Common/LazyImage';
import './CaseCard.scss';

const CaseCard = ({ caseData, className = '' }) => {
  const {
    id,
    title,
    coverImage,
    categoryName,
    viewCount = 0,
    likeCount = 0,
    createTime
  } = caseData;

  const formatCount = (count) => {
    if (count >= 1000) {
      return `${(count / 1000).toFixed(1)}k`;
    }
    return count.toString();
  };

  const formatDate = (dateString) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('zh-CN');
  };

  return (
    <div className={`case-card ${className}`}>
      <Link to={`/cases/${id}`} className="case-card-link">
        <div className="case-card-image">
          <LazyImage
            src={coverImage}
            alt={title}
            className="cover-image"
            placeholder="/images/case-placeholder.jpg"
          />
          <div className="case-card-overlay">
            <div className="overlay-content">
              <span className="view-detail">查看详情</span>
            </div>
          </div>
        </div>

        <div className="case-card-content">
          <h3 className="case-title" title={title}>
            {title}
          </h3>
          
          <div className="case-meta">
            <span className="category">{categoryName}</span>
            <time className="date">{formatDate(createTime)}</time>
          </div>

          <div className="case-stats">
            <div className="stat-item">
              <span className="stat-icon">👁</span>
              <span className="stat-value">{formatCount(viewCount)}</span>
            </div>
            <div className="stat-item">
              <span className="stat-icon">❤️</span>
              <span className="stat-value">{formatCount(likeCount)}</span>
            </div>
          </div>
        </div>
      </Link>
    </div>
  );
};

export default CaseCard;
```

#### 案例网格组件
**文件路径：** `beilv-agent-web/src/components/Cases/CaseGrid.jsx`

```jsx
import React from 'react';
import CaseCard from './CaseCard';
import './CaseGrid.scss';

const CaseGrid = ({ cases = [], className = '' }) => {
  if (cases.length === 0) {
    return null;
  }

  return (
    <div className={`case-grid ${className}`}>
      {cases.map((caseItem) => (
        <CaseCard
          key={caseItem.id}
          caseData={caseItem}
          className="case-grid-item"
        />
      ))}
    </div>
  );
};

export default CaseGrid;
```

#### 分类筛选组件
**文件路径：** `beilv-agent-web/src/components/Cases/CategoryFilter.jsx`

```jsx
import React from 'react';
import './CategoryFilter.scss';

const CategoryFilter = ({
  categories = [],
  selectedCategory,
  onChange,
  className = ''
}) => {
  // 添加"全部"选项
  const allCategories = [
    { id: null, name: '全部', count: null },
    { id: 'latest', name: '最新', count: null },
    { id: 'hot', name: '热门', count: null },
    ...categories
  ];

  const handleCategoryClick = (categoryId) => {
    if (onChange) {
      onChange(categoryId);
    }
  };

  return (
    <div className={`category-filter ${className}`}>
      <div className="filter-title">案例分类</div>
      <div className="category-list">
        {allCategories.map((category) => (
          <button
            key={category.id || 'all'}
            className={`category-item ${
              selectedCategory === category.id ? 'active' : ''
            }`}
            onClick={() => handleCategoryClick(category.id)}
          >
            <span className="category-name">{category.name}</span>
            {category.count !== null && (
              <span className="category-count">({category.count})</span>
            )}
          </button>
        ))}
      </div>
    </div>
  );
};

export default CategoryFilter;
```

#### 搜索栏组件
**文件路径：** `beilv-agent-web/src/components/Cases/SearchBar.jsx`

```jsx
import React, { useState, useCallback } from 'react';
import { debounce } from 'lodash';
import './SearchBar.scss';

const SearchBar = ({
  value = '',
  onChange,
  onSearch,
  placeholder = '搜索...',
  className = ''
}) => {
  const [inputValue, setInputValue] = useState(value);

  // 防抖搜索
  const debouncedSearch = useCallback(
    debounce((query) => {
      if (onSearch) {
        onSearch(query);
      }
    }, 500),
    [onSearch]
  );

  const handleInputChange = (e) => {
    const query = e.target.value;
    setInputValue(query);
    
    if (onChange) {
      onChange(query);
    }
    
    // 自动搜索
    debouncedSearch(query);
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    if (onSearch) {
      onSearch(inputValue);
    }
  };

  const handleClear = () => {
    setInputValue('');
    if (onChange) {
      onChange('');
    }
    if (onSearch) {
      onSearch('');
    }
  };

  return (
    <form className={`search-bar ${className}`} onSubmit={handleSubmit}>
      <div className="search-input-wrapper">
        <input
          type="text"
          className="search-input"
          value={inputValue}
          onChange={handleInputChange}
          placeholder={placeholder}
        />
        
        {inputValue && (
          <button
            type="button"
            className="clear-button"
            onClick={handleClear}
          >
            ×
          </button>
        )}
        
        <button type="submit" className="search-button">
          🔍
        </button>
      </div>
    </form>
  );
};

export default SearchBar;
```

### 3. 创建样式文件

#### 案例列表页面样式
**文件路径：** `beilv-agent-web/src/pages/Cases/CaseList.scss`

```scss
.case-list-page {
  min-height: 100vh;
  background: #f8f9fa;

  .page-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 4rem 0 3rem;
    text-align: center;

    .page-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      letter-spacing: -0.025em;
    }

    .page-description {
      font-size: 1.125rem;
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto;
    }
  }

  .page-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .filter-section {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);

    .search-bar {
      margin-bottom: 2rem;
    }
  }

  .cases-section {
    .empty-state {
      background: white;
      border-radius: 12px;
      padding: 4rem 2rem;
      text-align: center;

      .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
      }

      .empty-message {
        font-size: 1.125rem;
        color: #6b7280;
      }
    }
  }
}

// 响应式设计
@media (max-width: 768px) {
  .case-list-page {
    .page-header {
      padding: 2rem 0 1.5rem;

      .page-title {
        font-size: 2rem;
      }

      .page-description {
        font-size: 1rem;
      }
    }

    .page-content {
      padding: 1rem;
    }

    .filter-section {
      padding: 1rem;
    }
  }
}
```

#### 案例卡片样式
**文件路径：** `beilv-agent-web/src/components/Cases/CaseCard.scss`

```scss
.case-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  height: fit-content;

  &:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);

    .case-card-overlay {
      opacity: 1;
    }
  }

  .case-card-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .case-card-image {
    position: relative;
    width: 100%;
    aspect-ratio: 4/3;
    overflow: hidden;

    .cover-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .case-card-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;

      .overlay-content {
        .view-detail {
          color: white;
          font-size: 1rem;
          font-weight: 600;
          padding: 0.75rem 1.5rem;
          border: 2px solid white;
          border-radius: 25px;
          transition: all 0.3s ease;

          &:hover {
            background: white;
            color: #333;
          }
        }
      }
    }
  }

  .case-card-content {
    padding: 1.5rem;

    .case-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      color: #1f2937;
    }

    .case-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      color: #6b7280;

      .category {
        background: #f3f4f6;
        color: #374151;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-weight: 500;
      }
    }

    .case-stats {
      display: flex;
      gap: 1rem;

      .stat-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.875rem;
        color: #6b7280;

        .stat-icon {
          font-size: 1rem;
        }
      }
    }
  }
}
```

### 4. 路由配置

**文件路径：** 在 `beilv-agent-web/src/App.js` 中添加路由

```javascript
// 添加案例相关路由
import CaseList from './pages/Cases/CaseList';
import CaseDetail from './pages/Cases/CaseDetail';

// 在路由配置中添加
<Routes>
  {/* 其他路由... */}
  <Route path="/cases" element={<CaseList />} />
  <Route path="/cases/:id" element={<CaseDetail />} />
</Routes>
```

## 验证步骤
1. 启动用户端应用验证页面正常渲染
2. 测试分类筛选功能
3. 测试搜索功能
4. 验证无限滚动加载
5. 测试案例详情页跳转和显示
6. 验证响应式布局在不同设备上的表现

## 输出物
- 案例展示相关的React页面组件
- 通用的案例展示组件库
- 完整的样式文件
- 路由配置更新

## 注意事项
1. 确保图片懒加载和无限滚动性能优化
2. 适配不同屏幕尺寸的响应式设计
3. 处理加载状态和错误状态
4. 优化SEO相关的meta信息

## 后续任务
- 下一步：16-移动端适配优化.md
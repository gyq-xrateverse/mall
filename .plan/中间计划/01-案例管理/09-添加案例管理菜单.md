# 09-添加案例管理菜单

## 任务概述
在管理后台前端添加"案例管理"菜单项，包括"案例类型"和"案例数据"两个子菜单，集成到现有的权限体系中。

## 前置条件
- 管理后台前端项目正常运行
- 后端案例管理API已完成
- 了解现有菜单配置方式

## 实施步骤

### 1. 添加菜单图标
**文件路径：** `mall-admin-web/src/icons/svg/`

创建案例管理相关的SVG图标文件：

**case.svg** (案例管理主图标)
```xml
<svg t="1640323456789" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M128 192h768v640H128z" fill="#2c2c2c"/>
  <path d="M256 320h512v64H256zM256 448h512v64H256zM256 576h384v64H256z" fill="#ffffff"/>
</svg>
```

**case-category.svg** (案例分类图标)
```xml
<svg t="1640323456790" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M192 192h256v256H192zM576 192h256v256H576zM192 576h256v256H192zM576 576h256v256H576z" fill="#2c2c2c"/>
</svg>
```

**case-data.svg** (案例数据图标)
```xml
<svg t="1640323456791" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M128 128h768v768H128z" fill="#2c2c2c"/>
  <path d="M256 256h128v128H256zM448 256h320v32H448zM448 320h256v32H448zM256 448h128v128H256zM448 448h320v32H448zM448 512h256v32H448z" fill="#ffffff"/>
</svg>
```

### 2. 更新路由配置
**文件路径：** `mall-admin-web/src/router/index.js`

在`asyncRouterMap`数组中添加案例管理路由：

```javascript
// 在asyncRouterMap数组中添加
{
  path: '/case',
  component: Layout,
  redirect: '/case/category',
  name: 'case',
  meta: {
    title: '案例管理',
    icon: 'case'
  },
  children: [
    {
      path: 'category',
      name: 'caseCategory',
      component: () => import('@/views/case/category/index'),
      meta: {
        title: '案例类型',
        icon: 'case-category'
      }
    },
    {
      path: 'category/add',
      name: 'addCaseCategory',
      component: () => import('@/views/case/category/add'),
      meta: {
        title: '添加案例类型',
        icon: 'case-category'
      },
      hidden: true
    },
    {
      path: 'category/update/:id',
      name: 'updateCaseCategory',
      component: () => import('@/views/case/category/update'),
      meta: {
        title: '修改案例类型',
        icon: 'case-category'
      },
      hidden: true
    },
    {
      path: 'data',
      name: 'caseData',
      component: () => import('@/views/case/data/index'),
      meta: {
        title: '案例数据',
        icon: 'case-data'
      }
    },
    {
      path: 'data/add',
      name: 'addCaseData',
      component: () => import('@/views/case/data/add'),
      meta: {
        title: '添加案例',
        icon: 'case-data'
      },
      hidden: true
    },
    {
      path: 'data/update/:id',
      name: 'updateCaseData',
      component: () => import('@/views/case/data/update'),
      meta: {
        title: '修改案例',
        icon: 'case-data'
      },
      hidden: true
    }
  ]
}
```

### 3. 创建API接口文件
**文件路径：** `mall-admin-web/src/api/case.js`

```javascript
import request from '@/utils/request'

// 案例分类相关API
export function fetchCategoryList(params) {
  return request({
    url: '/case/category/list',
    method: 'get',
    params: params
  })
}

export function createCategory(data) {
  return request({
    url: '/case/category/create',
    method: 'post',
    data: data
  })
}

export function updateCategory(id, data) {
  return request({
    url: `/case/category/update/${id}`,
    method: 'post',
    data: data
  })
}

export function deleteCategory(id) {
  return request({
    url: `/case/category/delete/${id}`,
    method: 'post'
  })
}

export function deleteCategoryBatch(ids) {
  return request({
    url: '/case/category/delete/batch',
    method: 'post',
    params: { ids: ids }
  })
}

export function getCategoryById(id) {
  return request({
    url: `/case/category/${id}`,
    method: 'get'
  })
}

export function updateCategoryStatus(id, status) {
  return request({
    url: `/case/category/update/status/${id}`,
    method: 'post',
    params: { status: status }
  })
}

export function updateCategoryShowStatus(id, showStatus) {
  return request({
    url: `/case/category/update/showStatus/${id}`,
    method: 'post',
    params: { showStatus: showStatus }
  })
}

export function getAllCategories() {
  return request({
    url: '/case/category/listAll',
    method: 'get'
  })
}

// 案例数据相关API
export function fetchCaseList(params) {
  return request({
    url: '/case/data/list',
    method: 'get',
    params: params
  })
}

export function createCase(data) {
  return request({
    url: '/case/data/create',
    method: 'post',
    data: data
  })
}

export function updateCase(id, data) {
  return request({
    url: `/case/data/update/${id}`,
    method: 'post',
    data: data
  })
}

export function deleteCase(id) {
  return request({
    url: `/case/data/delete/${id}`,
    method: 'post'
  })
}

export function deleteCaseBatch(ids) {
  return request({
    url: '/case/data/delete/batch',
    method: 'post',
    params: { ids: ids }
  })
}

export function getCaseById(id) {
  return request({
    url: `/case/data/${id}`,
    method: 'get'
  })
}

export function updateCaseStatus(id, status) {
  return request({
    url: `/case/data/update/status/${id}`,
    method: 'post',
    params: { status: status }
  })
}

export function updateCaseShowStatus(id, showStatus) {
  return request({
    url: `/case/data/update/showStatus/${id}`,
    method: 'post',
    params: { showStatus: showStatus }
  })
}

// 缓存管理相关API
export function warmUpCache() {
  return request({
    url: '/case/data/cache/warmup',
    method: 'post'
  })
}

export function clearAllCache() {
  return request({
    url: '/case/data/cache/clear/all',
    method: 'post'
  })
}

export function clearCaseCache(id) {
  return request({
    url: `/case/data/cache/clear/${id}`,
    method: 'post'
  })
}

export function getCacheStatistics() {
  return request({
    url: '/case/data/cache/statistics',
    method: 'get'
  })
}

export function refreshHotScore() {
  return request({
    url: '/case/data/refreshHotScore',
    method: 'post'
  })
}

export function refreshHotCache() {
  return request({
    url: '/case/data/refreshHotCache',
    method: 'post'
  })
}
```

### 4. 添加数据库菜单权限配置
需要在数据库中添加相应的菜单权限数据：

**SQL脚本：** `case_menu_permissions.sql`

```sql
-- 插入案例管理菜单
INSERT INTO ums_menu (id, parent_id, create_time, title, level, sort, name, icon, hidden) 
VALUES (30, 0, NOW(), '案例管理', 0, 5, 'case', 'case', 0);

-- 插入案例类型子菜单
INSERT INTO ums_menu (id, parent_id, create_time, title, level, sort, name, icon, hidden) 
VALUES (31, 30, NOW(), '案例类型', 1, 0, 'caseCategory', 'case-category', 0);

-- 插入案例数据子菜单
INSERT INTO ums_menu (id, parent_id, create_time, title, level, sort, name, icon, hidden) 
VALUES (32, 30, NOW(), '案例数据', 1, 1, 'caseData', 'case-data', 0);

-- 插入案例分类相关资源权限
INSERT INTO ums_resource (id, create_time, name, url, description, category_id) VALUES 
(30, NOW(), '案例分类列表', '/case/category/list', '获取案例分类列表', 1),
(31, NOW(), '创建案例分类', '/case/category/create', '创建案例分类', 1),
(32, NOW(), '修改案例分类', '/case/category/update/*', '修改案例分类', 1),
(33, NOW(), '删除案例分类', '/case/category/delete/*', '删除案例分类', 1),
(34, NOW(), '批量删除案例分类', '/case/category/delete/batch', '批量删除案例分类', 1);

-- 插入案例数据相关资源权限
INSERT INTO ums_resource (id, create_time, name, url, description, category_id) VALUES 
(35, NOW(), '案例数据列表', '/case/data/list', '获取案例数据列表', 1),
(36, NOW(), '创建案例数据', '/case/data/create', '创建案例数据', 1),
(37, NOW(), '修改案例数据', '/case/data/update/*', '修改案例数据', 1),
(38, NOW(), '删除案例数据', '/case/data/delete/*', '删除案例数据', 1),
(39, NOW(), '批量删除案例数据', '/case/data/delete/batch', '批量删除案例数据', 1);

-- 为管理员角色分配菜单权限
INSERT INTO ums_role_menu_relation (role_id, menu_id) VALUES 
(1, 30), (1, 31), (1, 32);

-- 为管理员角色分配资源权限
INSERT INTO ums_role_resource_relation (role_id, resource_id) VALUES 
(1, 30), (1, 31), (1, 32), (1, 33), (1, 34),
(1, 35), (1, 36), (1, 37), (1, 38), (1, 39);
```

### 5. 创建菜单组件目录结构
**创建目录结构：** 

```bash
mkdir -p /mnt/d/software/beilv-agent/mall/mall-admin-web/src/views/case/category
mkdir -p /mnt/d/software/beilv-agent/mall/mall-admin-web/src/views/case/data
mkdir -p /mnt/d/software/beilv-agent/mall/mall-admin-web/src/views/case/components
```

### 6. 创建面包屑导航配置
**文件路径：** 更新面包屑导航配置（如果有的话）

在面包屑导航配置中添加案例管理相关的导航路径：

```javascript
// 如果项目中有面包屑配置文件，添加以下配置
const breadcrumbNameMap = {
  '/case': '案例管理',
  '/case/category': '案例类型',
  '/case/category/add': '添加案例类型',
  '/case/category/update': '修改案例类型',
  '/case/data': '案例数据',
  '/case/data/add': '添加案例',
  '/case/data/update': '修改案例'
};
```

### 7. 更新侧边栏菜单样式
**文件路径：** 如果需要自定义菜单样式，可以在相应的CSS文件中添加：

```css
/* 案例管理菜单样式 */
.el-menu-item[data-menu="case"] .svg-icon,
.el-submenu__title[data-menu="case"] .svg-icon {
  color: #409EFF;
}

.el-menu-item[data-menu="caseCategory"] .svg-icon {
  color: #67C23A;
}

.el-menu-item[data-menu="caseData"] .svg-icon {
  color: #E6A23C;
}
```

## 验证步骤
1. 重新构建并启动前端项目
2. 登录管理后台检查菜单是否显示
3. 点击菜单验证路由跳转是否正常
4. 检查权限控制是否生效
5. 验证图标显示是否正确

## 菜单结构说明
```
案例管理 (case)
├── 案例类型 (caseCategory)
│   ├── 案例类型列表 (index)
│   ├── 添加案例类型 (add) [隐藏]
│   └── 修改案例类型 (update) [隐藏]
└── 案例数据 (caseData)
    ├── 案例数据列表 (index)
    ├── 添加案例 (add) [隐藏]
    └── 修改案例 (update) [隐藏]
```

## 权限配置说明
- **菜单权限**：控制菜单项的显示/隐藏
- **资源权限**：控制具体API接口的访问权限
- **角色分配**：将菜单和资源权限分配给相应角色

## 输出物
- 案例管理相关的SVG图标文件
- 更新的路由配置
- 案例管理API接口文件
- 数据库权限配置SQL脚本
- 完整的菜单结构和权限体系

## 注意事项
1. 菜单ID需要根据现有数据库中的最大ID进行调整
2. 权限配置需要与后端API路径保持一致
3. 图标文件需要符合项目的图标规范
4. 确保菜单排序合理，不影响现有菜单布局

## 后续任务
- 下一步：10-案例分类管理页面.md
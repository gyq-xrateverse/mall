# 2.2 æ¡ˆä¾‹å±•ç¤ºç»„ä»¶æ”¹é€ 

## ç›®æ ‡
åˆ›å»ºæ”¯æŒå›¾ç‰‡å±•ç¤ºå’Œè§†é¢‘æ’­æ”¾çš„åª’ä½“å±•ç¤ºç»„ä»¶ï¼Œä¼˜åŒ–ç”¨æˆ·å‰ç«¯æ¡ˆä¾‹æµè§ˆä½“éªŒ

## ä¼˜å…ˆçº§
é«˜

## æ”¹é€ å†…å®¹

### 2.2.1 MediaDisplayç»„ä»¶åˆ›å»º

**æ–‡ä»¶è·¯å¾„**: `beilv-agent-web/src/components/MediaDisplay.tsx`

#### ç»„ä»¶æ¥å£è®¾è®¡

```typescript
interface MediaDisplayProps {
  caseData: AICase;
  className?: string;
  autoPlay?: boolean;
  showControls?: boolean;
  showVideo?: boolean;  // æ˜¯å¦æ˜¾ç¤ºè§†é¢‘ï¼ˆtrueï¼‰è¿˜æ˜¯å›¾ç‰‡ï¼ˆfalseï¼‰
}

const MediaDisplay: React.FC<MediaDisplayProps> = ({
  caseData,
  className = '',
  autoPlay = false,
  showControls = true,
  showVideo = false
}) => {
  const [isVideoLoaded, setIsVideoLoaded] = useState(false);
  const videoRef = useRef<HTMLVideoElement>(null);

  const handleVideoLoad = () => {
    setIsVideoLoaded(true);
  };

  // ç®€åŒ–çš„åª’ä½“å±•ç¤º - æ¯ä¸ªæ¡ˆä¾‹éƒ½æœ‰å›¾ç‰‡å’Œè§†é¢‘
  return (
    <div className={`media-display ${className}`}>
      {/* æ ¹æ®æ˜¾ç¤ºæ¨¡å¼å†³å®šå±•ç¤ºå†…å®¹ */}
      {showVideo && caseData.videoUrl ? (
        // è§†é¢‘æ’­æ”¾æ¨¡å¼
        <div className="video-container">
          <video
            ref={videoRef}
            poster={caseData.imageUrl} // ä½¿ç”¨å›¾ç‰‡ä½œä¸ºè§†é¢‘å°é¢
            controls={showControls}
            autoPlay={autoPlay}
            muted={autoPlay}
            onLoadedData={handleVideoLoad}
            style={{
              width: '100%',
              height: 'auto',
              borderRadius: '8px'
            }}
          >
            <source src={caseData.videoUrl} type="video/mp4" />
            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
          </video>

          {!isVideoLoaded && (
            <div className="video-loading">
              <div className="loading-spinner"></div>
              <span>è§†é¢‘åŠ è½½ä¸­...</span>
            </div>
          )}
        </div>
      ) : (
        // å›¾ç‰‡æ˜¾ç¤ºæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
        <div className="image-container">
          <img
            src={caseData.imageUrl}
            alt={caseData.title}
            style={{
              width: '100%',
              height: 'auto',
              borderRadius: '8px'
            }}
            loading="lazy"
          />

          {/* è§†é¢‘æ’­æ”¾å›¾æ ‡ */}
          {caseData.videoUrl && (
            <div className="play-button-overlay">
              <div className="play-icon">â–¶</div>
            </div>
          )}
        </div>
      )}
    </div>
  );
};

export default MediaDisplay;
```

### 2.2.2 CaseCardç»„ä»¶æ”¹é€ 

**æ–‡ä»¶è·¯å¾„**: `beilv-agent-web/src/components/CaseCard.tsx`

```typescript
import React, { useState } from 'react';
import MediaDisplay from './MediaDisplay';
import { AICase } from '../types';

interface CaseCardProps {
  caseData: AICase;
  onClick?: () => void;
}

const CaseCard: React.FC<CaseCardProps> = ({ caseData, onClick }) => {
  const [isHovered, setIsHovered] = useState(false);

  const handleCardClick = () => {
    onClick?.();
  };

  return (
    <div
      className="case-card"
      onClick={handleCardClick}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
      style={{
        cursor: 'pointer',
        borderRadius: '12px',
        overflow: 'hidden',
        backgroundColor: '#fff',
        boxShadow: isHovered
          ? '0 8px 25px rgba(0, 0, 0, 0.15)'
          : '0 2px 10px rgba(0, 0, 0, 0.1)',
        transform: isHovered ? 'translateY(-2px)' : 'translateY(0)',
        transition: 'all 0.3s ease',
        marginBottom: '20px',
        breakInside: 'avoid'  // é˜²æ­¢ç€‘å¸ƒæµæ–­è£‚
      }}
    >
      {/* åª’ä½“å±•ç¤ºåŒºåŸŸ */}
      <div className="media-section">
        <MediaDisplay
          caseData={caseData}
          autoPlay={isHovered && !!caseData.videoUrl} // æ‚¬åœè‡ªåŠ¨æ’­æ”¾è§†é¢‘
          showControls={false} // å¡ç‰‡ä¸­ä¸æ˜¾ç¤ºæ§åˆ¶æ¡
          showVideo={false} // é»˜è®¤æ˜¾ç¤ºå›¾ç‰‡
        />

        {/* è§†é¢‘æ’­æ”¾æŒ‰é’® */}
        {caseData.videoUrl && !isHovered && (
          <div className="play-button">
            <div className="play-icon">â–¶</div>
          </div>
        )}
      </div>

      {/* å†…å®¹åŒºåŸŸ */}
      <div className="content-section" style={{ padding: '16px' }}>
        <h3
          style={{
            margin: '0 0 8px 0',
            fontSize: '16px',
            fontWeight: '600',
            color: '#1a1a1a',
            lineHeight: '1.4'
          }}
        >
          {caseData.title}
        </h3>

        {caseData.content && (
          <p
            style={{
              margin: '0 0 12px 0',
              fontSize: '14px',
              color: '#666',
              lineHeight: '1.5',
              display: '-webkit-box',
              WebkitLineClamp: 2,
              WebkitBoxOrient: 'vertical',
              overflow: 'hidden'
            }}
          >
            {caseData.content}
          </p>
        )}

        {/* æ ‡ç­¾ */}
        {caseData.tagList && caseData.tagList.length > 0 && (
          <div className="tags" style={{ marginBottom: '12px' }}>
            {caseData.tagList.slice(0, 3).map((tag, index) => (
              <span
                key={index}
                style={{
                  display: 'inline-block',
                  padding: '4px 8px',
                  margin: '0 6px 6px 0',
                  fontSize: '12px',
                  backgroundColor: '#f0f0f0',
                  color: '#666',
                  borderRadius: '12px'
                }}
              >
                {tag}
              </span>
            ))}
          </div>
        )}

        {/* åº•éƒ¨ä¿¡æ¯ */}
        <div
          style={{
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            fontSize: '12px',
            color: '#999'
          }}
        >
          <span>{caseData.category}</span>
          <span>{new Date(caseData.createTime).toLocaleDateString()}</span>
        </div>
      </div>
    </div>
  );
};

export default CaseCard;
```

### 2.2.3 CaseGalleryç»„ä»¶æ”¹é€ 

**æ–‡ä»¶è·¯å¾„**: `beilv-agent-web/src/components/CaseGallery.tsx`

```typescript
import React, { useEffect, useState, useMemo } from 'react';
import { useAppSelector, useAppDispatch } from '../hooks/redux';
import { fetchCases, setFilters, selectCase, setShowCaseDetail } from '../store/aiSlice';
import { selectFilteredCases, selectCasesLoading, selectFilters } from '../store/aiSlice';
import CaseCard from './CaseCard';
import { AICase } from '../types';

interface CaseGalleryProps {
  columns?: number;
  className?: string;
}

const CaseGallery: React.FC<CaseGalleryProps> = ({
  columns = 4,
  className = ''
}) => {
  const dispatch = useAppDispatch();
  const filteredCases = useAppSelector(selectFilteredCases);
  const isLoading = useAppSelector(selectCasesLoading);
  const filters = useAppSelector(selectFilters);

  // å“åº”å¼åˆ—æ•°
  const [galleryColumns, setGalleryColumns] = useState(columns);

  // å“åº”å¼å¤„ç†
  useEffect(() => {
    const handleResize = () => {
      const width = window.innerWidth;
      if (width < 768) {
        setGalleryColumns(1);
      } else if (width < 1024) {
        setGalleryColumns(2);
      } else if (width < 1440) {
        setGalleryColumns(3);
      } else {
        setGalleryColumns(columns);
      }
    };

    handleResize();
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, [columns]);

  // ç€‘å¸ƒæµå¸ƒå±€è®¡ç®—
  const columnizedCases = useMemo(() => {
    const columns: AICase[][] = Array.from({ length: galleryColumns }, () => []);

    filteredCases.forEach((caseItem, index) => {
      const columnIndex = index % galleryColumns;
      columns[columnIndex].push(caseItem);
    });

    return columns;
  }, [filteredCases, galleryColumns]);

  // æ¡ˆä¾‹ç‚¹å‡»å¤„ç†
  const handleCaseClick = (caseData: AICase) => {
    dispatch(selectCase(caseData));
    dispatch(setShowCaseDetail(true));
  };

  // åˆå§‹åŒ–æ•°æ®
  useEffect(() => {
    dispatch(fetchCases({}));
  }, [dispatch]);

  if (isLoading) {
    return (
      <div className="gallery-loading">
        <div className="loading-spinner"></div>
        <span>åŠ è½½ä¸­...</span>
      </div>
    );
  }

  return (
    <div className={`case-gallery ${className}`}>
      {/* ç­›é€‰å™¨ */}
      <div className="gallery-filters">
        <div className="filter-categories">
          {['å…¨éƒ¨', 'å‰ç«¯å¼€å‘', 'åç«¯å¼€å‘', 'ç§»åŠ¨å¼€å‘', 'æ•°æ®åˆ†æ'].map(category => (
            <button
              key={category}
              className={`filter-button ${filters.category === category ? 'active' : ''}`}
              onClick={() => dispatch(setFilters({ category }))}
            >
              {category}
            </button>
          ))}
        </div>

        <div className="filter-search">
          <input
            type="text"
            placeholder="æœç´¢æ¡ˆä¾‹..."
            value={filters.keyword}
            onChange={(e) => dispatch(setFilters({ keyword: e.target.value }))}
            className="search-input"
          />
        </div>
      </div>

      {/* æ¡ˆä¾‹ç½‘æ ¼ */}
      <div
        className="gallery-grid"
        style={{
          display: 'grid',
          gridTemplateColumns: `repeat(${galleryColumns}, 1fr)`,
          gap: '20px',
          padding: '20px 0'
        }}
      >
        {columnizedCases.map((column, columnIndex) => (
          <div key={columnIndex} className="gallery-column">
            {column.map((caseItem) => (
              <CaseCard
                key={caseItem.id}
                caseData={caseItem}
                onClick={() => handleCaseClick(caseItem)}
              />
            ))}
          </div>
        ))}
      </div>

      {/* ç©ºçŠ¶æ€ */}
      {filteredCases.length === 0 && !isLoading && (
        <div className="empty-state">
          <div className="empty-icon">ğŸ“</div>
          <h3>æš‚æ— æ¡ˆä¾‹</h3>
          <p>å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰æ‰¾åˆ°æ¡ˆä¾‹</p>
          <button
            onClick={() => dispatch(setFilters({ category: 'å…¨éƒ¨', keyword: '' }))}
            className="reset-filter-btn"
          >
            é‡ç½®ç­›é€‰
          </button>
        </div>
      )}
    </div>
  );
};

export default CaseGallery;
```

### 2.2.4 æ ·å¼ä¼˜åŒ–

**æ–‡ä»¶è·¯å¾„**: `beilv-agent-web/src/components/CaseCard.css`

```css
.case-card {
  position: relative;
  overflow: hidden;
}

.case-card .media-section {
  position: relative;
  overflow: hidden;
}

.case-card .play-button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 48px;
  height: 48px;
  background: rgba(0, 0, 0, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 16px;
  transition: all 0.3s ease;
  backdrop-filter: blur(4px);
}

.case-card:hover .play-button {
  background: rgba(0, 0, 0, 0.8);
  transform: translate(-50%, -50%) scale(1.1);
}

.play-button-overlay {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 24px;
  height: 24px;
  background: rgba(0, 0, 0, 0.6);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 10px;
}

.video-loading {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  color: #666;
}

.loading-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid #f3f3f3;
  border-top: 2px solid #3498db;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.gallery-filters {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  gap: 16px;
}

.filter-categories {
  display: flex;
  gap: 8px;
}

.filter-button {
  padding: 8px 16px;
  border: 1px solid #e1e5e9;
  background: white;
  border-radius: 20px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 14px;
}

.filter-button:hover {
  border-color: #3498db;
  color: #3498db;
}

.filter-button.active {
  background: #3498db;
  color: white;
  border-color: #3498db;
}

.search-input {
  padding: 8px 16px;
  border: 1px solid #e1e5e9;
  border-radius: 20px;
  outline: none;
  min-width: 200px;
  font-size: 14px;
}

.search-input:focus {
  border-color: #3498db;
  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #666;
}

.empty-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.reset-filter-btn {
  padding: 10px 24px;
  background: #3498db;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 16px;
  transition: background 0.2s ease;
}

.reset-filter-btn:hover {
  background: #2980b9;
}

@media (max-width: 768px) {
  .gallery-filters {
    flex-direction: column;
    align-items: stretch;
  }

  .filter-categories {
    flex-wrap: wrap;
  }

  .search-input {
    min-width: auto;
  }
}
```

## éªŒæ”¶æ ‡å‡†

1. âœ… MediaDisplayç»„ä»¶æ”¯æŒå›¾ç‰‡å’Œè§†é¢‘å±•ç¤º
2. âœ… CaseCardç»„ä»¶æ”¯æŒæ‚¬åœæ•ˆæœå’Œè§†é¢‘é¢„è§ˆ
3. âœ… ç€‘å¸ƒæµå¸ƒå±€å“åº”å¼é€‚é…
4. âœ… ç­›é€‰å’Œæœç´¢åŠŸèƒ½æ­£å¸¸
5. âœ… æ‡’åŠ è½½å’Œæ€§èƒ½ä¼˜åŒ–
6. âœ… ç©ºçŠ¶æ€å’Œé”™è¯¯å¤„ç†å®Œå–„
7. âœ… ç§»åŠ¨ç«¯é€‚é…è‰¯å¥½

## æµ‹è¯•è¦æ±‚

- æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼š`MediaDisplay.test.tsx`, `CaseCard.test.tsx`
- æ‰§è¡ŒE2Eæµ‹è¯•ï¼š`case-gallery.spec.js`
- éªŒè¯åª’ä½“å±•ç¤ºåŠŸèƒ½
- éªŒè¯äº¤äº’å’Œå“åº”å¼è®¾è®¡
- éªŒè¯æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

## ä¾èµ–

- ReduxçŠ¶æ€ç®¡ç†2.1ä»»åŠ¡å®Œæˆ
- æ¡ˆä¾‹æ•°æ®æ¥å£å¯ç”¨
- Reactå’Œç›¸å…³UIåº“å·²å®‰è£…

## äº¤ä»˜ç‰©

- [x] MediaDisplay.tsx åª’ä½“å±•ç¤ºç»„ä»¶
- [x] CaseCard.tsx æ¡ˆä¾‹å¡ç‰‡ç»„ä»¶
- [x] CaseGallery.tsx æ¡ˆä¾‹ç”»å»Šç»„ä»¶
- [x] ç›¸åº”çš„æ ·å¼æ–‡ä»¶å’Œæµ‹è¯•
- [x] å“åº”å¼è®¾è®¡å’Œæ€§èƒ½ä¼˜åŒ–
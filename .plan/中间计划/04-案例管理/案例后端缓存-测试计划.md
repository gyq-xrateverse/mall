# æ¡ˆä¾‹åç«¯ç¼“å­˜åŠŸèƒ½æµ‹è¯•è®¡åˆ’

## ğŸ¯ æµ‹è¯•ç›®æ ‡
å¯¹æ¡ˆä¾‹åç«¯ç¼“å­˜è®¡åˆ’ä¸­å®ç°çš„æ‰€æœ‰åŠŸèƒ½è¿›è¡Œå…¨é¢çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œç¡®ä¿ç¼“å­˜åŒæ­¥æœºåˆ¶çš„æ­£ç¡®æ€§ã€å®‰å…¨æ€§å’Œå¯é æ€§ã€‚

## ğŸ“‹ æµ‹è¯•èŒƒå›´

### 1. ç®¡ç†ç«¯ç¼“å­˜æœåŠ¡æµ‹è¯•
- **CaseCacheServiceImpl** - ç¼“å­˜CRUDæ“ä½œå’Œæ¶ˆæ¯å‘å¸ƒ
- **CacheKeyConstants** - ç¼“å­˜é”®å¸¸é‡ç®¡ç†
- **CacheSecurityGuard** - å®‰å…¨é˜²æŠ¤æœºåˆ¶
- **CacheFailureRecovery** - æ•…éšœæ¢å¤æœºåˆ¶

### 2. é—¨æˆ·ç«¯ç¼“å­˜æœåŠ¡æµ‹è¯•
- **PortalCaseCacheServiceImpl** - é—¨æˆ·ç«¯ç¼“å­˜æ“ä½œ
- **CacheUpdateListener** - æ¶ˆæ¯ç›‘å¬å’Œå¤„ç†

### 3. æ§åˆ¶å™¨å±‚æµ‹è¯•
- **CaseDataController** - æ¡ˆä¾‹ç®¡ç†æ“ä½œåçš„ç¼“å­˜æ¸…ç†
- **CacheMonitorController** - ç¼“å­˜ç›‘æ§æ¥å£

### 4. æ¶ˆæ¯æœºåˆ¶æµ‹è¯•
- **Rediså‘å¸ƒ/è®¢é˜…** - æ¶ˆæ¯å‘å¸ƒå’Œç›‘å¬
- **CacheUpdateMessage** - æ¶ˆæ¯æ ¼å¼å’Œåºåˆ—åŒ–

### 5. é›†æˆæµ‹è¯•
- **ç«¯åˆ°ç«¯ç¼“å­˜åŒæ­¥** - ç®¡ç†ç«¯åˆ°é—¨æˆ·ç«¯çš„å®Œæ•´æµç¨‹
- **æ•…éšœåœºæ™¯æµ‹è¯•** - Redisæ•…éšœæ—¶çš„é™çº§å’Œæ¢å¤

## ğŸ§ª æµ‹è¯•åˆ†ç±»

### Unit Tests (å•å…ƒæµ‹è¯•)
- æµ‹è¯•å•ä¸ªç»„ä»¶çš„åŠŸèƒ½
- Mockå¤–éƒ¨ä¾èµ–
- è¦†ç›–ç‡ç›®æ ‡: 90%+

### Integration Tests (é›†æˆæµ‹è¯•)
- æµ‹è¯•ç»„ä»¶é—´äº¤äº’
- ä½¿ç”¨çœŸå®Redisç¯å¢ƒ
- è¦†ç›–ä¸»è¦ä¸šåŠ¡æµç¨‹

### Security Tests (å®‰å…¨æµ‹è¯•)
- æƒé™éªŒè¯æµ‹è¯•
- é¢‘ç‡é™åˆ¶æµ‹è¯•
- æ¶æ„è¾“å…¥æµ‹è¯•

### Performance Tests (æ€§èƒ½æµ‹è¯•)
- ç¼“å­˜æ“ä½œæ€§èƒ½
- æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…å»¶è¿Ÿ
- é«˜å¹¶å‘åœºæ™¯

## ğŸ“Š æµ‹è¯•ç”¨ä¾‹æ¸…å•

### 1. CaseCacheServiceImpl æµ‹è¯•
- [x] åŸºç¡€ç¼“å­˜CRUDæ“ä½œ
- [x] æ‰¹é‡ç¼“å­˜æ¸…ç†
- [x] æ¶ˆæ¯å‘å¸ƒåŠŸèƒ½
- [x] å®‰å…¨éªŒè¯é›†æˆ
- [x] å¼‚å¸¸å¤„ç†

### 2. CacheSecurityGuard æµ‹è¯•
- [x] æƒé™éªŒè¯
- [x] é¢‘ç‡é™åˆ¶
- [x] æ¶ˆæ¯æ¥æºéªŒè¯
- [x] å®‰å…¨äº‹ä»¶è®°å½•

### 3. CacheUpdateListener æµ‹è¯•
- [x] æ¶ˆæ¯æ¥æ”¶å’Œè§£æ
- [x] ä¸åŒæ“ä½œç±»å‹å¤„ç†
- [x] æ¶ˆæ¯å®‰å…¨éªŒè¯
- [x] å¼‚å¸¸å®¹é”™

### 4. CacheMonitorController æµ‹è¯•
- [x] ç¼“å­˜å¥åº·æ£€æŸ¥
- [x] ç»Ÿè®¡ä¿¡æ¯è·å–
- [x] ç¼“å­˜æ¸…ç†æ“ä½œ
- [x] æµ‹è¯•æ¶ˆæ¯å‘å¸ƒ

### 5. CacheFailureRecovery æµ‹è¯•
- [x] Redisæ•…éšœæ£€æµ‹
- [x] è‡ªåŠ¨æ¢å¤æœºåˆ¶
- [x] é™çº§ç­–ç•¥
- [x] å¥åº·æ£€æŸ¥è°ƒåº¦

### 6. ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
- [x] æ¡ˆä¾‹åˆ›å»ºç¼“å­˜åŒæ­¥
- [x] æ¡ˆä¾‹æ›´æ–°ç¼“å­˜åŒæ­¥
- [x] æ¡ˆä¾‹åˆ é™¤ç¼“å­˜åŒæ­¥
- [x] æ‰¹é‡æ“ä½œç¼“å­˜åŒæ­¥
- [x] çŠ¶æ€æ›´æ–°ç¼“å­˜åŒæ­¥

## ğŸ”§ æµ‹è¯•ç¯å¢ƒè¦æ±‚

### åŸºç¡€ç¯å¢ƒ
```yaml
# æµ‹è¯•ç¯å¢ƒé…ç½®
spring:
  profiles:
    active: test
  redis:
    host: localhost
    port: 6379
    database: 15  # ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“
    timeout: 3000
    lettuce:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0

# æµ‹è¯•ä¸“ç”¨é…ç½®
redis:
  database: test_mall
  key:
    case: 'test_case'
  expire:
    common: 60    # æµ‹è¯•ç¯å¢ƒç¼©çŸ­è¿‡æœŸæ—¶é—´
    case: 30

# å®‰å…¨é…ç½®
cache:
  security:
    rate-limit:
      max-per-minute: 10  # é™ä½é™åˆ¶ä¾¿äºæµ‹è¯•
      max-per-hour: 100
```

### Mocké…ç½®
```java
@TestConfiguration
public class CacheTestConfig {

    @Bean
    @Primary
    public RedisTemplate<String, Object> mockRedisTemplate() {
        // Mock Redisæ¨¡æ¿
    }

    @Bean
    @Primary
    public RedisService mockRedisService() {
        // Mock RedisæœåŠ¡
    }
}
```

## ğŸ“ æµ‹è¯•æ•°æ®å‡†å¤‡

### æµ‹è¯•æ¡ˆä¾‹æ•°æ®
```java
public class CacheTestData {

    public static CaseData createTestCase(Long id) {
        CaseData caseData = new CaseData();
        caseData.setId(id);
        caseData.setTitle("æµ‹è¯•æ¡ˆä¾‹" + id);
        caseData.setCategoryId(1L);
        caseData.setStatus(1);
        caseData.setShowStatus(1);
        return caseData;
    }

    public static CacheUpdateMessage createTestMessage(ActionType action, Long caseId) {
        return new CacheUpdateMessage(
            action,
            ResourceType.CASE,
            caseId.toString(),
            Arrays.asList("test:key:1", "test:key:2"),
            "test_user"
        );
    }
}
```

## ğŸš€ æµ‹è¯•æ‰§è¡Œç­–ç•¥

### æµ‹è¯•é˜¶æ®µ
1. **Phase 1**: å•å…ƒæµ‹è¯• (1-2å¤©)
2. **Phase 2**: é›†æˆæµ‹è¯• (1-2å¤©)
3. **Phase 3**: å®‰å…¨æµ‹è¯• (1å¤©)
4. **Phase 4**: æ€§èƒ½æµ‹è¯• (1å¤©)
5. **Phase 5**: ç«¯åˆ°ç«¯æµ‹è¯• (1å¤©)

### æµ‹è¯•æ‰§è¡Œé¡ºåº
```bash
# 1. è¿è¡Œå•å…ƒæµ‹è¯•
mvn test -Dtest="*UnitTest"

# 2. è¿è¡Œé›†æˆæµ‹è¯•
mvn test -Dtest="*IntegrationTest" -Dspring.profiles.active=test

# 3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
mvn test -Dspring.profiles.active=test

# 4. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
mvn jacoco:report
```

## âœ… æµ‹è¯•éªŒæ”¶æ ‡å‡†

### è¦†ç›–ç‡è¦æ±‚
- **ä»£ç è¦†ç›–ç‡**: â‰¥ 90%
- **åˆ†æ”¯è¦†ç›–ç‡**: â‰¥ 85%
- **æ–¹æ³•è¦†ç›–ç‡**: â‰¥ 95%

### åŠŸèƒ½éªŒæ”¶
- âœ… æ‰€æœ‰ç¼“å­˜æ“ä½œæ­£å¸¸å·¥ä½œ
- âœ… æ¶ˆæ¯å‘å¸ƒ/è®¢é˜…æœºåˆ¶æ­£å¸¸
- âœ… å®‰å…¨é˜²æŠ¤æœºåˆ¶æœ‰æ•ˆ
- âœ… æ•…éšœæ¢å¤æœºåˆ¶å¯é 
- âœ… ç›‘æ§æ¥å£è¿”å›æ­£ç¡®æ•°æ®

### æ€§èƒ½éªŒæ”¶
- **ç¼“å­˜æ“ä½œå»¶è¿Ÿ**: < 10ms
- **æ¶ˆæ¯ä¼ é€’å»¶è¿Ÿ**: < 100ms
- **æ•…éšœæ£€æµ‹æ—¶é—´**: < 30s
- **æ•…éšœæ¢å¤æ—¶é—´**: < 60s

### å®‰å…¨éªŒæ”¶
- âœ… æƒé™éªŒè¯é˜»æ­¢æœªæˆæƒæ“ä½œ
- âœ… é¢‘ç‡é™åˆ¶é˜²æ­¢æ»¥ç”¨
- âœ… æ¶æ„æ¶ˆæ¯è¢«æ­£ç¡®æ‹’ç»
- âœ… å®‰å…¨äº‹ä»¶è¢«æ­£ç¡®è®°å½•

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šè¦æ±‚

### æŠ¥å‘Šå†…å®¹
1. **æµ‹è¯•æ‰§è¡Œæ‘˜è¦**
   - æµ‹è¯•ç”¨ä¾‹æ€»æ•°
   - é€šè¿‡/å¤±è´¥ç»Ÿè®¡
   - è¦†ç›–ç‡æ•°æ®

2. **åŠŸèƒ½æµ‹è¯•ç»“æœ**
   - å„æ¨¡å—æµ‹è¯•è¯¦æƒ…
   - å‘ç°çš„é—®é¢˜åˆ—è¡¨
   - ä¿®å¤å»ºè®®

3. **æ€§èƒ½æµ‹è¯•ç»“æœ**
   - å“åº”æ—¶é—´ç»Ÿè®¡
   - ååé‡æ•°æ®
   - æ€§èƒ½ç“¶é¢ˆåˆ†æ

4. **å®‰å…¨æµ‹è¯•ç»“æœ**
   - å®‰å…¨æ¼æ´æ£€æŸ¥
   - æƒé™æ§åˆ¶éªŒè¯
   - å®‰å…¨å»ºè®®

### æŠ¥å‘Šæ ¼å¼
```
æµ‹è¯•æŠ¥å‘Š-æ¡ˆä¾‹åç«¯ç¼“å­˜åŠŸèƒ½-YYYYMMDD.md
â”œâ”€â”€ æ‰§è¡Œæ‘˜è¦
â”œâ”€â”€ æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ æµ‹è¯•ç»“æœè¯¦æƒ…
â”œâ”€â”€ é—®é¢˜åˆ—è¡¨
â”œâ”€â”€ æ€§èƒ½åˆ†æ
â”œâ”€â”€ å®‰å…¨è¯„ä¼°
â””â”€â”€ æ”¹è¿›å»ºè®®
```

## ğŸ”„ æŒç»­é›†æˆ

### CI/CD é›†æˆ
```yaml
# .github/workflows/cache-tests.yml
name: Cache Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      redis:
        image: redis:6
        ports:
          - 6379:6379

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 11
      uses: actions/setup-java@v2
      with:
        java-version: '11'

    - name: Run Cache Tests
      run: |
        mvn test -Dtest="*CacheTest" -Dspring.profiles.active=test

    - name: Generate Test Report
      run: mvn jacoco:report

    - name: Upload Coverage
      uses: codecov/codecov-action@v1
```

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

### æµ‹è¯•å‰æ£€æŸ¥
- [ ] Redisæµ‹è¯•ç¯å¢ƒå·²å¯åŠ¨
- [ ] æµ‹è¯•æ•°æ®åº“å·²æ¸…ç†
- [ ] æµ‹è¯•é…ç½®æ­£ç¡®
- [ ] Mockå¯¹è±¡å·²å‡†å¤‡

### æµ‹è¯•æ‰§è¡Œæ£€æŸ¥
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- [ ] è¦†ç›–ç‡è¾¾æ ‡

### æµ‹è¯•åæ£€æŸ¥
- [ ] æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ
- [ ] é—®é¢˜å·²è®°å½•
- [ ] æµ‹è¯•ç¯å¢ƒå·²æ¸…ç†
- [ ] ä»£ç å·²æäº¤

## ğŸ¯ é¢„æœŸäº¤ä»˜ç‰©

1. **æµ‹è¯•ä»£ç **
   - å®Œæ•´çš„å•å…ƒæµ‹è¯•å¥—ä»¶
   - é›†æˆæµ‹è¯•ç”¨ä¾‹
   - æ€§èƒ½æµ‹è¯•è„šæœ¬

2. **æµ‹è¯•é…ç½®**
   - æµ‹è¯•ç¯å¢ƒé…ç½®æ–‡ä»¶
   - Mocké…ç½®ç±»
   - æµ‹è¯•æ•°æ®å·¥å‚

3. **æµ‹è¯•æ–‡æ¡£**
   - æµ‹è¯•æ‰§è¡ŒæŠ¥å‘Š
   - é—®é¢˜ä¿®å¤è®°å½•
   - æ€§èƒ½åŸºå‡†æ•°æ®

4. **CI/CDé…ç½®**
   - è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
   - è¦†ç›–ç‡æŠ¥å‘Šé…ç½®
   - æµ‹è¯•ç»“æœé€šçŸ¥

é€šè¿‡è¿™å¥—å®Œæ•´çš„æµ‹è¯•è®¡åˆ’ï¼Œæˆ‘ä»¬å°†ç¡®ä¿æ¡ˆä¾‹åç«¯ç¼“å­˜åŠŸèƒ½çš„é«˜è´¨é‡äº¤ä»˜ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æä¾›å¯é ä¿éšœã€‚